"use strict";function _typeof(obj){"@babel/helpers - typeof";if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get;}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver);}return desc.value;};}return _get(target,property,receiver||target);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _createSuper(Derived){var hasNativeReflectConstruct=_isNativeReflectConstruct();return function(){var Super=_getPrototypeOf(Derived),result;if(hasNativeReflectConstruct){var NewTarget=_getPrototypeOf(this).constructor;result=Reflect.construct(Super,arguments,NewTarget);}else{result=Super.apply(this,arguments);}return _possibleConstructorReturn(this,result);};}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}window.bdMiniGame=function(exports,Laya){'use strict';var MiniFileMgr=/*#__PURE__*/function(){function MiniFileMgr(){_classCallCheck(this,MiniFileMgr);}_createClass(MiniFileMgr,null,[{key:"isLocalNativeFile",value:function isLocalNativeFile(url){for(var i=0,sz=BMiniAdapter.nativefiles.length;i<sz;i++){if(url.indexOf(BMiniAdapter.nativefiles[i])!=-1)return true;}return false;}},{key:"isNetFile",value:function isNetFile(url){return(url.indexOf("http://")!=-1||url.indexOf("https://")!=-1)&&url.indexOf(BMiniAdapter.window.swan.env.USER_DATA_PATH)==-1;}},{key:"getFileInfo",value:function getFileInfo(fileUrl){var fileNativePath=fileUrl;var fileObj=MiniFileMgr.fakeObj[fileNativePath];if(fileObj==null)return null;else return fileObj;}},{key:"read",value:function read(filePath){var encoding=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"utf8";var callBack=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var readyUrl=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var isSaveFile=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var fileType=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"";var fileUrl;if(readyUrl!=""&&(readyUrl.indexOf("http://")!=-1||readyUrl.indexOf("https://")!=-1)){fileUrl=MiniFileMgr.getFileNativePath(filePath);}else{fileUrl=filePath;}fileUrl=Laya.URL.getAdptedFilePath(fileUrl);MiniFileMgr.fs.readFile({filePath:fileUrl,encoding:encoding,success:function success(data){callBack!=null&&callBack.runWith([0,data]);},fail:function fail(data){if(data&&readyUrl!="")MiniFileMgr.downFiles(encodeURI(readyUrl),encoding,callBack,readyUrl,isSaveFile,fileType);else callBack!=null&&callBack.runWith([1]);}});}},{key:"isFile",value:function isFile(url){var stat;try{stat=MiniFileMgr.fs.statSync(url);}catch(err){return false;}return stat.isFile();}},{key:"downFiles",value:function downFiles(fileUrl){var encoding=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"utf8";var callBack=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var readyUrl=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var isSaveFile=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var fileType=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"";var isAutoClear=arguments.length>6&&arguments[6]!==undefined?arguments[6]:true;var downloadTask=MiniFileMgr.down({url:fileUrl,success:function success(data){if(data.statusCode===200)MiniFileMgr.readFile(data.tempFilePath,encoding,callBack,readyUrl,isSaveFile,fileType,isAutoClear);else if(data.statusCode===403){callBack!=null&&callBack.runWith([0,fileUrl]);}else{callBack!=null&&callBack.runWith([1,data]);}},fail:function fail(data){callBack!=null&&callBack.runWith([1,data]);}});downloadTask.onProgressUpdate(function(data){callBack!=null&&callBack.runWith([2,data.progress]);});}},{key:"readFile",value:function readFile(filePath){var encoding=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"utf8";var callBack=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var readyUrl=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var isSaveFile=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var fileType=arguments.length>5&&arguments[5]!==undefined?arguments[5]:"";var isAutoClear=arguments.length>6&&arguments[6]!==undefined?arguments[6]:true;filePath=Laya.URL.getAdptedFilePath(filePath);MiniFileMgr.fs.readFile({filePath:filePath,encoding:encoding,success:function success(data){if((filePath.indexOf("http://")!=-1||filePath.indexOf("https://")!=-1)&&filePath.indexOf(BMiniAdapter.window.swan.env.USER_DATA_PATH)==-1){if(BMiniAdapter.AutoCacheDownFile||isSaveFile){callBack!=null&&callBack.runWith([0,data]);MiniFileMgr.copyTOCache(filePath,readyUrl,null,encoding,isAutoClear);}else callBack!=null&&callBack.runWith([0,data]);}else callBack!=null&&callBack.runWith([0,data]);},fail:function fail(data){if(data)callBack!=null&&callBack.runWith([1,data]);}});}},{key:"downOtherFiles",value:function downOtherFiles(fileUrl){var callBack=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var readyUrl=arguments.length>2&&arguments[2]!==undefined?arguments[2]:"";var isSaveFile=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var isAutoClear=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;MiniFileMgr.down({url:fileUrl,success:function success(data){if(data.statusCode===200){if((BMiniAdapter.autoCacheFile||isSaveFile)&&readyUrl.indexOf(".php")==-1){callBack!=null&&callBack.runWith([0,data.tempFilePath]);MiniFileMgr.copyTOCache(data.tempFilePath,readyUrl,null,"",isAutoClear);}else callBack!=null&&callBack.runWith([0,data.tempFilePath]);}else{callBack!=null&&callBack.runWith([1,data]);}},fail:function fail(data){callBack!=null&&callBack.runWith([1,data]);}});}},{key:"copyFile",value:function copyFile(src,dest){var complete=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;MiniFileMgr.fs.copyFile({srcPath:src,destPath:dest,success:function success(){complete&&complete.runWith(0);},fail:function fail(err){complete&&complete.runWith([1,err]);}});}},{key:"downLoadFile",value:function downLoadFile(fileUrl){var fileType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var callBack=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var encoding=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"utf8";if(window.navigator.userAgent.indexOf('SwanGame')<0){Laya.Laya.loader.load(fileUrl,callBack);}else{if(fileType==Laya.Loader.IMAGE||fileType==Laya.Loader.SOUND)MiniFileMgr.downOtherFiles(fileUrl,callBack,fileUrl,true,false);else MiniFileMgr.downFiles(fileUrl,encoding,callBack,fileUrl,true,fileType,false);}}},{key:"copyTOCache",value:function copyTOCache(tempFilePath,readyUrl,callBack){var encoding=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var isAutoClear=arguments.length>4&&arguments[4]!==undefined?arguments[4]:true;var temp=tempFilePath.split("/");var tempFileName=temp[temp.length-1];var fileurlkey=readyUrl;var fileObj=MiniFileMgr.getFileInfo(readyUrl);var saveFilePath=MiniFileMgr.getFileNativePath(tempFileName);MiniFileMgr.fakeObj[fileurlkey]={md5:tempFileName,readyUrl:readyUrl,size:0,times:Laya.Browser.now(),encoding:encoding,tempFilePath:tempFilePath};var totalSize=BMiniAdapter.sizeLimit;var chaSize=4*1024*1024;var fileUseSize=MiniFileMgr.getCacheUseSize();if(fileObj){if(fileObj.readyUrl!=readyUrl){MiniFileMgr.fs.getFileInfo({filePath:tempFilePath,success:function success(data){if(isAutoClear&&fileUseSize+chaSize+data.size>=totalSize){if(data.size>BMiniAdapter.minClearSize)BMiniAdapter.minClearSize=data.size;MiniFileMgr.onClearCacheRes();}MiniFileMgr.deleteFile(tempFilePath,readyUrl,callBack,encoding,data.size);},fail:function fail(data){callBack!=null&&callBack.runWith([1,data]);}});}else callBack!=null&&callBack.runWith([0]);}else{MiniFileMgr.fs.getFileInfo({filePath:tempFilePath,success:function success(data){if(isAutoClear&&fileUseSize+chaSize+data.size>=totalSize){if(data.size>BMiniAdapter.minClearSize)BMiniAdapter.minClearSize=data.size;MiniFileMgr.onClearCacheRes();}MiniFileMgr.fs.copyFile({srcPath:tempFilePath,destPath:saveFilePath,success:function success(data2){MiniFileMgr.onSaveFile(readyUrl,tempFileName,true,encoding,callBack,data.size);},fail:function fail(data){callBack!=null&&callBack.runWith([1,data]);}});},fail:function fail(data){callBack!=null&&callBack.runWith([1,data]);}});}}},{key:"onClearCacheRes",value:function onClearCacheRes(){var memSize=BMiniAdapter.minClearSize;var tempFileListArr=[];for(var key in MiniFileMgr.filesListObj){if(key!="fileUsedSize")tempFileListArr.push(MiniFileMgr.filesListObj[key]);}MiniFileMgr.sortOn(tempFileListArr,"times",MiniFileMgr.NUMERIC);var clearSize=0;for(var i=1,sz=tempFileListArr.length;i<sz;i++){var fileObj=tempFileListArr[i];if(clearSize>=memSize)break;clearSize+=fileObj.size;MiniFileMgr.deleteFile("",fileObj.readyUrl);}}},{key:"sortOn",value:function sortOn(array,name){var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;if(options==MiniFileMgr.NUMERIC)return array.sort(function(a,b){return a[name]-b[name];});if(options==(MiniFileMgr.NUMERIC|MiniFileMgr.DESCENDING))return array.sort(function(a,b){return b[name]-a[name];});return array.sort(function(a,b){return a[name]-b[name];});}},{key:"getFileNativePath",value:function getFileNativePath(fileName){return MiniFileMgr.fileNativeDir+"/"+fileName;}},{key:"deleteFile",value:function deleteFile(tempFileName){var readyUrl=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var callBack=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var encoding=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var fileSize=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var fileObj=MiniFileMgr.getFileInfo(readyUrl);var deleteFileUrl=MiniFileMgr.getFileNativePath(fileObj.md5);MiniFileMgr.fs.unlink({filePath:deleteFileUrl,success:function success(data){if(tempFileName!=""){var saveFilePath=MiniFileMgr.getFileNativePath(tempFileName);MiniFileMgr.fs.copyFile({srcPath:tempFileName,destPath:saveFilePath,success:function success(data){MiniFileMgr.onSaveFile(readyUrl,tempFileName,true,encoding,callBack,fileSize);},fail:function fail(data){callBack!=null&&callBack.runWith([1,data]);}});}else{MiniFileMgr.onSaveFile(readyUrl,tempFileName,false,encoding,callBack,fileSize);}},fail:function fail(data){callBack!=null&&callBack.runWith([1,data]);}});}},{key:"deleteAll",value:function deleteAll(){var tempFileListArr=[];for(var key in MiniFileMgr.filesListObj){if(key!="fileUsedSize")tempFileListArr.push(MiniFileMgr.filesListObj[key]);}for(var i=1,sz=tempFileListArr.length;i<sz;i++){var fileObj=tempFileListArr[i];MiniFileMgr.deleteFile("",fileObj.readyUrl);}if(MiniFileMgr.filesListObj&&MiniFileMgr.filesListObj.fileUsedSize){MiniFileMgr.filesListObj.fileUsedSize=0;}MiniFileMgr.writeFilesList("",JSON.stringify({}),false);}},{key:"onSaveFile",value:function onSaveFile(readyUrl,md5Name){var isAdd=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;var encoding=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var callBack=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;var fileSize=arguments.length>5&&arguments[5]!==undefined?arguments[5]:0;var fileurlkey=readyUrl;if(MiniFileMgr.filesListObj['fileUsedSize']==null)MiniFileMgr.filesListObj['fileUsedSize']=0;if(isAdd){var fileNativeName=MiniFileMgr.getFileNativePath(md5Name);MiniFileMgr.filesListObj[fileurlkey]={md5:md5Name,readyUrl:readyUrl,size:fileSize,times:Laya.Browser.now(),encoding:encoding,tempFilePath:fileNativeName};MiniFileMgr.filesListObj['fileUsedSize']=parseInt(MiniFileMgr.filesListObj['fileUsedSize'])+fileSize;MiniFileMgr.writeFilesList(fileurlkey,JSON.stringify(MiniFileMgr.filesListObj),true);callBack!=null&&callBack.runWith([0]);}else{if(MiniFileMgr.filesListObj[fileurlkey]){var deletefileSize=parseInt(MiniFileMgr.filesListObj[fileurlkey].size);MiniFileMgr.filesListObj['fileUsedSize']=parseInt(MiniFileMgr.filesListObj['fileUsedSize'])-deletefileSize;if(MiniFileMgr.fakeObj[fileurlkey].md5==MiniFileMgr.filesListObj[fileurlkey].md5){delete MiniFileMgr.fakeObj[fileurlkey];}delete MiniFileMgr.filesListObj[fileurlkey];MiniFileMgr.writeFilesList(fileurlkey,JSON.stringify(MiniFileMgr.filesListObj),false);callBack!=null&&callBack.runWith([0]);}}}},{key:"writeFilesList",value:function writeFilesList(fileurlkey,filesListStr,isAdd){var listFilesPath=MiniFileMgr.fileNativeDir+"/"+MiniFileMgr.fileListName;MiniFileMgr.fs.writeFile({filePath:listFilesPath,encoding:'utf8',data:filesListStr,success:function success(data){},fail:function fail(data){}});if(!BMiniAdapter.isZiYu&&BMiniAdapter.isPosMsgYu){BMiniAdapter.window.swan.postMessage({url:fileurlkey,data:MiniFileMgr.filesListObj[fileurlkey],isLoad:"filenative",isAdd:isAdd});}}},{key:"getCacheUseSize",value:function getCacheUseSize(){if(MiniFileMgr.filesListObj&&MiniFileMgr.filesListObj['fileUsedSize'])return MiniFileMgr.filesListObj['fileUsedSize'];return 0;}},{key:"getCacheList",value:function getCacheList(dirPath,cb){var stat;try{stat=MiniFileMgr.fs.statSync(dirPath);}catch(err){stat=null;}if(stat){MiniFileMgr.readSync(MiniFileMgr.fileListName,"utf8",cb);}else{MiniFileMgr.fs.mkdirSync(dirPath,true);cb&&cb.runWith([1]);}}},{key:"existDir",value:function existDir(dirPath,callBack){MiniFileMgr.fs.mkdir({dirPath:dirPath,success:function success(data){callBack!=null&&callBack.runWith([0,{data:JSON.stringify({})}]);},fail:function fail(data){if(data.errMsg.indexOf("file already exists")!=-1)MiniFileMgr.readSync(MiniFileMgr.fileListName,"utf8",callBack);else callBack!=null&&callBack.runWith([1,data]);}});}},{key:"readSync",value:function readSync(filePath){var encoding=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"utf8";var callBack=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var readyUrl=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var fileUrl=MiniFileMgr.getFileNativePath(filePath);var filesListStr;try{filesListStr=MiniFileMgr.fs.readFileSync(fileUrl,encoding);callBack!=null&&callBack.runWith([0,{data:filesListStr}]);}catch(error){callBack!=null&&callBack.runWith([1]);}}},{key:"setNativeFileDir",value:function setNativeFileDir(value){MiniFileMgr.fileNativeDir=BMiniAdapter.window.swan.env.USER_DATA_PATH+value;}}]);return MiniFileMgr;}();MiniFileMgr.fs=window.swan.getFileSystemManager();MiniFileMgr.down=window.swan.downloadFile;MiniFileMgr.filesListObj={};MiniFileMgr.fakeObj={};MiniFileMgr.fileListName="layaairfiles.txt";MiniFileMgr.ziyuFileData={};MiniFileMgr.ziyuFileTextureData={};MiniFileMgr.loadPath="";MiniFileMgr.DESCENDING=2;MiniFileMgr.NUMERIC=16;var MiniSoundChannel=/*#__PURE__*/function(_Laya$SoundChannel){_inherits(MiniSoundChannel,_Laya$SoundChannel);var _super=_createSuper(MiniSoundChannel);function MiniSoundChannel(audio,miniSound){var _this;_classCallCheck(this,MiniSoundChannel);_this=_super.call(this);_this._audio=audio;_this._miniSound=miniSound;_this._onEnd=MiniSoundChannel.bindToThis(_this.__onEnd,_assertThisInitialized(_this));audio.onEnded(_this._onEnd);return _this;}_createClass(MiniSoundChannel,[{key:"__onEnd",value:function __onEnd(){if(this.loops==1){if(this.completeHandler){Laya.Laya.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],false);this.completeHandler=null;}this.stop();this.event(Laya.Event.COMPLETE);return;}if(this.loops>0){this.loops--;}this.startTime=0;this.play();}},{key:"play",value:function play(){this.isStopped=false;Laya.SoundManager.addChannel(this);this._audio.play();}},{key:"stop",value:function stop(){this.isStopped=true;Laya.SoundManager.removeChannel(this);this.completeHandler=null;if(!this._audio)return;this._audio.stop();if(!this.loop){this._audio.offEnded(null);this._miniSound.dispose();this._audio=null;this._miniSound=null;this._onEnd=null;}}},{key:"pause",value:function pause(){this.isStopped=true;this._audio.pause();}},{key:"resume",value:function resume(){if(!this._audio)return;this.isStopped=false;Laya.SoundManager.addChannel(this);this._audio.play();}},{key:"startTime",set:function set(time){if(this._audio){this._audio.startTime=time;}}},{key:"autoplay",set:function set(value){this._audio.autoplay=value;},get:function get(){return this._audio.autoplay;}},{key:"position",get:function get(){if(!this._audio)return 0;return this._audio.currentTime;}},{key:"duration",get:function get(){if(!this._audio)return 0;return this._audio.duration;}},{key:"loop",get:function get(){return this._audio.loop;},set:function set(value){this._audio.loop=value;}},{key:"volume",set:function set(v){if(!this._audio)return;this._audio.volume=v;},get:function get(){if(!this._audio)return 1;return this._audio.volume;}}],[{key:"bindToThis",value:function bindToThis(fun,scope){var rst=fun;rst=fun.bind(scope);return rst;}}]);return MiniSoundChannel;}(Laya.SoundChannel);var MiniSound=/*#__PURE__*/function(_Laya$EventDispatcher){_inherits(MiniSound,_Laya$EventDispatcher);var _super2=_createSuper(MiniSound);function MiniSound(){var _this2;_classCallCheck(this,MiniSound);_this2=_super2.call(this);_this2.loaded=false;return _this2;}_createClass(MiniSound,[{key:"load",value:function load(url){if(!MiniSound._musicAudio)MiniSound._musicAudio=MiniSound._createSound();if(!MiniFileMgr.isLocalNativeFile(url)){url=Laya.URL.formatURL(url);}else{if(url.indexOf("http://")!=-1||url.indexOf("https://")!=-1){if(MiniFileMgr.loadPath!=""){url=url.split(MiniFileMgr.loadPath)[1];}else{var tempStr=Laya.URL.rootPath!=""?Laya.URL.rootPath:Laya.URL._basePath;if(tempStr!="")url=url.split(tempStr)[1];}}}this.url=url;this.readyUrl=url;if(MiniSound._audioCache[this.readyUrl]){this.event(Laya.Event.COMPLETE);return;}if(BMiniAdapter.autoCacheFile&&MiniFileMgr.getFileInfo(url)){this.onDownLoadCallBack(url,0);}else{if(!BMiniAdapter.autoCacheFile){this.onDownLoadCallBack(url,0);}else{if(MiniFileMgr.isLocalNativeFile(url)){tempStr=Laya.URL.rootPath!=""?Laya.URL.rootPath:Laya.URL._basePath;var tempUrl=url;if(tempStr!="")url=url.split(tempStr)[1];if(!url){url=tempUrl;}if(BMiniAdapter.subNativeFiles&&BMiniAdapter.subNativeheads.length==0){for(var key in BMiniAdapter.subNativeFiles){var tempArr=BMiniAdapter.subNativeFiles[key];BMiniAdapter.subNativeheads=BMiniAdapter.subNativeheads.concat(tempArr);for(var aa=0;aa<tempArr.length;aa++){BMiniAdapter.subMaps[tempArr[aa]]=key+"/"+tempArr[aa];}}}if(BMiniAdapter.subNativeFiles&&url.indexOf("/")!=-1){var curfileHead=url.split("/")[0]+"/";if(curfileHead&&BMiniAdapter.subNativeheads.indexOf(curfileHead)!=-1){var newfileHead=BMiniAdapter.subMaps[curfileHead];url=url.replace(curfileHead,newfileHead);}}this.onDownLoadCallBack(url,0);}else{if(!MiniFileMgr.isLocalNativeFile(url)&&url.indexOf("http://")==-1&&url.indexOf("https://")==-1||url.indexOf(BMiniAdapter.window.swan.env.USER_DATA_PATH)!=-1){this.onDownLoadCallBack(url,0);}else{MiniFileMgr.downOtherFiles(encodeURI(url),Laya.Handler.create(this,this.onDownLoadCallBack,[url]),url);}}}}}},{key:"onDownLoadCallBack",value:function onDownLoadCallBack(sourceUrl,errorCode){if(!errorCode){var fileNativeUrl;if(BMiniAdapter.autoCacheFile){if(MiniFileMgr.isLocalNativeFile(sourceUrl)){var tempStr=Laya.URL.rootPath!=""?Laya.URL.rootPath:Laya.URL._basePath;var tempUrl=sourceUrl;if(tempStr!=""&&(sourceUrl.indexOf("http://")!=-1||sourceUrl.indexOf("https://")!=-1))fileNativeUrl=sourceUrl.split(tempStr)[1];if(!fileNativeUrl){fileNativeUrl=tempUrl;}}else{var fileObj=MiniFileMgr.getFileInfo(sourceUrl);if(fileObj&&fileObj.md5){var fileMd5Name=fileObj.md5;fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name);}else{fileNativeUrl=sourceUrl;}}if(this.url!=Laya.SoundManager._bgMusic){this._sound=MiniSound._createSound();this._sound.src=this.url=fileNativeUrl;}else{this._sound=MiniSound._musicAudio;this._sound.src=this.url=fileNativeUrl;}}else{if(this.url!=Laya.SoundManager._bgMusic){this._sound=MiniSound._createSound();this._sound.src=sourceUrl;}else{this._sound=MiniSound._musicAudio;this._sound.src=sourceUrl;}}this._sound.onCanplay(MiniSound.bindToThis(this.onCanPlay,this));this._sound.onError(MiniSound.bindToThis(this.onError,this));}else{this.event(Laya.Event.ERROR);}}},{key:"onError",value:function onError(error){try{console.log("-----1---------------minisound-----id:"+MiniSound._id);console.log(error);}catch(error){console.log("-----2---------------minisound-----id:"+MiniSound._id);console.log(error);}this.event(Laya.Event.ERROR);this._sound.offError(null);}},{key:"onCanPlay",value:function onCanPlay(){this.loaded=true;this.event(Laya.Event.COMPLETE);this._sound.offCanplay(null);}},{key:"play",value:function play(){var startTime=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var loops=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var tSound;if(this.url==Laya.SoundManager._bgMusic){if(!MiniSound._musicAudio)MiniSound._musicAudio=MiniSound._createSound();tSound=MiniSound._musicAudio;}else{if(MiniSound._audioCache[this.readyUrl]){tSound=MiniSound._audioCache[this.readyUrl]._sound;}else{tSound=MiniSound._createSound();}}if(!tSound)return null;if(BMiniAdapter.autoCacheFile&&MiniFileMgr.getFileInfo(this.url)){var fileObj=MiniFileMgr.getFileInfo(this.url);var fileMd5Name=fileObj.md5;tSound.src=this.url=MiniFileMgr.getFileNativePath(fileMd5Name);}else{tSound.src=encodeURI(this.url);}var channel=new MiniSoundChannel(tSound,this);channel.url=this.url;channel.loops=loops;channel.loop=loops===0?true:false;channel.startTime=startTime;channel.play();Laya.SoundManager.addChannel(channel);return channel;}},{key:"dispose",value:function dispose(){var ad=MiniSound._audioCache[this.readyUrl];if(ad){ad.src="";if(ad._sound){ad._sound.destroy();ad._sound=null;ad=null;}delete MiniSound._audioCache[this.readyUrl];}if(this._sound){this._sound.destroy();this._sound=null;this.readyUrl=this.url=null;}}},{key:"duration",get:function get(){return this._sound.duration;}}],[{key:"_createSound",value:function _createSound(){MiniSound._id++;return BMiniAdapter.window.swan.createInnerAudioContext();}},{key:"bindToThis",value:function bindToThis(fun,scope){var rst=fun;rst=fun.bind(scope);return rst;}}]);return MiniSound;}(Laya.EventDispatcher);MiniSound._id=0;MiniSound._audioCache={};var MiniInput=/*#__PURE__*/function(){function MiniInput(){_classCallCheck(this,MiniInput);}_createClass(MiniInput,null,[{key:"_createInputElement",value:function _createInputElement(){Laya.Input['_initInput'](Laya.Input['area']=Laya.Browser.createElement("textarea"));Laya.Input['_initInput'](Laya.Input['input']=Laya.Browser.createElement("input"));Laya.Input['inputContainer']=Laya.Browser.createElement("div");Laya.Input['inputContainer'].style.position="absolute";Laya.Input['inputContainer'].style.zIndex=1E5;Laya.Browser.container.appendChild(Laya.Input['inputContainer']);Laya.Laya.stage.on("resize",null,MiniInput._onStageResize);BMiniAdapter.window.swan.onWindowResize&&BMiniAdapter.window.swan.onWindowResize(function(res){});Laya.SoundManager._soundClass=MiniSound;Laya.SoundManager._musicClass=MiniSound;var model=BMiniAdapter.systemInfo.model;var system=BMiniAdapter.systemInfo.system;if(model.indexOf("iPhone")!=-1){Laya.Browser.onIPhone=true;Laya.Browser.onIOS=true;Laya.Browser.onIPad=true;Laya.Browser.onAndroid=false;}if(system.indexOf("Android")!=-1||system.indexOf("Adr")!=-1){Laya.Browser.onAndroid=true;Laya.Browser.onIPhone=false;Laya.Browser.onIOS=false;Laya.Browser.onIPad=false;}}},{key:"_onStageResize",value:function _onStageResize(){var ts=Laya.Laya.stage._canvasTransform.identity();ts.scale(Laya.Browser.width/Laya.Render.canvas.width/Laya.Browser.pixelRatio,Laya.Browser.height/Laya.Render.canvas.height/Laya.Browser.pixelRatio);}},{key:"wxinputFocus",value:function wxinputFocus(e){var _inputTarget=Laya.Input['inputElement'].target;if(_inputTarget&&!_inputTarget.editable){return;}BMiniAdapter.window.swan.offKeyboardConfirm();BMiniAdapter.window.swan.offKeyboardInput();BMiniAdapter.window.swan.showKeyboard({defaultValue:_inputTarget.text,maxLength:_inputTarget.maxChars,multiple:_inputTarget.multiline,confirmHold:true,confirmType:_inputTarget["confirmType"]||'done',success:function success(res){},fail:function fail(res){}});BMiniAdapter.window.swan.onKeyboardConfirm(function(res){var str=res?res.value:"";if(_inputTarget._restrictPattern){str=str.replace(/\u2006|\x27/g,"");if(_inputTarget._restrictPattern.test(str)){str=str.replace(_inputTarget._restrictPattern,"");}}_inputTarget.text=str;_inputTarget.event(Laya.Event.INPUT);MiniInput.inputEnter();_inputTarget.event("confirm");});BMiniAdapter.window.swan.onKeyboardInput(function(res){var str=res?res.value:"";if(!_inputTarget.multiline){if(str.indexOf("\n")!=-1){MiniInput.inputEnter();return;}}if(_inputTarget._restrictPattern){str=str.replace(/\u2006|\x27/g,"");if(_inputTarget._restrictPattern.test(str)){str=str.replace(_inputTarget._restrictPattern,"");}}_inputTarget.text=str;_inputTarget.event(Laya.Event.INPUT);});}},{key:"inputEnter",value:function inputEnter(){Laya.Input['inputElement'].target.focus=false;}},{key:"wxinputblur",value:function wxinputblur(){MiniInput.hideKeyboard();}},{key:"hideKeyboard",value:function hideKeyboard(){BMiniAdapter.window.swan.offKeyboardConfirm();BMiniAdapter.window.swan.offKeyboardInput();BMiniAdapter.window.swan.hideKeyboard({success:function success(res){console.log('隐藏键盘');},fail:function fail(res){console.log("隐藏键盘出错:"+(res?res.errMsg:""));}});}}]);return MiniInput;}();var MiniLoader=/*#__PURE__*/function(_Laya$EventDispatcher2){_inherits(MiniLoader,_Laya$EventDispatcher2);var _super3=_createSuper(MiniLoader);function MiniLoader(){_classCallCheck(this,MiniLoader);return _super3.call(this);}_createClass(MiniLoader,[{key:"_loadResourceFilter",value:function _loadResourceFilter(type,url){var thisLoader=this;this.sourceUrl=Laya.URL.formatURL(url);if(MiniFileMgr.isNetFile(url)){if(MiniFileMgr.loadPath!=""){url=url.split(MiniFileMgr.loadPath)[1];}else{var tempStr=Laya.URL.rootPath!=""?Laya.URL.rootPath:Laya.URL._basePath;var tempUrl=url;if(tempStr!="")url=url.split(tempStr)[1];if(!url){url=tempUrl;}}}if(BMiniAdapter.subNativeFiles&&BMiniAdapter.subNativeheads.length==0){for(var key in BMiniAdapter.subNativeFiles){var tempArr=BMiniAdapter.subNativeFiles[key];BMiniAdapter.subNativeheads=BMiniAdapter.subNativeheads.concat(tempArr);for(var aa=0;aa<tempArr.length;aa++){BMiniAdapter.subMaps[tempArr[aa]]=key+"/"+tempArr[aa];}}}if(BMiniAdapter.subNativeFiles&&url.indexOf("/")!=-1){var curfileHead=url.split("/")[0]+"/";if(curfileHead&&BMiniAdapter.subNativeheads.indexOf(curfileHead)!=-1){var newfileHead=BMiniAdapter.subMaps[curfileHead];url=url.replace(curfileHead,newfileHead);}}switch(type){case Laya.Loader.IMAGE:case"htmlimage":case"nativeimage":MiniLoader._transformImgUrl(url,type,thisLoader);break;case Laya.Loader.SOUND:thisLoader._loadSound(url);break;default:thisLoader._loadResource(type,url);}}},{key:"_loadSound",value:function _loadSound(url){var thisLoader=this;if(!BMiniAdapter.autoCacheFile){MiniLoader.onDownLoadCallBack(url,thisLoader,0);}else{var tempurl=Laya.URL.formatURL(url);if(!MiniFileMgr.isLocalNativeFile(url)&&!MiniFileMgr.getFileInfo(tempurl)){if(MiniFileMgr.isNetFile(tempurl)){MiniFileMgr.downOtherFiles(encodeURI(tempurl),Laya.Handler.create(MiniLoader,MiniLoader.onDownLoadCallBack,[tempurl,thisLoader]),tempurl);}else{MiniLoader.onDownLoadCallBack(url,thisLoader,0);}}else{MiniLoader.onDownLoadCallBack(url,thisLoader,0);}}}},{key:"complete",value:function complete(data){if(data instanceof Laya.Resource){data._setCreateURL(this.sourceUrl);}else if(data instanceof Laya.Texture&&data.bitmap instanceof Laya.Resource){data.bitmap._setCreateURL(this.sourceUrl);}this.originComplete(data);}},{key:"_loadHttpRequestWhat",value:function _loadHttpRequestWhat(url,contentType){var thisLoader=this;var encoding=BMiniAdapter.getUrlEncode(url,contentType);if(Laya.Loader.preLoadedMap[url])thisLoader.onLoaded(Laya.Loader.preLoadedMap[url]);else{var tempurl=Laya.URL.formatURL(url);if(!BMiniAdapter.AutoCacheDownFile){if(MiniFileMgr.isNetFile(tempurl)){thisLoader._loadHttpRequest(tempurl,contentType,thisLoader,thisLoader.onLoaded,thisLoader,thisLoader.onProgress,thisLoader,thisLoader.onError);}else MiniFileMgr.readFile(url,encoding,new Laya.Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[url,contentType,thisLoader]),url);}else{if(!MiniFileMgr.isLocalNativeFile(url)&&!MiniFileMgr.getFileInfo(tempurl)){if(MiniFileMgr.isNetFile(tempurl)){MiniFileMgr.downFiles(encodeURI(tempurl),encoding,new Laya.Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[url,contentType,thisLoader]),tempurl,true);}else{MiniFileMgr.readFile(url,encoding,new Laya.Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[url,contentType,thisLoader]),url);}}else{var tempUrl=url;var fileObj=MiniFileMgr.getFileInfo(tempurl);if(fileObj&&fileObj.md5){tempUrl=fileObj.tempFilePath||MiniFileMgr.getFileNativePath(fileObj.md5);}MiniFileMgr.readFile(tempUrl,encoding,new Laya.Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[url,contentType,thisLoader]),url);}}}}}],[{key:"onDownLoadCallBack",value:function onDownLoadCallBack(sourceUrl,thisLoader,errorCode){var tempFilePath=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;if(!errorCode){var fileNativeUrl;if(BMiniAdapter.autoCacheFile){if(!tempFilePath){if(MiniFileMgr.isLocalNativeFile(sourceUrl)){fileNativeUrl=sourceUrl;}else{var fileObj=MiniFileMgr.getFileInfo(sourceUrl);if(fileObj&&fileObj.md5){fileNativeUrl=fileObj.tempFilePath||MiniFileMgr.getFileNativePath(fileObj.md5);}else{fileNativeUrl=sourceUrl;}}}else{fileNativeUrl=tempFilePath;}}else{fileNativeUrl=Laya.URL.formatURL(sourceUrl);}sourceUrl=fileNativeUrl;var sound=new Laya.SoundManager._soundClass();sound.load(encodeURI(sourceUrl));thisLoader.onLoaded(sound);}else{thisLoader.event(Laya.Event.ERROR,"Load sound failed");}}},{key:"onReadNativeCallBack",value:function onReadNativeCallBack(url){var type=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var thisLoader=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var errorCode=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var data=arguments.length>4&&arguments[4]!==undefined?arguments[4]:null;if(!errorCode){var tempData;if(type==Laya.Loader.JSON||type==Laya.Loader.ATLAS||type==Laya.Loader.PREFAB||type==Laya.Loader.PLF){tempData=BMiniAdapter.getJson(data.data);}else if(type==Laya.Loader.XML){tempData=Laya.Utils.parseXMLFromString(data.data);}else{tempData=data.data;}if(!BMiniAdapter.isZiYu&&BMiniAdapter.isPosMsgYu&&type!=Laya.Loader.BUFFER){BMiniAdapter.window.swan.postMessage({url:url,data:tempData,isLoad:"filedata"});}thisLoader.onLoaded(tempData);}else if(errorCode==1){thisLoader._loadHttpRequest(url,type,thisLoader,thisLoader.onLoaded,thisLoader,thisLoader.onProgress,thisLoader,thisLoader.onError);}}},{key:"_transformImgUrl",value:function _transformImgUrl(url,type,thisLoader){if(BMiniAdapter.isZiYu||MiniFileMgr.isLocalNativeFile(url)){thisLoader._loadImage(url,false);return;}if(!BMiniAdapter.autoCacheFile){thisLoader._loadImage(encodeURI(url));}else{var tempUrl=Laya.URL.formatURL(url);if(!MiniFileMgr.isLocalNativeFile(url)&&!MiniFileMgr.getFileInfo(tempUrl)){if(MiniFileMgr.isNetFile(tempUrl)){MiniFileMgr.downOtherFiles(encodeURI(tempUrl),new Laya.Handler(MiniLoader,MiniLoader.onDownImgCallBack,[url,thisLoader]),tempUrl);}else{MiniLoader.onCreateImage(url,thisLoader,true);}}else{MiniLoader.onCreateImage(url,thisLoader);}}}},{key:"onDownImgCallBack",value:function onDownImgCallBack(sourceUrl,thisLoader,errorCode){var tempFilePath=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";if(!errorCode)MiniLoader.onCreateImage(sourceUrl,thisLoader,false,tempFilePath);else{thisLoader.onError(null);}}},{key:"onCreateImage",value:function onCreateImage(sourceUrl,thisLoader){var isLocal=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var tempFilePath=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var fileNativeUrl;if(BMiniAdapter.autoCacheFile){if(!isLocal){if(tempFilePath!=""){fileNativeUrl=tempFilePath;}else{var fileObj=MiniFileMgr.getFileInfo(Laya.URL.formatURL(sourceUrl));fileNativeUrl=fileObj.tempFilePath||MiniFileMgr.getFileNativePath(fileObj.md5);}}else if(BMiniAdapter.isZiYu){var tempUrl=Laya.URL.formatURL(sourceUrl);if(MiniFileMgr.ziyuFileTextureData[tempUrl]){fileNativeUrl=MiniFileMgr.ziyuFileTextureData[tempUrl];}else fileNativeUrl=sourceUrl;}else fileNativeUrl=sourceUrl;}else{if(!isLocal)fileNativeUrl=tempFilePath;else fileNativeUrl=sourceUrl;}thisLoader._loadImage(fileNativeUrl,false);}}]);return MiniLoader;}(Laya.EventDispatcher);var MiniLocalStorage=/*#__PURE__*/function(){function MiniLocalStorage(){_classCallCheck(this,MiniLocalStorage);}_createClass(MiniLocalStorage,null,[{key:"__init__",value:function __init__(){MiniLocalStorage.items=MiniLocalStorage;}},{key:"setItem",value:function setItem(key,value){try{BMiniAdapter.window.swan.setStorageSync(key,value);}catch(error){BMiniAdapter.window.swan.setStorage({key:key,data:value});}}},{key:"getItem",value:function getItem(key){return BMiniAdapter.window.swan.getStorageSync(key);}},{key:"setJSON",value:function setJSON(key,value){MiniLocalStorage.setItem(key,value);}},{key:"getJSON",value:function getJSON(key){return MiniLocalStorage.getItem(key);}},{key:"removeItem",value:function removeItem(key){BMiniAdapter.window.swan.removeStorageSync(key);}},{key:"clear",value:function clear(){BMiniAdapter.window.swan.clearStorageSync();}},{key:"getStorageInfoSync",value:function getStorageInfoSync(){try{var res=BMiniAdapter.window.swan.getStorageInfoSync();console.log(res.keys);console.log(res.currentSize);console.log(res.limitSize);return res;}catch(e){}return null;}}]);return MiniLocalStorage;}();MiniLocalStorage.support=true;function ImageDataPolyfill(){var width,height,data;if(arguments.length==3){if(arguments[0]instanceof Uint8ClampedArray){if(arguments[0].length%4!==0){throw new Error("Failed to construct 'ImageData': The input data length is not a multiple of 4.");}if(arguments[0].length!==arguments[1]*arguments[2]*4){throw new Error("Failed to construct 'ImageData': The input data length is not equal to (4 * width * height).");}else{data=arguments[0];width=arguments[1];height=arguments[2];}}else{throw new Error("Failed to construct 'ImageData': parameter 1 is not of type 'Uint8ClampedArray'.");}}else if(arguments.length==2){width=arguments[0];height=arguments[1];data=new Uint8ClampedArray(arguments[0]*arguments[1]*4);}else if(arguments.length<2){throw new Error("Failed to construct 'ImageData': 2 arguments required, but only "+arguments.length+" present.");}var imgdata=Laya.Browser.canvas.getContext("2d").getImageData(0,0,width,height);for(var i=0;i<data.length;i+=4){imgdata.data[i]=data[i];imgdata.data[i+1]=data[i+1];imgdata.data[i+2]=data[i+2];imgdata.data[i+3]=data[i+3];}return imgdata;}var BMiniAdapter=/*#__PURE__*/function(){function BMiniAdapter(){_classCallCheck(this,BMiniAdapter);}_createClass(BMiniAdapter,null,[{key:"getJson",value:function getJson(data){return JSON.parse(data);}},{key:"enable",value:function enable(){BMiniAdapter.init(Laya.Laya.isWXPosMsg,Laya.Laya.isWXOpenDataContext);}},{key:"init",value:function init(){var isPosMsg=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;var isSon=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(BMiniAdapter._inited)return;BMiniAdapter._inited=true;BMiniAdapter.window=window;if(!BMiniAdapter.window.hasOwnProperty("swan"))return;if(BMiniAdapter.window.navigator.userAgent.indexOf('SwanGame')<0)return;BMiniAdapter.isZiYu=isSon;BMiniAdapter.isPosMsgYu=isPosMsg;BMiniAdapter.EnvConfig={};if(!BMiniAdapter.isZiYu){MiniFileMgr.setNativeFileDir("/layaairGame");MiniFileMgr.getCacheList(MiniFileMgr.fileNativeDir,Laya.Handler.create(BMiniAdapter,BMiniAdapter.onMkdirCallBack));}BMiniAdapter.systemInfo=BMiniAdapter.window.swan.getSystemInfoSync();BMiniAdapter.window.focus=function(){};Laya.Laya['_getUrlPath']=function(){return"";};BMiniAdapter.window.logtime=function(str){};BMiniAdapter.window.alertTimeLog=function(str){};BMiniAdapter.window.resetShareInfo=function(){};BMiniAdapter.window.CanvasRenderingContext2D=function(){};BMiniAdapter.window.CanvasRenderingContext2D.prototype=BMiniAdapter.window.swan.createCanvas().getContext('2d').__proto__;BMiniAdapter.window.document.body.appendChild=function(){};BMiniAdapter.EnvConfig.pixelRatioInt=0;Laya.Browser["_pixelRatio"]=BMiniAdapter.pixelRatio();BMiniAdapter._preCreateElement=Laya.Browser.createElement;Laya.Browser["createElement"]=BMiniAdapter.createElement;Laya.RunDriver.createShaderCondition=BMiniAdapter.createShaderCondition;Laya.Utils['parseXMLFromString']=BMiniAdapter.parseXMLFromString;Laya.Input['_createInputElement']=MiniInput['_createInputElement'];if(!window.ImageData){window.ImageData=ImageDataPolyfill;}Laya.Loader.prototype._loadResourceFilter=MiniLoader.prototype._loadResourceFilter;Laya.Loader.prototype.originComplete=Laya.Loader.prototype.complete;Laya.Loader.prototype.complete=MiniLoader.prototype.complete;Laya.Loader.prototype._loadSound=MiniLoader.prototype._loadSound;Laya.Loader.prototype._loadHttpRequestWhat=MiniLoader.prototype._loadHttpRequestWhat;Laya.LocalStorage._baseClass=MiniLocalStorage;MiniLocalStorage.__init__();BMiniAdapter.window.swan.onMessage&&BMiniAdapter.window.swan.onMessage(BMiniAdapter._onMessage);}},{key:"_onMessage",value:function _onMessage(data){switch(data.type){case"changeMatrix":Laya.Laya.stage.transform.identity();Laya.Laya.stage._width=data.w;Laya.Laya.stage._height=data.h;Laya.Laya.stage._canvasTransform=new Laya.Matrix(data.a,data.b,data.c,data.d,data.tx,data.ty);break;case"display":Laya.Laya.stage.frameRate=data.rate||Laya.Stage.FRAME_FAST;break;case"undisplay":Laya.Laya.stage.frameRate=Laya.Stage.FRAME_SLEEP;break;}if(data['isLoad']=="opendatacontext"){if(data.url){MiniFileMgr.ziyuFileData[data.url]=data.atlasdata;MiniFileMgr.ziyuFileTextureData[data.imgReadyUrl]=data.imgNativeUrl;}}else if(data['isLoad']=="openJsondatacontext"){if(data.url){MiniFileMgr.ziyuFileData[data.url]=data.atlasdata;}}else if(data['isLoad']=="openJsondatacontextPic"){MiniFileMgr.ziyuFileTextureData[data.imgReadyUrl]=data.imgNativeUrl;}}},{key:"getUrlEncode",value:function getUrlEncode(url,type){if(type=="arraybuffer")return"";return"utf8";}},{key:"downLoadFile",value:function downLoadFile(fileUrl){var fileType=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"";var callBack=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var encoding=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"utf8";var fileObj=MiniFileMgr.getFileInfo(fileUrl);if(!fileObj)MiniFileMgr.downLoadFile(fileUrl,fileType,callBack,encoding);else{callBack!=null&&callBack.runWith([0]);}}},{key:"remove",value:function remove(fileUrl){var callBack=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;MiniFileMgr.deleteFile("",fileUrl,callBack,"",0);}},{key:"removeAll",value:function removeAll(){MiniFileMgr.deleteAll();}},{key:"hasNativeFile",value:function hasNativeFile(fileUrl){return MiniFileMgr.isLocalNativeFile(fileUrl);}},{key:"getFileInfo",value:function getFileInfo(fileUrl){return MiniFileMgr.getFileInfo(fileUrl);}},{key:"getFileList",value:function getFileList(){return MiniFileMgr.filesListObj;}},{key:"exitMiniProgram",value:function exitMiniProgram(){BMiniAdapter.window["swan"].exitMiniProgram();}},{key:"onMkdirCallBack",value:function onMkdirCallBack(errorCode,data){if(!errorCode){MiniFileMgr.filesListObj=JSON.parse(data.data);MiniFileMgr.fakeObj=JSON.parse(data.data);}else{MiniFileMgr.fakeObj={};MiniFileMgr.filesListObj={};}var files=MiniFileMgr.fs.readdirSync(MiniFileMgr.fileNativeDir);if(!files.length)return;var tempMd5ListObj={};var fileObj;for(var key in MiniFileMgr.filesListObj){if(key!="fileUsedSize"){fileObj=MiniFileMgr.filesListObj[key];tempMd5ListObj[fileObj.md5]=fileObj.readyUrl;}}var fileName;for(var i=0,sz=files.length;i<sz;i++){fileName=files[i];if(fileName==MiniFileMgr.fileListName)continue;if(!tempMd5ListObj[fileName]){var deleteFileUrl=MiniFileMgr.getFileNativePath(fileName);MiniFileMgr.fs.unlink({filePath:deleteFileUrl,success:function success(data){console.log("删除无引用的磁盘文件:"+fileName);}});}delete tempMd5ListObj[fileName];}for(var _key in tempMd5ListObj){delete MiniFileMgr.filesListObj[tempMd5ListObj[_key]];delete MiniFileMgr.fakeObj[tempMd5ListObj[_key]];console.log("删除错误记录：",tempMd5ListObj[_key]);}}},{key:"pixelRatio",value:function pixelRatio(){if(!BMiniAdapter.EnvConfig.pixelRatioInt){try{BMiniAdapter.EnvConfig.pixelRatioInt=BMiniAdapter.systemInfo.pixelRatio;return BMiniAdapter.systemInfo.pixelRatio;}catch(error){}}return BMiniAdapter.EnvConfig.pixelRatioInt;}},{key:"createElement",value:function createElement(type){if(type=="canvas"){var _source;if(BMiniAdapter.idx==1){if(BMiniAdapter.isZiYu){_source=BMiniAdapter.window.sharedCanvas;}else{_source=BMiniAdapter.window.canvas;}}else{_source=BMiniAdapter.window.swan.createCanvas();}_source.style={};BMiniAdapter.idx++;return _source;}else if(type=="textarea"||type=="input"){return BMiniAdapter.onCreateInput(type);}else if(type=="div"){var node=BMiniAdapter._preCreateElement(type);node.contains=function(value){return null;};node.removeChild=function(value){};return node;}else{return BMiniAdapter._preCreateElement(type);}}},{key:"onCreateInput",value:function onCreateInput(type){var node=BMiniAdapter._preCreateElement(type);node.focus=MiniInput.wxinputFocus;node.blur=MiniInput.wxinputblur;node.style={};node.value=0;if(!node.parentElement)node.parentElement={};node.placeholder={};node.type={};node.setColor=function(value){};node.setType=function(value){};node.setFontFace=function(value){};node.addEventListener=function(value){};node.contains=function(value){return null;};node.removeChild=function(value){};return node;}},{key:"createShaderCondition",value:function createShaderCondition(conditionScript){var func=function func(){return this[conditionScript.replace("this.","")];};return func;}},{key:"sendAtlasToOpenDataContext",value:function sendAtlasToOpenDataContext(url){if(!BMiniAdapter.isZiYu){var atlasJson=Laya.Loader.getRes(Laya.URL.formatURL(url));if(atlasJson){var textureArr=atlasJson.meta.image.split(",");if(atlasJson.meta&&atlasJson.meta.image){var toloadPics=atlasJson.meta.image.split(",");var split=url.indexOf("/")>=0?"/":"\\";var idx=url.lastIndexOf(split);var folderPath=idx>=0?url.substr(0,idx+1):"";for(var i=0,len=toloadPics.length;i<len;i++){toloadPics[i]=folderPath+toloadPics[i];}}else{toloadPics=[url.replace(".json",".png")];}for(i=0;i<toloadPics.length;i++){var tempAtlasPngUrl=toloadPics[i];BMiniAdapter.postInfoToContext(Laya.Laya.URL.formatURL(url),Laya.Laya.URL.formatURL(tempAtlasPngUrl),atlasJson);}}else{throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";}}}},{key:"postInfoToContext",value:function postInfoToContext(url,atlaspngUrl,atlasJson){var postData={"frames":atlasJson.frames,"meta":atlasJson.meta};var textureUrl=atlaspngUrl;var fileObj=MiniFileMgr.getFileInfo(Laya.URL.formatURL(atlaspngUrl));if(fileObj){var fileNativeUrl=fileObj.tempFilePath||MiniFileMgr.getFileNativePath(fileObj.md5);}else{fileNativeUrl=textureUrl;}if(fileNativeUrl){BMiniAdapter.window.swan.postMessage({url:url,atlasdata:postData,imgNativeUrl:fileNativeUrl,imgReadyUrl:textureUrl,isLoad:"opendatacontext"});}else{throw"获取图集的磁盘url路径不存在！";}}},{key:"sendSinglePicToOpenDataContext",value:function sendSinglePicToOpenDataContext(url){var tempTextureUrl=Laya.URL.formatURL(url);var fileObj=MiniFileMgr.getFileInfo(tempTextureUrl);if(fileObj){var fileNativeUrl=fileObj.tempFilePath||MiniFileMgr.getFileNativePath(fileObj.md5);url=tempTextureUrl;}else{fileNativeUrl=url;}if(fileNativeUrl){url=Laya.Laya.URL.formatURL(url);BMiniAdapter.window.swan.postMessage({url:url,imgNativeUrl:fileNativeUrl,imgReadyUrl:url,isLoad:"openJsondatacontextPic"});}else{throw"获取图集的磁盘url路径不存在！";}}},{key:"sendJsonDataToDataContext",value:function sendJsonDataToDataContext(url){if(!BMiniAdapter.isZiYu){url=Laya.Laya.URL.formatURL(url);var atlasJson=Laya.Loader.getRes(url);if(atlasJson){BMiniAdapter.window.swan.postMessage({url:url,atlasdata:atlasJson,isLoad:"openJsondatacontext"});}else{throw"传递的url没有获取到对应的图集数据信息，请确保图集已经过！";}}}}]);return BMiniAdapter;}();BMiniAdapter._inited=false;BMiniAdapter.autoCacheFile=true;BMiniAdapter.minClearSize=5*1024*1024;BMiniAdapter.sizeLimit=50*1024*1024;BMiniAdapter.nativefiles=["layaNativeDir","wxlocal"];BMiniAdapter.subNativeFiles=[];BMiniAdapter.subNativeheads=[];BMiniAdapter.subMaps=[];BMiniAdapter.AutoCacheDownFile=false;BMiniAdapter.parseXMLFromString=function(value){var rst;value=value.replace(/>\s+</g,'><');try{rst=new BMiniAdapter.window.Parser.DOMParser().parseFromString(value,'text/xml');}catch(error){throw"需要引入xml解析库文件";}return rst;};BMiniAdapter.idx=1;var MiniAccelerator=/*#__PURE__*/function(_Laya$EventDispatcher3){_inherits(MiniAccelerator,_Laya$EventDispatcher3);var _super4=_createSuper(MiniAccelerator);function MiniAccelerator(){_classCallCheck(this,MiniAccelerator);return _super4.call(this);}_createClass(MiniAccelerator,[{key:"on",value:function on(type,caller,listener){var args=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;_get(_getPrototypeOf(MiniAccelerator.prototype),"on",this).call(this,type,caller,listener,args);MiniAccelerator.startListen(this["onDeviceOrientationChange"]);return this;}},{key:"off",value:function off(type,caller,listener){var onceOnly=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;if(!this.hasListener(type))MiniAccelerator.stopListen();return _get(_getPrototypeOf(MiniAccelerator.prototype),"off",this).call(this,type,caller,listener,onceOnly);}}],[{key:"__init__",value:function __init__(){try{var Acc;Acc=Laya.Accelerator;if(!Acc)return;Acc["prototype"]["on"]=MiniAccelerator["prototype"]["on"];Acc["prototype"]["off"]=MiniAccelerator["prototype"]["off"];}catch(e){}}},{key:"startListen",value:function startListen(callBack){MiniAccelerator._callBack=callBack;if(MiniAccelerator._isListening)return;MiniAccelerator._isListening=true;try{BMiniAdapter.window.swan.onAccelerometerChange(MiniAccelerator.onAccelerometerChange);}catch(e){}}},{key:"stopListen",value:function stopListen(){MiniAccelerator._isListening=false;try{BMiniAdapter.window.swan.stopAccelerometer({});}catch(e){}}},{key:"onAccelerometerChange",value:function onAccelerometerChange(res){var e;e={};e.acceleration=res;e.accelerationIncludingGravity=res;e.rotationRate={};if(MiniAccelerator._callBack!=null){MiniAccelerator._callBack(e);}}}]);return MiniAccelerator;}(Laya.EventDispatcher);MiniAccelerator._isListening=false;var MiniImage=/*#__PURE__*/function(){function MiniImage(){_classCallCheck(this,MiniImage);}_createClass(MiniImage,[{key:"_loadImage",value:function _loadImage(url){var thisLoader=this;if(BMiniAdapter.isZiYu){MiniImage.onCreateImage(url,thisLoader,true);return;}var isTransformUrl;if(!MiniFileMgr.isLocalNativeFile(url)){isTransformUrl=true;url=Laya.URL.formatURL(url);}else{if(url.indexOf("http://usr/")==-1&&(url.indexOf("http://")!=-1||url.indexOf("https://")!=-1)){if(MiniFileMgr.loadPath!=""){url=url.split(MiniFileMgr.loadPath)[1];}else{var tempStr=Laya.URL.rootPath!=""?Laya.URL.rootPath:Laya.URL._basePath;var tempUrl=url;if(tempStr!="")url=url.split(tempStr)[1];if(!url){url=tempUrl;}}}if(BMiniAdapter.subNativeFiles&&BMiniAdapter.subNativeheads.length==0){for(var key in BMiniAdapter.subNativeFiles){var tempArr=BMiniAdapter.subNativeFiles[key];BMiniAdapter.subNativeheads=BMiniAdapter.subNativeheads.concat(tempArr);for(var aa=0;aa<tempArr.length;aa++){BMiniAdapter.subMaps[tempArr[aa]]=key+"/"+tempArr[aa];}}}if(BMiniAdapter.subNativeFiles&&url.indexOf("/")!=-1){var curfileHead=url.split("/")[0]+"/";if(curfileHead&&BMiniAdapter.subNativeheads.indexOf(curfileHead)!=-1){var newfileHead=BMiniAdapter.subMaps[curfileHead];url=url.replace(curfileHead,newfileHead);}}}if(!MiniFileMgr.getFileInfo(url)){if(url.indexOf('http://usr/')==-1&&(url.indexOf("http://")!=-1||url.indexOf("https://")!=-1)){if(BMiniAdapter.isZiYu){MiniImage.onCreateImage(url,thisLoader,true);}else{MiniFileMgr.downOtherFiles(url,new Laya.Handler(MiniImage,MiniImage.onDownImgCallBack,[url,thisLoader]),url);}}else MiniImage.onCreateImage(url,thisLoader,true);}else{MiniImage.onCreateImage(url,thisLoader,!isTransformUrl);}}}],[{key:"onDownImgCallBack",value:function onDownImgCallBack(sourceUrl,thisLoader,errorCode){var tempFilePath=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";if(!errorCode)MiniImage.onCreateImage(sourceUrl,thisLoader,false,tempFilePath);else{thisLoader.onError(null);}}},{key:"onCreateImage",value:function onCreateImage(sourceUrl,thisLoader){var isLocal=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var tempFilePath=arguments.length>3&&arguments[3]!==undefined?arguments[3]:"";var fileNativeUrl;if(BMiniAdapter.autoCacheFile){if(!isLocal){if(tempFilePath!=""){fileNativeUrl=tempFilePath;}else{var fileObj=MiniFileMgr.getFileInfo(sourceUrl);var fileMd5Name=fileObj.md5;fileNativeUrl=MiniFileMgr.getFileNativePath(fileMd5Name);}}else if(BMiniAdapter.isZiYu){var tempUrl=Laya.URL.formatURL(sourceUrl);if(MiniFileMgr.ziyuFileTextureData[tempUrl]){fileNativeUrl=MiniFileMgr.ziyuFileTextureData[tempUrl];}else fileNativeUrl=sourceUrl;}else fileNativeUrl=sourceUrl;}else{if(!isLocal)fileNativeUrl=tempFilePath;else fileNativeUrl=sourceUrl;}if(thisLoader._imgCache==null)thisLoader._imgCache={};var image;function clear(){var img=thisLoader._imgCache[fileNativeUrl];if(img){img.onload=null;img.onerror=null;delete thisLoader._imgCache[fileNativeUrl];}}var onerror=function onerror(){clear();delete MiniFileMgr.fakeObj[sourceUrl];delete MiniFileMgr.filesListObj[sourceUrl];thisLoader.event(Laya.Event.ERROR,"Load image failed");};if(thisLoader._type=="nativeimage"){var onload=function onload(){clear();thisLoader.onLoaded(image);};image=new Laya.Browser.window.Image();image.crossOrigin="";image.onload=onload;image.onerror=onerror;image.src=fileNativeUrl;thisLoader._imgCache[fileNativeUrl]=image;}else{var imageSource=new Laya.Browser.window.Image();onload=function onload(){image=Laya.HTMLImage.create(imageSource.width,imageSource.height);image.loadImageSource(imageSource,true);image._setCreateURL(fileNativeUrl);clear();thisLoader.onLoaded(image);};imageSource.crossOrigin="";imageSource.onload=onload;imageSource.onerror=onerror;imageSource.src=fileNativeUrl;thisLoader._imgCache[fileNativeUrl]=imageSource;}}}]);return MiniImage;}();var MiniLocation=/*#__PURE__*/function(){function MiniLocation(){_classCallCheck(this,MiniLocation);}_createClass(MiniLocation,null,[{key:"__init__",value:function __init__(){BMiniAdapter.window.navigator.geolocation.getCurrentPosition=MiniLocation.getCurrentPosition;BMiniAdapter.window.navigator.geolocation.watchPosition=MiniLocation.watchPosition;BMiniAdapter.window.navigator.geolocation.clearWatch=MiniLocation.clearWatch;}},{key:"getCurrentPosition",value:function getCurrentPosition(){var success=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var error=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;var paramO;paramO={};paramO.success=getSuccess;paramO.fail=error;BMiniAdapter.window.swan.getLocation(paramO);function getSuccess(res){if(success!=null){success(res);}}}},{key:"watchPosition",value:function watchPosition(){var success=arguments.length>0&&arguments[0]!==undefined?arguments[0]:null;var error=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;var options=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;MiniLocation._curID++;var curWatchO;curWatchO={};curWatchO.success=success;curWatchO.error=error;MiniLocation._watchDic[MiniLocation._curID]=curWatchO;Laya.Laya.systemTimer.loop(1000,null,MiniLocation._myLoop);return MiniLocation._curID;}},{key:"clearWatch",value:function clearWatch(id){delete MiniLocation._watchDic[id];if(!MiniLocation._hasWatch()){Laya.Laya.systemTimer.clear(null,MiniLocation._myLoop);}}},{key:"_hasWatch",value:function _hasWatch(){var key;for(key in MiniLocation._watchDic){if(MiniLocation._watchDic[key])return true;}return false;}},{key:"_myLoop",value:function _myLoop(){MiniLocation.getCurrentPosition(MiniLocation._mySuccess,MiniLocation._myError);}},{key:"_mySuccess",value:function _mySuccess(res){var rst={};rst.coords=res;rst.timestamp=Laya.Browser.now();var key;for(key in MiniLocation._watchDic){if(MiniLocation._watchDic[key].success){MiniLocation._watchDic[key].success(rst);}}}},{key:"_myError",value:function _myError(res){var key;for(key in MiniLocation._watchDic){if(MiniLocation._watchDic[key].error){MiniLocation._watchDic[key].error(res);}}}}]);return MiniLocation;}();MiniLocation._watchDic={};MiniLocation._curID=0;var MiniVideo=/*#__PURE__*/function(){function MiniVideo(){var width=arguments.length>0&&arguments[0]!==undefined?arguments[0]:320;var height=arguments.length>1&&arguments[1]!==undefined?arguments[1]:240;_classCallCheck(this,MiniVideo);this.videoend=false;this.videourl="";this.videoElement=BMiniAdapter.window.swan.createVideo({width:width,height:height,autoplay:true});}_createClass(MiniVideo,[{key:"on",value:function on(eventType,ths,callBack){if(eventType=="loadedmetadata"){this.onPlayFunc=callBack.bind(ths);this.videoElement.onPlay=this.onPlayFunction.bind(this);}else if(eventType=="ended"){this.onEndedFunC=callBack.bind(ths);this.videoElement.onEnded=this.onEndedFunction.bind(this);}this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this);}},{key:"onTimeUpdateFunc",value:function onTimeUpdateFunc(data){this.position=data.position;this._duration=data.duration;}},{key:"onPlayFunction",value:function onPlayFunction(){if(this.videoElement)this.videoElement.readyState=200;console.log("=====视频加载完成========");this.onPlayFunc!=null&&this.onPlayFunc();}},{key:"onEndedFunction",value:function onEndedFunction(){if(!this.videoElement)return;this.videoend=true;console.log("=====视频播放完毕========");this.onEndedFunC!=null&&this.onEndedFunC();}},{key:"off",value:function off(eventType,ths,callBack){if(eventType=="loadedmetadata"){this.onPlayFunc=callBack.bind(ths);this.videoElement.offPlay=this.onPlayFunction.bind(this);}else if(eventType=="ended"){this.onEndedFunC=callBack.bind(ths);this.videoElement.offEnded=this.onEndedFunction.bind(this);}}},{key:"load",value:function load(url){if(!this.videoElement)return;this.videoElement.src=url;}},{key:"play",value:function play(){if(!this.videoElement)return;this.videoend=false;this.videoElement.play();}},{key:"pause",value:function pause(){if(!this.videoElement)return;this.videoend=true;this.videoElement.pause();}},{key:"size",value:function size(width,height){if(!this.videoElement)return;this.videoElement.width=width;this.videoElement.height=height;}},{key:"destroy",value:function destroy(){if(this.videoElement)this.videoElement.destroy();this.videoElement=null;this.onEndedFunC=null;this.onPlayFunc=null;this.videoend=false;this.videourl=null;}},{key:"reload",value:function reload(){if(!this.videoElement)return;this.videoElement.src=this.videourl;}},{key:"duration",get:function get(){return this._duration;}},{key:"currentTime",get:function get(){if(!this.videoElement)return 0;return this.videoElement.initialTime;},set:function set(value){if(!this.videoElement)return;this.videoElement.initialTime=value;}},{key:"videoWidth",get:function get(){if(!this.videoElement)return 0;return this.videoElement.width;}},{key:"videoHeight",get:function get(){if(!this.videoElement)return 0;return this.videoElement.height;}},{key:"ended",get:function get(){return this.videoend;}},{key:"loop",get:function get(){if(!this.videoElement)return false;return this.videoElement.loop;},set:function set(value){if(!this.videoElement)return;this.videoElement.loop=value;}},{key:"playbackRate",get:function get(){if(!this.videoElement)return 0;return this.videoElement.playbackRate;},set:function set(value){if(!this.videoElement)return;this.videoElement.playbackRate=value;}},{key:"muted",get:function get(){if(!this.videoElement)return false;return this.videoElement.muted;},set:function set(value){if(!this.videoElement)return;this.videoElement.muted=value;}},{key:"paused",get:function get(){if(!this.videoElement)return false;return this.videoElement.paused;}},{key:"x",get:function get(){if(!this.videoElement)return 0;return this.videoElement.x;},set:function set(value){if(!this.videoElement)return;this.videoElement.x=value;}},{key:"y",get:function get(){if(!this.videoElement)return 0;return this.videoElement.y;},set:function set(value){if(!this.videoElement)return;this.videoElement.y=value;}},{key:"currentSrc",get:function get(){return this.videoElement.src;}}],[{key:"__init__",value:function __init__(){}}]);return MiniVideo;}();exports.BMiniAdapter=BMiniAdapter;exports.ImageDataPolyfill=ImageDataPolyfill;exports.MiniAccelerator=MiniAccelerator;exports.MiniFileMgr=MiniFileMgr;exports.MiniImage=MiniImage;exports.MiniInput=MiniInput;exports.MiniLoader=MiniLoader;exports.MiniLocalStorage=MiniLocalStorage;exports.MiniLocation=MiniLocation;exports.MiniSound=MiniSound;exports.MiniSoundChannel=MiniSoundChannel;exports.MiniVideo=MiniVideo;};
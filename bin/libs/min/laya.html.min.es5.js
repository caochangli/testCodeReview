"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function set(e,t,i,n){return(set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(e,t,i,n){var s,r=_superPropBase(e,t);if(r){if((s=Object.getOwnPropertyDescriptor(r,t)).set)return s.set.call(n,i),!0;if(!s.writable)return!1}if(s=Object.getOwnPropertyDescriptor(n,t)){if(!s.writable)return!1;s.value=i,Object.defineProperty(n,t,s)}else _defineProperty(n,t,i);return!0})(e,t,i,n)}function _set(e,t,i,n,s){if(!set(e,t,i,n||e)&&s)throw new Error("failed to set property");return i}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function _get(e,t,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=_superPropBase(e,t);if(n){var s=Object.getOwnPropertyDescriptor(n,t);return s.get?s.get.call(i):s.value}})(e,t,i||e)}function _superPropBase(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function _createSuper(e){var t=_isNativeReflectConstruct();return function(){var i,n=_getPrototypeOf(e);if(t){var s=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,s)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(e,t){return!t||"object"!==_typeof(t)&&"function"!=typeof t?_assertThisInitialized(e):t}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}!function(e,t){var i=function(){function HTMLExtendStyle(){_classCallCheck(this,HTMLExtendStyle),this.reset()}return _createClass(HTMLExtendStyle,[{key:"reset",value:function(){return this.stroke=0,this.strokeColor="#000000",this.leading=0,this.lineHeight=0,this.letterSpacing=0,this.href=null,this}},{key:"recover",value:function(){this!=HTMLExtendStyle.EMPTY&&t.Pool.recover("HTMLExtendStyle",this.reset())}}],[{key:"create",value:function(){return t.Pool.getItemByClass("HTMLExtendStyle",HTMLExtendStyle)}}]),HTMLExtendStyle}();i.EMPTY=new i,t.ClassUtils.regClass("laya.html.utils.HTMLExtendStyle",i),t.ClassUtils.regClass("Laya.HTMLExtendStyle",i);var n=function(){function HTMLStyle(){_classCallCheck(this,HTMLStyle),this.padding=HTMLStyle._PADDING,this.reset()}return _createClass(HTMLStyle,[{key:"_getExtendStyle",value:function(){return this._extendStyle===i.EMPTY&&(this._extendStyle=i.create()),this._extendStyle}},{key:"reset",value:function(){return this.ower=null,this._type=0,this.wordWrap=!0,this.fontSize=t.ILaya.Text.defaultFontSize,this.family=t.ILaya.Text.defaultFont,this.color="#000000",this.valign=HTMLStyle.VALIGN_TOP,this.padding=HTMLStyle._PADDING,this.bold=!1,this.italic=!1,this.align=HTMLStyle.ALIGN_LEFT,this.textDecoration="none",this.bgColor=null,this.borderColor=null,this._extendStyle&&this._extendStyle.recover(),this._extendStyle=i.EMPTY,this}},{key:"recover",value:function(){t.Pool.recover("HTMLStyle",this.reset())}},{key:"inherit",value:function(e){var t,i,n,s;for(i=(n=HTMLStyle._inheritProps).length,t=0;t<i;t++)this[s=n[t]]=e[s]}},{key:"_widthAuto",value:function(){return 0!=(this._type&HTMLStyle._WIDTHAUTO)}},{key:"widthed",value:function(e){return 0!=(this._type&HTMLStyle._WIDTH_SET)}},{key:"_calculation",value:function(e,t){return!1}},{key:"heighted",value:function(e){return 0!=(this._type&HTMLStyle._HEIGHT_SET)}},{key:"size",value:function(e,t){var i=this.ower,n=!1;-1!==e&&e!=i.width&&(this._type|=HTMLStyle._WIDTH_SET,i.width=e,n=!0),-1!==t&&t!=i.height&&(this._type|=HTMLStyle._HEIGHT_SET,i.height=t,n=!0),n&&i._layoutLater()}},{key:"getLineElement",value:function(){return 0!=(this._type&HTMLStyle._LINE_ELEMENT)}},{key:"setLineElement",value:function(e){e?this._type|=HTMLStyle._LINE_ELEMENT:this._type&=~HTMLStyle._LINE_ELEMENT}},{key:"_enableLayout",value:function(){return 0==(this._type&HTMLStyle._DISPLAY_NONE)&&0==(this._type&HTMLStyle._ABSOLUTE)}},{key:"cssText",value:function(e){this.attrs(HTMLStyle.parseOneCSS(e,";"))}},{key:"attrs",value:function(e){if(e)for(var t=0,i=e.length;t<i;t++){var n=e[t];this[n[0]]=n[1]}}},{key:"href",get:function(){return this._extendStyle.href},set:function(e){e!==this._extendStyle.href&&(this._getExtendStyle().href=e)}},{key:"stroke",get:function(){return this._extendStyle.stroke},set:function(e){this._extendStyle.stroke!==e&&(this._getExtendStyle().stroke=e)}},{key:"strokeColor",get:function(){return this._extendStyle.strokeColor},set:function(e){this._extendStyle.strokeColor!==e&&(this._getExtendStyle().strokeColor=e)}},{key:"leading",get:function(){return this._extendStyle.leading},set:function(e){this._extendStyle.leading!==e&&(this._getExtendStyle().leading=e)}},{key:"lineHeight",get:function(){return this._extendStyle.lineHeight},set:function(e){this._extendStyle.lineHeight!==e&&(this._getExtendStyle().lineHeight=e)}},{key:"align",set:function(e){e in HTMLStyle.alignVDic&&(this._type&=~HTMLStyle._ALIGN,this._type|=HTMLStyle.alignVDic[e])},get:function(){var e=this._type&HTMLStyle._ALIGN;return HTMLStyle.align_Value[e]}},{key:"valign",set:function(e){e in HTMLStyle.alignVDic&&(this._type&=~HTMLStyle._VALIGN,this._type|=HTMLStyle.alignVDic[e])},get:function(){var e=this._type&HTMLStyle._VALIGN;return HTMLStyle.vAlign_Value[e]}},{key:"font",set:function(e){for(var t=e.split(" "),i=0,n=t.length;i<n;i++){var s=t[i];switch(s){case"italic":this.italic=!0;continue;case"bold":this.bold=!0;continue}s.indexOf("px")>0&&(this.fontSize=parseInt(s),this.family=t[i+1],i++)}},get:function(){return(this.italic?"italic ":"")+(this.bold?"bold ":"")+this.fontSize+"px "+(t.ILaya.Browser.onIPhone&&t.ILaya.Text.fontFamilyMap[this.family]||this.family)}},{key:"block",set:function(e){e?this._type|=HTMLStyle._CSS_BLOCK:this._type&=~HTMLStyle._CSS_BLOCK},get:function(){return 0!=(this._type&HTMLStyle._CSS_BLOCK)}},{key:"wordWrap",get:function(){return 0==(this._type&HTMLStyle._NOWARP)},set:function(e){e?this._type&=~HTMLStyle._NOWARP:this._type|=HTMLStyle._NOWARP}},{key:"bold",get:function(){return 0!=(this._type&HTMLStyle._BOLD)},set:function(e){e?this._type|=HTMLStyle._BOLD:this._type&=~HTMLStyle._BOLD}},{key:"fontWeight",get:function(){return this._type&HTMLStyle._BOLD?"bold":"none"},set:function(e){"bold"==e?this._type|=HTMLStyle._BOLD:this._type&=~HTMLStyle._BOLD}},{key:"italic",get:function(){return 0!=(this._type&HTMLStyle._ITALIC)},set:function(e){e?this._type|=HTMLStyle._ITALIC:this._type&=~HTMLStyle._ITALIC}},{key:"whiteSpace",set:function(e){"nowrap"===e&&(this._type|=HTMLStyle._NOWARP),"none"===e&&(this._type&=~HTMLStyle._NOWARP)},get:function(){return this._type&HTMLStyle._NOWARP?"nowrap":""}},{key:"width",set:function(e){if(this._type|=HTMLStyle._WIDTH_SET,"string"==typeof e){var t=e.indexOf("auto");if(t>=0&&(this._type|=HTMLStyle._WIDTHAUTO,e=e.substr(0,t)),this._calculation("width",e))return;e=parseInt(e)}this.size(e,-1)}},{key:"height",set:function(e){if(this._type|=HTMLStyle._HEIGHT_SET,"string"==typeof e){if(this._calculation("height",e))return;e=parseInt(e)}this.size(-1,e)}},{key:"letterSpacing",get:function(){return this._extendStyle.letterSpacing},set:function(e){"string"==typeof e&&(e=parseInt(e+"")),e!=this._extendStyle.letterSpacing&&(this._getExtendStyle().letterSpacing=e)}},{key:"position",set:function(e){"absolute"===e?this._type|=HTMLStyle._ABSOLUTE:this._type&=~HTMLStyle._ABSOLUTE},get:function(){return this._type&HTMLStyle._ABSOLUTE?"absolute":""}},{key:"absolute",get:function(){return 0!=(this._type&HTMLStyle._ABSOLUTE)}},{key:"paddingLeft",get:function(){return this.padding[3]}},{key:"paddingTop",get:function(){return this.padding[0]}}],[{key:"create",value:function(){return t.Pool.getItemByClass("HTMLStyle",HTMLStyle)}},{key:"parseOneCSS",value:function(e,t){for(var i,n=[],s=e.split(t),r=0,l=s.length;r<l;r++){var a=s[r],h=a.indexOf(":"),o=a.substr(0,h).replace(/^\s+|\s+$/g,"");if(0!==o.length){var u=a.substr(h+1).replace(/^\s+|\s+$/g,""),c=[o,u];switch(o){case"italic":case"bold":c[1]="true"==u;break;case"font-weight":"bold"==u&&(c[1]=!0,c[0]="bold");break;case"line-height":c[0]="lineHeight",c[1]=parseInt(u);break;case"font-size":c[0]="fontSize",c[1]=parseInt(u);break;case"stroke":c[0]="stroke",c[1]=parseInt(u);break;case"padding":(i=u.split(" ")).length>1||(i[1]=i[2]=i[3]=i[0]),c[1]=[parseInt(i[0]),parseInt(i[1]),parseInt(i[2]),parseInt(i[3])];break;default:(c[0]=HTMLStyle._CSSTOVALUE[o])||(c[0]=o)}n.push(c)}}return n}},{key:"parseCSS",value:function(e,t){for(var i;null!=(i=HTMLStyle._parseCSSRegExp.exec(e));)HTMLStyle.styleSheets[i[1]]=HTMLStyle.parseOneCSS(i[2],";")}}]),HTMLStyle}();n._CSSTOVALUE={"letter-spacing":"letterSpacing","white-space":"whiteSpace","line-height":"lineHeight","font-family":"family","vertical-align":"valign","text-decoration":"textDecoration","background-color":"bgColor","border-color":"borderColor"},n._parseCSSRegExp=new RegExp("([.#]\\w+)\\s*{([\\s\\S]*?)}","g"),n._inheritProps=["italic","align","valign","leading","letterSpacing","stroke","strokeColor","bold","fontWeight","fontSize","lineHeight","wordWrap","color","family"],n.ALIGN_LEFT="left",n.ALIGN_CENTER="center",n.ALIGN_RIGHT="right",n.VALIGN_TOP="top",n.VALIGN_MIDDLE="middle",n.VALIGN_BOTTOM="bottom",n.styleSheets={},n.ADDLAYOUTED=512,n._PADDING=[0,0,0,0],n._HEIGHT_SET=8192,n._LINE_ELEMENT=65536,n._NOWARP=131072,n._WIDTHAUTO=262144,n._BOLD=1024,n._ITALIC=2048,n._CSS_BLOCK=1,n._DISPLAY_NONE=2,n._ABSOLUTE=4,n._WIDTH_SET=8,n.alignVDic={left:0,center:16,right:32,top:0,middle:64,bottom:128},n.align_Value={0:"left",16:"center",32:"right"},n.vAlign_Value={0:"top",64:"middle",128:"bottom"},n._ALIGN=48,n._VALIGN=192,t.ClassUtils.regClass("laya.html.utils.HTMLStyle",n),t.ClassUtils.regClass("Laya.HTMLStyle",n);var s=function(){function HTMLDocument(){_classCallCheck(this,HTMLDocument),this.all={},this.styleSheets=n.styleSheets}return _createClass(HTMLDocument,[{key:"getElementById",value:function(e){return this.all[e]}},{key:"setElementById",value:function(e,t){this.all[e]=t}}]),HTMLDocument}();s.document=new s,t.ClassUtils.regClass("laya.html.dom.HTMLDocument",s),t.ClassUtils.regClass("Laya.HTMLDocument",s);var r=function(){function HTMLHitRect(){_classCallCheck(this,HTMLHitRect),this.rec=new t.Rectangle,this.reset()}return _createClass(HTMLHitRect,[{key:"reset",value:function(){return this.rec.reset(),this.href=null,this}},{key:"recover",value:function(){t.Pool.recover("HTMLHitRect",this.reset())}}],[{key:"create",value:function(){return t.Pool.getItemByClass("HTMLHitRect",HTMLHitRect)}}]),HTMLHitRect}();t.ClassUtils.regClass("laya.html.dom.HTMLHitRect",r),t.ClassUtils.regClass("Laya.HTMLHitRect",r);var l=function IHtml(){_classCallCheck(this,IHtml)};l.HTMLDivElement=null,l.HTMLImageElement=null,l.HTMLBrElement=null,l.HTMLDivParser=null,l.HTMLParse=null,l.HTMLElementType=null;var a=function(){function LayoutLine(){_classCallCheck(this,LayoutLine),this.elements=[],this.x=0,this.y=0,this.w=0,this.h=0,this.wordStartIndex=0,this.minTextHeight=99999,this.mWidth=0}return _createClass(LayoutLine,[{key:"updatePos",value:function(e,t,i,s,r,a,h){var o,u=0;this.elements.length>0&&(u=(o=this.elements[this.elements.length-1]).x+o.width-this.elements[0].x),h=h||this.h;var c,y=0;r===n.ALIGN_CENTER&&(y=(t-u)/2),r===n.ALIGN_RIGHT&&(y=t-u);for(var _=0,f=this.elements.length;_<f;_++){var d=(o=this.elements[_])._getCSSStyle();switch(0!==y&&(o.x+=y),d.valign){case"top":o.y=s;break;case"middle":var L=0;99999!=this.minTextHeight&&(L=this.minTextHeight);var g=(L+h)/2;g=Math.max(g,this.h),c=(o.eletype,l.HTMLElementType.IMAGE,s+g-o.height),o.y=c;break;case"bottom":o.y=s+(h-o.height)}}}}]),LayoutLine}();t.ClassUtils.regClass("laya.html.utils.LayoutLine",a),t.ClassUtils.regClass("Laya.LayoutLine",a);var h,o=function(){function Layout(){_classCallCheck(this,Layout)}return _createClass(Layout,null,[{key:"later",value:function(e){null==Layout._will&&(Layout._will=[],t.ILaya.stage.frameLoop(1,null,function(){if(!(Layout._will.length<1)){for(var e=0;e<Layout._will.length;e++)Layout.layout(Layout._will[e]);Layout._will.length=0}})),Layout._will.push(e)}},{key:"layout",value:function(e){return e&&e._style?0==(e._style._type&n.ADDLAYOUTED)?null:(e.style._type&=~n.ADDLAYOUTED,Layout._multiLineLayout(e)):null}},{key:"_multiLineLayout",value:function(e){var t=[];e._addChildsToLayout(t);var i,s,r,h,o,u,c,y=t.length,_=e._getCSSStyle(),f=_.letterSpacing,d=_.leading,L=_.lineHeight,g=_._widthAuto()||!_.wordWrap,p=g?999999:e.width,T=(e.height,0),m=_.italic?_.fontSize/3:0,H=_.align,v=_.valign,M=v!==n.VALIGN_TOP||H!==n.ALIGN_LEFT||0!=L,S=0,C=0,E=0,k=0,w=[],x=w[0]=new a,I=!1;x.h=0,_.italic&&(p-=_.fontSize/3);var P=0,b=!0;function addLine(){x.y=C,C+=x.h+d,x.mWidth=P,P=0,x=new a,w.push(x),x.h=0,S=0,b=!0,o=!1}for(i=0;i<y;i++)if(null!=(s=t[i]))if(b=!1,s instanceof l.HTMLBrElement)addLine(),x.y=C,x.h=L;else{if(s._isChar()){if(E=(u=s).width+u.style.letterSpacing,k=u.height,u.isWord)o=I||"\n"===u.char,x.wordStartIndex=x.elements.length;else{if(w.length>0&&S+E>p&&x.wordStartIndex>0){var D;D=x.elements.length-x.wordStartIndex+1,x.elements.length=x.wordStartIndex,i-=D,addLine();continue}o=!1,P+=u.width}I=!1,(o=o||S+E>p)&&addLine(),x.minTextHeight=Math.min(x.minTextHeight,s.height)}else r=s._getCSSStyle(),c=s,h=r.padding,o=I||r.getLineElement(),E=c.width+h[1]+h[3]+r.letterSpacing,k=c.height+h[0]+h[2],I=r.getLineElement(),(o=o||S+E>p&&r.wordWrap)&&addLine();x.elements.push(s),x.h=Math.max(x.h,k),s.x=S,s.y=C,S+=E,x.w=S-f,x.y=C,T=Math.max(S+m,T)}else b||(S+=Layout.DIV_ELEMENT_PADDING),x.wordStartIndex=x.elements.length;if(C=x.y+x.h,M){var R=0,O=p;for(g&&e.width>0&&(O=e.width),i=0,y=w.length;i<y;i++)w[i].updatePos(0,O,i,R,H,v,L),R+=Math.max(L,w[i].h+d);C=R}return g&&(e.width=T),C>e.height&&(e.height=C),[T,C]}}]),Layout}();o.DIV_ELEMENT_PADDING=0,t.ClassUtils.regClass("laya.html.utils.Layout",o),t.ClassUtils.regClass("Laya.Layout",o),(h=e.HTMLElementType||(e.HTMLElementType={}))[h.BASE=0]="BASE",h[h.IMAGE=1]="IMAGE";var u=function(){function HTMLElement(){_classCallCheck(this,HTMLElement),this.eletype=e.HTMLElementType.BASE,this._creates(),this.reset()}return _createClass(HTMLElement,[{key:"_creates",value:function(){this._style=n.create()}},{key:"reset",value:function(){if(this.URI=null,this.parent=null,this._style.reset(),this._style.ower=this,this._style.valign="middle",this._text&&this._text.words){var e,t,i,n=this._text.words;for(t=n.length,e=0;e<t;e++)(i=n[e])&&i.recover()}return this._text=HTMLElement._EMPTYTEXT,this._children&&(this._children.length=0),this._x=this._y=this._width=this._height=0,this}},{key:"_getCSSStyle",value:function(){return this._style}},{key:"_addChildsToLayout",value:function(e){var t=this._getWords();if(null==t&&(!this._children||0==this._children.length))return!1;if(t)for(var i=0,n=t.length;i<n;i++)e.push(t[i]);return this._children&&this._children.forEach(function(t,i,n){var s=t._style;s&&s._enableLayout&&s._enableLayout()&&t._addToLayout(e)}),!0}},{key:"_addToLayout",value:function(e){if(this._style){var t=this._style;t.absolute||(t.block?e.push(this):this._addChildsToLayout(e)&&(this.x=this.y=0))}}},{key:"repaint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.parentRepaint(e)}},{key:"parentRepaint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.parent&&this.parent.repaint(e)}},{key:"_setParent",value:function(e){if(e instanceof HTMLElement){var t=e;this.URI||(this.URI=t.URI),this.style&&this.style.inherit(t.style)}}},{key:"appendChild",value:function(e){return this.addChild(e)}},{key:"addChild",value:function(e){return e.parent&&e.parent.removeChild(e),this._children||(this._children=[]),this._children.push(e),e.parent=this,e._setParent(this),this.repaint(),e}},{key:"removeChild",value:function(e){if(!this._children)return null;var t,i;for(i=this._children.length,t=0;t<i;t++)if(this._children[t]==e)return this._children.splice(t,1),e;return null}},{key:"destroy",value:function(){this._children&&(this.destroyChildren(),this._children.length=0),t.Pool.recover(HTMLElement.getClassName(this),this.reset())}},{key:"destroyChildren",value:function(){if(this._children){for(var e=this._children.length-1;e>-1;e--)this._children[e].destroy();this._children.length=0}}},{key:"_getWords",value:function(){if(!this._text)return null;var e=this._text.text;if(!e||0===e.length)return null;var i,n=this._text.words;if(n&&n.length===e.length)return n;null===n&&(this._text.words=n=[]),n.length=e.length;for(var s=this.style,r=s.font,l=0,a=e.length;l<a;l++)i=t.ILaya.Browser.measureText(e.charAt(l),r),n[l]=t.HTMLChar.create().setData(e.charAt(l),i.width,i.height||s.fontSize,s);return n}},{key:"_isChar",value:function(){return!1}},{key:"_layoutLater",value:function(){var e=this.style;e._type&n.ADDLAYOUTED||(e.widthed(this)&&(this._children&&this._children.length>0||null!=this._getWords())&&e.block?(o.later(this),e._type|=n.ADDLAYOUTED):this.parent&&this.parent._layoutLater())}},{key:"_setAttributes",value:function(e,t){switch(e){case"style":this.style.cssText(t);break;case"class":this.className=t;break;case"x":this.x=parseFloat(t);break;case"y":this.y=parseFloat(t);break;case"width":this.width=parseFloat(t);break;case"height":this.height=parseFloat(t);break;default:this[e]=t}}},{key:"formatURL",value:function(e){return this.URI?HTMLElement.formatURL1(e,this.URI?this.URI.path:null):e}},{key:"drawToGraphic",value:function(e,t,i,n){t+=this.x,i+=this.y;var s,r,l,a=this.style;if(a.paddingLeft&&(t+=a.paddingLeft),a.paddingTop&&(i+=a.paddingTop),(null!=a.bgColor||a.borderColor)&&e.drawRect(t,i,this.width,this.height,a.bgColor,a.borderColor,1),this.renderSelfToGraphic(e,t,i,n),this._children&&this._children.length>0)for(r=this._children.length,s=0;s<r;s++)null!=(l=this._children[s]).drawToGraphic&&l.drawToGraphic(e,t,i,n)}},{key:"renderSelfToGraphic",value:function(e,t,i,n){var s=this.style,l=this._getWords();if(l&&(l.length,s)){var a=s.font,h=s.color;if(s.stroke){var o=s.stroke;o=parseInt(o);var u=s.strokeColor;e.fillBorderWords(l,t,i,a,h,u,o)}else e.fillWords(l,t,i,a,h);if(this.href){var c=l[l.length-1],y=c.y+c.height;if(c.y==l[0].y){"none"!=s.textDecoration&&e.drawLine(l[0].x,y,c.x+c.width,y,h,1);var _=r.create();_.rec.setTo(l[0].x,c.y,c.x+c.width-l[0].x,c.height),_.href=this.href,n.push(_)}else this.workLines(l,e,n)}}}},{key:"workLines",value:function(e,t,i){var n;n="none"!=this.style.textDecoration;var s,r,l,a=0;if(s=e.length,l=r=e[a],r){var h;for(a=1;a<s;a++)(h=e[a]).y!=r.y?(this.createOneLine(r,l,n,t,i),r=h,l=h):l=h;this.createOneLine(r,l,n,t,i)}}},{key:"createOneLine",value:function(e,t,i,n,s){var l=t.y+t.height;i&&n.drawLine(e.x,l,t.x+t.width,l,this.style.color,1);var a=r.create();a.rec.setTo(e.x,t.y,t.x+t.width-e.x,t.height),a.href=this.href,s.push(a)}},{key:"id",set:function(e){s.document.setElementById(e,this)}},{key:"innerTEXT",set:function(e){this._text===HTMLElement._EMPTYTEXT?this._text={text:e,words:null}:(this._text.text=e,this._text.words&&(this._text.words.length=0)),this.repaint()},get:function(){return this._text.text}},{key:"style",get:function(){return this._style}},{key:"x",set:function(e){this._x!=e&&(this._x=e,this.parentRepaint())},get:function(){return this._x}},{key:"y",set:function(e){this._y!=e&&(this._y=e,this.parentRepaint())},get:function(){return this._y}},{key:"width",get:function(){return this._width},set:function(e){this._width!==e&&(this._width=e,this.repaint())}},{key:"height",get:function(){return this._height},set:function(e){this._height!==e&&(this._height=e,this.repaint())}},{key:"href",set:function(e){this._style&&e!=this._style.href&&(this._style.href=e,this.repaint())},get:function(){return this._style?this._style.href:null}},{key:"color",set:function(e){this.style.color=e}},{key:"className",set:function(e){this.style.attrs(s.document.styleSheets["."+e])}}],[{key:"formatURL1",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!e)return"null path";if(i||(i=t.URL.basePath),e.indexOf(":")>0)return e;if(null!=t.URL.customFormat&&(e=t.URL.customFormat(e)),e.indexOf(":")>0)return e;var n=e.charAt(0);if("."===n)return t.URL._formatRelativePath(i+e);if("~"===n)return t.URL.rootPath+e.substring(1);if("d"===n){if(0===e.indexOf("data:image"))return e}else if("/"===n)return e;return i+e}},{key:"getClassName",value:function(e){return e instanceof Function?e.name:e.constructor.name}}]),HTMLElement}();u._EMPTYTEXT={text:null,words:null},t.ILaya.regClass(u),l.HTMLElementType=e.HTMLElementType,t.ClassUtils.regClass("laya.html.dom.HTMLElement",u),t.ClassUtils.regClass("Laya.HTMLElement",u);var c=function(){function HTMLBrElement(){_classCallCheck(this,HTMLBrElement)}return _createClass(HTMLBrElement,[{key:"_addToLayout",value:function(e){e.push(this)}},{key:"reset",value:function(){return this}},{key:"destroy",value:function(){t.Pool.recover(u.getClassName(this),this.reset())}},{key:"_setParent",value:function(e){}},{key:"_getCSSStyle",value:function(){return HTMLBrElement.brStyle||(HTMLBrElement.brStyle=new n,HTMLBrElement.brStyle.setLineElement(!0),HTMLBrElement.brStyle.block=!0),HTMLBrElement.brStyle}},{key:"renderSelfToGraphic",value:function(e,t,i,n){}},{key:"parent",set:function(e){}},{key:"URI",set:function(e){}},{key:"href",set:function(e){}}]),HTMLBrElement}();l.HTMLBrElement=c,t.ILaya.regClass(c),t.ClassUtils.regClass("laya.html.dom.HTMLBrElement",c),t.ClassUtils.regClass("Laya.HTMLBrElement",c);var y=function(e){_inherits(HTMLStyleElement,u);var t=_createSuper(HTMLStyleElement);function HTMLStyleElement(){return _classCallCheck(this,HTMLStyleElement),t.apply(this,arguments)}return _createClass(HTMLStyleElement,[{key:"_creates",value:function(){}},{key:"drawToGraphic",value:function(e,t,i,n){}},{key:"reset",value:function(){return this}},{key:"innerTEXT",set:function(e){n.parseCSS(e,null)},get:function(){return _get(_getPrototypeOf(HTMLStyleElement.prototype),"innerTEXT",this)}}]),HTMLStyleElement}();t.ILaya.regClass(y),t.ClassUtils.regClass("laya.html.dom.HTMLStyleElement",y),t.ClassUtils.regClass("Laya.HTMLStyleElement",y);var _=function(e){_inherits(HTMLLinkElement,u);var i=_createSuper(HTMLLinkElement);function HTMLLinkElement(){return _classCallCheck(this,HTMLLinkElement),i.apply(this,arguments)}return _createClass(HTMLLinkElement,[{key:"_creates",value:function(){}},{key:"drawToGraphic",value:function(e,t,i,n){}},{key:"reset",value:function(){return this._loader&&this._loader.off(t.Event.COMPLETE,this,this._onload),this._loader=null,this}},{key:"_onload",value:function(e){switch(this._loader&&(this._loader=null),this.type){case"text/css":n.parseCSS(e,this.URI)}this.repaint(!0)}},{key:"href",set:function(e){e&&(e=this.formatURL(e),this.URI=new t.URL(e),this._loader&&this._loader.off(t.Event.COMPLETE,this,this._onload),t.Loader.getRes(e)?"text/css"==this.type&&n.parseCSS(t.Loader.getRes(e),this.URI):(this._loader=new t.Loader,this._loader.once(t.Event.COMPLETE,this,this._onload),this._loader.load(e,t.Loader.TEXT)))},get:function(){return _get(_getPrototypeOf(HTMLLinkElement.prototype),"href",this)}}]),HTMLLinkElement}();_._cuttingStyle=new RegExp("((@keyframes[\\s\\t]+|)(.+))[\\t\\n\\r\\s]*{","g"),t.ILaya.regClass(_),t.ClassUtils.regClass("laya.html.dom.HTMLLinkElement",_),t.ClassUtils.regClass("Laya.HTMLLinkElement",_);var f=function(e){_inherits(HTMLDivParser,u);var i=_createSuper(HTMLDivParser);function HTMLDivParser(){var e;return _classCallCheck(this,HTMLDivParser),(e=i.apply(this,arguments)).repaintHandler=null,e}return _createClass(HTMLDivParser,[{key:"reset",value:function(){return _get(_getPrototypeOf(HTMLDivParser.prototype),"reset",this).call(this),this._style.block=!0,this._style.setLineElement(!0),this._style.width=200,this._style.height=200,this.repaintHandler=null,this.contextHeight=0,this.contextWidth=0,this}},{key:"appendHTML",value:function(e){l.HTMLParse.parse(this,e,this.URI),this.layout()}},{key:"_addChildsToLayout",value:function(e){var t=this._getWords();if(null==t&&(!this._children||0==this._children.length))return!1;t&&t.forEach(function(t){e.push(t)});for(var i=!0,n=0,s=this._children.length;n<s;n++){var r=this._children[n];i?i=!1:e.push(null),r._addToLayout(e)}return!0}},{key:"_addToLayout",value:function(e){this.layout(),!this.style.absolute&&e.push(this)}},{key:"getBounds",value:function(){return this._htmlBounds?(this._boundsRec||(this._boundsRec=t.Rectangle.create()),this._boundsRec.copyFrom(this._htmlBounds)):null}},{key:"parentRepaint",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];_get(_getPrototypeOf(HTMLDivParser.prototype),"parentRepaint",this).call(this),this.repaintHandler&&this.repaintHandler.runWith(e)}},{key:"layout",value:function(){this.style._type|=n.ADDLAYOUTED;var e=o.layout(this);if(e){this._htmlBounds||(this._htmlBounds=t.Rectangle.create());var i=this._htmlBounds;i.x=i.y=0,i.width=this.contextWidth=e[0],i.height=this.contextHeight=e[1]}}},{key:"innerHTML",set:function(e){this.destroyChildren(),this.appendHTML(e)}},{key:"width",set:function(e){var t;t=0===e?e!=this._width:e!=this.width,_set(_getPrototypeOf(HTMLDivParser.prototype),"width",e,this,!0),t&&this.layout()},get:function(){return this._width?this._width:this.contextWidth}},{key:"height",get:function(){return this._height?this._height:this.contextHeight},set:function(e){_set(_getPrototypeOf(HTMLDivParser.prototype),"height",e,this,!0)}}]),HTMLDivParser}();l.HTMLDivParser=f,t.ILaya.regClass(f),t.ClassUtils.regClass("laya.html.dom.HTMLDivParser",f),t.ClassUtils.regClass("Laya.HTMLDivParser",f);var d=function(i){_inherits(HTMLImageElement,u);var n=_createSuper(HTMLImageElement);function HTMLImageElement(){var t;return _classCallCheck(this,HTMLImageElement),(t=n.call(this)).eletype=e.HTMLElementType.IMAGE,t}return _createClass(HTMLImageElement,[{key:"reset",value:function(){return _get(_getPrototypeOf(HTMLImageElement.prototype),"reset",this).call(this),this._tex&&this._tex.off(t.Event.LOADED,this,this.onloaded),this._tex=null,this._url&&(t.Browser.window.RES.DelReference(this._url),t.Browser.window.RES.ClearResByUrl(this._url)),this._url=null,this}},{key:"onloaded",value:function(){if(this._style&&this._tex){var e=this._style;e.widthed(this)||this._tex.width,e.heighted(this)||this._tex.height;e.widthed(this)||this._width==this._tex.width||(this.width=this._tex.width,this.parent&&this.parent._layoutLater()),e.heighted(this)||this._height==this._tex.height||(this.height=this._tex.height,this.parent&&this.parent._layoutLater()),this.repaint()}}},{key:"_addToLayout",value:function(e){!this._style.absolute&&e.push(this)}},{key:"renderSelfToGraphic",value:function(e,t,i,n){this._tex&&e.drawImage(this._tex,t,i,this.width||this._tex.width,this.height||this._tex.height)}},{key:"src",set:function(e){if(e=this.formatURL(e),this._url!==e){this._url&&(t.Browser.window.RES.DelReference(this._url),t.Browser.window.RES.ClearResByUrl(this._url)),this._url=e,this._url&&t.Browser.window.RES.AddReference(this._url);var i=this._tex=t.Loader.getRes(e);i||(this._tex=i=new t.Texture,i.load(e),t.Loader.cacheTexture(e,i)),i.getIsReady()?this.onloaded():i.once(t.Event.READY,this,this.onloaded)}}}]),HTMLImageElement}();l.HTMLImageElement=d,t.ILaya.regClass(d),t.ClassUtils.regClass("laya.html.dom.HTMLImageElement",d),t.ClassUtils.regClass("Laya.HTMLImageElement",d);var L=function(){function HTMLParse(){_classCallCheck(this,HTMLParse)}return _createClass(HTMLParse,null,[{key:"getInstance",value:function(e){var i=t.Pool.getItem(HTMLParse._htmlClassMapShort[e]);return i||(i=t.ClassUtils.getInstance(e)),i}},{key:"parse",value:function(e,i,n){i=(i="<root>"+(i=i.replace(/<br>/g,"<br/>"))+"</root>").replace(HTMLParse.spacePattern,HTMLParse.char255);var s=t.Utils.parseXMLFromString(i);HTMLParse._parseXML(e,s.childNodes[0].childNodes,n)}},{key:"_parseXML",value:function(e,t,i){var n,s,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(t.join||t.item)for(n=0,s=t.length;n<s;++n)HTMLParse._parseXML(e,t[n],i,r);else{var a,h;if(3==t.nodeType){var o;if(e instanceof l.HTMLDivParser)null==t.nodeName&&(t.nodeName="#text"),h=t.nodeName.toLowerCase(),(o=t.textContent.replace(/^\s+|\s+$/g,"")).length>0&&(a=HTMLParse.getInstance(h))&&(e.addChild(a),a.innerTEXT=o.replace(HTMLParse.char255AndOneSpacePattern," "));else if((o=t.textContent.replace(/^\s+|\s+$/g,"")).length>0){var c=e;if(e instanceof u&&e.innerTEXT&&e.innerTEXT.length>0){var y=HTMLParse.getInstance("p");y&&(e.addChild(y),c=y)}c.innerTEXT=o.replace(HTMLParse.char255AndOneSpacePattern," ")}return}if("#comment"==(h=t.nodeName.toLowerCase()))return;if(a=HTMLParse.getInstance(h)){"p"==h?(e.addChild(HTMLParse.getInstance("br")),a=e.addChild(a),e.addChild(HTMLParse.getInstance("br"))):a=e.addChild(a),a.URI=i,a.href=r;var _=t.attributes;if(_&&_.length>0)for(n=0,s=_.length;n<s;++n){var f=_[n],d=f.nodeName,L=f.value;a._setAttributes(d,L)}HTMLParse._parseXML(a,t.childNodes,i,a.href)}else HTMLParse._parseXML(e,t.childNodes,i,r)}}}]),HTMLParse}();L.char255=String.fromCharCode(255),L.spacePattern=/&nbsp;|&#160;/g,L.char255AndOneSpacePattern=new RegExp(String.fromCharCode(255)+"|(\\s+)","g"),L._htmlClassMapShort={div:f,p:u,img:d,span:u,br:c,style:y,font:u,a:u,"#text":u,link:_},l.HTMLParse=L,t.ClassUtils.regClass("div",f),t.ClassUtils.regClass("p",u),t.ClassUtils.regClass("img",d),t.ClassUtils.regClass("span",u),t.ClassUtils.regClass("br",c),t.ClassUtils.regClass("style",y),t.ClassUtils.regClass("font",u),t.ClassUtils.regClass("a",u),t.ClassUtils.regClass("#text",u),t.ClassUtils.regClass("link",_),t.ClassUtils.regClass("laya.html.utils.HTMLParse",L),t.ClassUtils.regClass("Laya.HTMLParse",L);var g=function(e){_inherits(HTMLDivElement,t.Sprite);var i=_createSuper(HTMLDivElement);function HTMLDivElement(){var e;return _classCallCheck(this,HTMLDivElement),(e=i.call(this))._recList=[],e._repaintState=0,e._element=new f,e._element.repaintHandler=new t.Handler(_assertThisInitialized(e),e._htmlDivRepaint),e.mouseEnabled=!0,e.on(t.Event.CLICK,_assertThisInitialized(e),e._onMouseClick),e}return _createClass(HTMLDivElement,[{key:"destroy",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._innerHTML="",this._element&&(this._element.destroyChildren(),this._element.reset()),this._element=null,this._doClears(),_get(_getPrototypeOf(HTMLDivElement.prototype),"destroy",this).call(this,e)}},{key:"_htmlDivRepaint",value:function(){arguments.length>0&&void 0!==arguments[0]&&arguments[0]?this._repaintState<2&&(this._repaintState=2):this._repaintState<1&&(this._repaintState=1),this._repaintState>0&&this._setGraphicDirty()}},{key:"_updateGraphicWork",value:function(){switch(this._repaintState){case 1:this._updateGraphic();break;case 2:this._refresh()}}},{key:"_setGraphicDirty",value:function(){this.callLater(this._updateGraphicWork)}},{key:"_doClears",value:function(){if(this._recList){var e,t=this._recList.length;for(e=0;e<t;e++)this._recList[e].recover();this._recList.length=0}}},{key:"_updateGraphic",value:function(){this._doClears(),this.graphics.clear(!0),this._repaintState=0,this._element.drawToGraphic(this.graphics,-this._element.x,-this._element.y,this._recList);var e=this._element.getBounds();e&&this.setSelfBounds(e)}},{key:"_refresh",value:function(){this._repaintState=1,this._innerHTML&&(this._element.innerHTML=this._innerHTML),this._setGraphicDirty()}},{key:"_onMouseClick",value:function(){var e,t,i,n=this.mouseX,s=this.mouseY;for(t=this._recList.length,e=0;e<t;e++)(i=this._recList[e]).rec.contains(n,s)&&this._eventLink(i.href)}},{key:"_eventLink",value:function(e){this.event(t.Event.LINK,[e])}},{key:"style",get:function(){return this._element.style}},{key:"innerHTML",set:function(e){this._innerHTML!=e&&(this._repaintState=1,this._innerHTML=e,this._element.innerHTML=e,this._setGraphicDirty())}},{key:"width",set:function(e){this._element.width=e},get:function(){return this._element.width}},{key:"height",set:function(e){this._element.height=e},get:function(){return this._element.height}},{key:"contextWidth",get:function(){return this._element.contextWidth}},{key:"contextHeight",get:function(){return this._element.contextHeight}}]),HTMLDivElement}();l.HTMLDivElement=g,l.HTMLParse=L,t.ClassUtils.regClass("laya.html.dom.HTMLDivElement",g),t.ClassUtils.regClass("Laya.HTMLDivElement",g);var p=function(e){_inherits(HTMLIframeElement,g);var i=_createSuper(HTMLIframeElement);function HTMLIframeElement(){var e;return _classCallCheck(this,HTMLIframeElement),(e=i.call(this))._element._getCSSStyle().valign="middle",e}return _createClass(HTMLIframeElement,[{key:"href",set:function(e){var i=this;e=this._element.formatURL(e);var n=new t.Loader;n.once(t.Event.COMPLETE,null,function(n){var s=i._element.URI;i._element.URI=new t.URL(e),i.innerHTML=n,!s||(i._element.URI=s)}),n.load(e,t.Loader.TEXT)}}]),HTMLIframeElement}();t.ClassUtils.regClass("laya.html.dom.HTMLIframeElement",p),t.ClassUtils.regClass("Laya.HTMLIframeElement",p),e.HTMLBrElement=c,e.HTMLDivElement=g,e.HTMLDivParser=f,e.HTMLDocument=s,e.HTMLElement=u,e.HTMLExtendStyle=i,e.HTMLHitRect=r,e.HTMLIframeElement=p,e.HTMLImageElement=d,e.HTMLLinkElement=_,e.HTMLParse=L,e.HTMLStyle=n,e.HTMLStyleElement=y,e.IHtml=l,e.Layout=o,e.LayoutLine=a}(window.Laya=window.Laya||{},Laya);
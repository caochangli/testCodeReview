"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function set(t,e,i,o){return(set="undefined"!=typeof Reflect&&Reflect.set?Reflect.set:function(t,e,i,o){var n,s=_superPropBase(t,e);if(s){if((n=Object.getOwnPropertyDescriptor(s,e)).set)return n.set.call(o,i),!0;if(!n.writable)return!1}if(n=Object.getOwnPropertyDescriptor(o,e)){if(!n.writable)return!1;n.value=i,Object.defineProperty(o,e,n)}else _defineProperty(o,e,i);return!0})(t,e,i,o)}function _set(t,e,i,o,n){if(!set(t,e,i,o||t)&&n)throw new Error("failed to set property");return i}function _defineProperty(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function _get(t,e,i){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var o=_superPropBase(t,e);if(o){var n=Object.getOwnPropertyDescriptor(o,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function _superPropBase(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=_getPrototypeOf(t)););return t}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function _createSuper(t){var e=_isNativeReflectConstruct();return function(){var i,o=_getPrototypeOf(t);if(e){var n=_getPrototypeOf(this).constructor;i=Reflect.construct(o,arguments,n)}else i=o.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function _possibleConstructorReturn(t,e){return!e||"object"!==_typeof(e)&&"function"!=typeof e?_assertThisInitialized(t):e}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(t){return!1}}function _getPrototypeOf(t){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),t}window.Physics3D=function(t,e){return new Promise(function(i){var o=new WebAssembly.Memory({initial:t});fetch("laya.physics3D.wasm.wasm").then(function(t){t.arrayBuffer().then(function(t){WebAssembly.instantiate(t,{LayaAirInteractive:e,wasi_unstable:{fd_close:function(){console.log("fd_close")},fd_seek:function(){console.log("fd_seek")},fd_write:function(){console.log("fd_write")}},env:{memory:o}}).then(function(t){window.Physics3D=t.instance.exports,i()})})})})},function(t,e){var i=function(){function ColliderShape(){_classCallCheck(this,ColliderShape),this._scale=new e.Vector3(1,1,1),this._centerMatrix=new e.Matrix4x4,this._attatched=!1,this._indexInCompound=-1,this._compoundParent=null,this._attatchedCollisionObject=null,this._referenceCount=0,this._localOffset=new e.Vector3(0,0,0),this._localRotation=new e.Quaternion(0,0,0,1),this.needsCustomCollisionCallback=!1}return _createClass(ColliderShape,[{key:"_setScale",value:function(t){if(this._compoundParent)this.updateLocalTransformations();else{var i=e.ILaya3D.Physics3D._bullet;i.btVector3_setValue(ColliderShape._btScale,t.x,t.y,t.z),i.btCollisionShape_setLocalScaling(this._btShape,ColliderShape._btScale)}}},{key:"_addReference",value:function(){this._referenceCount++}},{key:"_removeReference",value:function(){this._referenceCount--}},{key:"updateLocalTransformations",value:function(){if(this._compoundParent){var t=ColliderShape._tempVector30;e.Vector3.multiply(this.localOffset,this._scale,t),ColliderShape._createAffineTransformation(t,this.localRotation,this._centerMatrix.elements)}else ColliderShape._createAffineTransformation(this.localOffset,this.localRotation,this._centerMatrix.elements)}},{key:"cloneTo",value:function(t){var e=t;this._localOffset.cloneTo(e.localOffset),this._localRotation.cloneTo(e.localRotation),e.localOffset=e.localOffset,e.localRotation=e.localRotation}},{key:"clone",value:function(){return null}},{key:"destroy",value:function(){this._btShape&&(e.ILaya3D.Physics3D._bullet.btCollisionShape_destroy(this._btShape),this._btShape=null)}},{key:"type",get:function(){return this._type}},{key:"localOffset",get:function(){return this._localOffset},set:function(t){this._localOffset=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}},{key:"localRotation",get:function(){return this._localRotation},set:function(t){this._localRotation=t,this._compoundParent&&this._compoundParent._updateChildTransform(this)}}],[{key:"__init__",value:function(){var t=e.ILaya3D.Physics3D._bullet;ColliderShape._btScale=t.btVector3_create(1,1,1),ColliderShape._btVector30=t.btVector3_create(0,0,0),ColliderShape._btQuaternion0=t.btQuaternion_create(0,0,0,1),ColliderShape._btTransform0=t.btTransform_create()}},{key:"_createAffineTransformation",value:function(t,e,i){var o=e.x,n=e.y,s=e.z,r=e.w,a=o+o,l=n+n,_=s+s,c=o*a,h=o*l,u=o*_,d=n*l,b=n*_,y=s*_,C=r*a,p=r*l,g=r*_;i[0]=1-(d+y),i[1]=h+g,i[2]=u-p,i[3]=0,i[4]=h-g,i[5]=1-(c+y),i[6]=b+C,i[7]=0,i[8]=u+p,i[9]=b-C,i[10]=1-(c+d),i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1}}]),ColliderShape}();i.SHAPEORIENTATION_UPX=0,i.SHAPEORIENTATION_UPY=1,i.SHAPEORIENTATION_UPZ=2,i.SHAPETYPES_BOX=0,i.SHAPETYPES_SPHERE=1,i.SHAPETYPES_CYLINDER=2,i.SHAPETYPES_CAPSULE=3,i.SHAPETYPES_CONVEXHULL=4,i.SHAPETYPES_COMPOUND=5,i.SHAPETYPES_STATICPLANE=6,i.SHAPETYPES_CONE=7,i._tempVector30=new e.Vector3;var o=function(t){_inherits(BoxColliderShape,i);var o=_createSuper(BoxColliderShape);function BoxColliderShape(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;_classCallCheck(this,BoxColliderShape),(t=o.call(this))._sizeX=n,t._sizeY=s,t._sizeZ=r,t._type=i.SHAPETYPES_BOX;var a=e.ILaya3D.Physics3D._bullet;return a.btVector3_setValue(BoxColliderShape._btSize,n/2,s/2,r/2),t._btShape=a.btBoxShape_create(BoxColliderShape._btSize),t}return _createClass(BoxColliderShape,[{key:"clone",value:function(){var t=new BoxColliderShape(this._sizeX,this._sizeY,this._sizeZ);return this.cloneTo(t),t}},{key:"sizeX",get:function(){return this._sizeX}},{key:"sizeY",get:function(){return this._sizeY}},{key:"sizeZ",get:function(){return this._sizeZ}}],[{key:"__init__",value:function(){BoxColliderShape._btSize=e.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),BoxColliderShape}(),n=function(t){_inherits(CapsuleColliderShape,i);var o=_createSuper(CapsuleColliderShape);function CapsuleColliderShape(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1.25,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.SHAPEORIENTATION_UPY;_classCallCheck(this,CapsuleColliderShape),(t=o.call(this))._radius=n,t._length=s,t._orientation=r,t._type=i.SHAPETYPES_CAPSULE;var a=e.ILaya3D.Physics3D._bullet;switch(r){case i.SHAPEORIENTATION_UPX:t._btShape=a.btCapsuleShapeX_create(n,s-2*n);break;case i.SHAPEORIENTATION_UPY:t._btShape=a.btCapsuleShape_create(n,s-2*n);break;case i.SHAPEORIENTATION_UPZ:t._btShape=a.btCapsuleShapeZ_create(n,s-2*n);break;default:throw"CapsuleColliderShape:unknown orientation."}return t}return _createClass(CapsuleColliderShape,[{key:"_setScale",value:function(t){var e=CapsuleColliderShape._tempVector30;switch(this.orientation){case i.SHAPEORIENTATION_UPX:e.x=t.x,e.y=e.z=Math.max(t.y,t.z);break;case i.SHAPEORIENTATION_UPY:e.y=t.y,e.x=e.z=Math.max(t.x,t.z);break;case i.SHAPEORIENTATION_UPZ:e.z=t.z,e.x=e.y=Math.max(t.x,t.y);break;default:throw"CapsuleColliderShape:unknown orientation."}_get(_getPrototypeOf(CapsuleColliderShape.prototype),"_setScale",this).call(this,e)}},{key:"clone",value:function(){var t=new CapsuleColliderShape(this._radius,this._length,this._orientation);return this.cloneTo(t),t}},{key:"radius",get:function(){return this._radius}},{key:"length",get:function(){return this._length}},{key:"orientation",get:function(){return this._orientation}}]),CapsuleColliderShape}();n._tempVector30=new e.Vector3;var s=function(t){_inherits(CompoundColliderShape,i);var o=_createSuper(CompoundColliderShape);function CompoundColliderShape(){var t;return _classCallCheck(this,CompoundColliderShape),(t=o.call(this))._childColliderShapes=[],t._type=i.SHAPETYPES_COMPOUND,t._btShape=e.ILaya3D.Physics3D._bullet.btCompoundShape_create(),t}return _createClass(CompoundColliderShape,[{key:"_clearChildShape",value:function(t){t._attatched=!1,t._compoundParent=null,t._indexInCompound=-1}},{key:"_addReference",value:function(){}},{key:"_removeReference",value:function(){}},{key:"_updateChildTransform",value:function(t){var o=e.ILaya3D.Physics3D._bullet,n=t.localOffset,s=t.localRotation,r=i._btVector30,a=i._btQuaternion0,l=i._btTransform0;o.btVector3_setValue(r,-n.x,n.y,n.z),o.btQuaternion_setValue(a,-s.x,s.y,s.z,-s.w),o.btTransform_setOrigin(l,r),o.btTransform_setRotation(l,a),o.btCompoundShape_updateChildTransform(this._btShape,t._indexInCompound,l,!0)}},{key:"addChildShape",value:function(t){if(t._attatched)throw"CompoundColliderShape: this shape has attatched to other entity.";t._attatched=!0,t._compoundParent=this,t._indexInCompound=this._childColliderShapes.length,this._childColliderShapes.push(t);var i=t.localOffset,o=t.localRotation,n=e.ILaya3D.Physics3D._bullet;n.btVector3_setValue(CompoundColliderShape._btOffset,-i.x,i.y,i.z),n.btQuaternion_setValue(CompoundColliderShape._btRotation,-o.x,o.y,o.z,-o.w),n.btTransform_setOrigin(CompoundColliderShape._btTransform,CompoundColliderShape._btOffset),n.btTransform_setRotation(CompoundColliderShape._btTransform,CompoundColliderShape._btRotation);var s=n.btCollisionShape_getLocalScaling(this._btShape);n.btCollisionShape_setLocalScaling(this._btShape,CompoundColliderShape._btVector3One),n.btCompoundShape_addChildShape(this._btShape,CompoundColliderShape._btTransform,t._btShape),n.btCollisionShape_setLocalScaling(this._btShape,s),this._attatchedCollisionObject&&(this._attatchedCollisionObject.colliderShape=this)}},{key:"removeChildShape",value:function(t){if(t._compoundParent===this){var i=t._indexInCompound;this._clearChildShape(t);var o=this._childColliderShapes[this._childColliderShapes.length-1];o._indexInCompound=i,this._childColliderShapes[i]=o,this._childColliderShapes.pop(),e.ILaya3D.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,i)}}},{key:"clearChildShape",value:function(){for(var t=0,i=this._childColliderShapes.length;t<i;t++)this._clearChildShape(this._childColliderShapes[t]),e.ILaya3D.Physics3D._bullet.btCompoundShape_removeChildShapeByIndex(this._btShape,0);this._childColliderShapes.length=0}},{key:"getChildShapeCount",value:function(){return this._childColliderShapes.length}},{key:"cloneTo",value:function(t){var e=t;e.clearChildShape();for(var i=0,o=this._childColliderShapes.length;i<o;i++)e.addChildShape(this._childColliderShapes[i].clone())}},{key:"clone",value:function(){var t=new CompoundColliderShape;return this.cloneTo(t),t}},{key:"destroy",value:function(){_get(_getPrototypeOf(CompoundColliderShape.prototype),"destroy",this).call(this);for(var t=0,e=this._childColliderShapes.length;t<e;t++){var i=this._childColliderShapes[t];0===i._referenceCount&&i.destroy()}}}],[{key:"__init__",value:function(){var t=e.ILaya3D.Physics3D._bullet;CompoundColliderShape._btVector3One=t.btVector3_create(1,1,1),CompoundColliderShape._btTransform=t.btTransform_create(),CompoundColliderShape._btOffset=t.btVector3_create(0,0,0),CompoundColliderShape._btRotation=t.btQuaternion_create(0,0,0,1)}}]),CompoundColliderShape}(),r=function(t){_inherits(ConeColliderShape,i);var o=_createSuper(ConeColliderShape);function ConeColliderShape(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.SHAPEORIENTATION_UPY;_classCallCheck(this,ConeColliderShape),(t=o.call(this))._radius=1,t._height=.5,t._radius=n,t._height=s,t._orientation=r,t._type=i.SHAPETYPES_CYLINDER;var a=e.ILaya3D.Physics3D._bullet;switch(r){case i.SHAPEORIENTATION_UPX:t._btShape=a.btConeShapeX_create(n,s);break;case i.SHAPEORIENTATION_UPY:t._btShape=a.btConeShape_create(n,s);break;case i.SHAPEORIENTATION_UPZ:t._btShape=a.btConeShapeZ_create(n,s);break;default:throw"ConeColliderShape:unknown orientation."}return t}return _createClass(ConeColliderShape,[{key:"clone",value:function(){var t=new ConeColliderShape(this._radius,this._height,this._orientation);return this.cloneTo(t),t}},{key:"radius",get:function(){return this._radius}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}}]),ConeColliderShape}(),a=function(t){_inherits(CylinderColliderShape,i);var o=_createSuper(CylinderColliderShape);function CylinderColliderShape(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i.SHAPEORIENTATION_UPY;_classCallCheck(this,CylinderColliderShape),(t=o.call(this))._radius=1,t._height=.5,t._radius=n,t._height=s,t._orientation=r,t._type=i.SHAPETYPES_CYLINDER;var a=e.ILaya3D.Physics3D._bullet;switch(r){case i.SHAPEORIENTATION_UPX:a.btVector3_setValue(CylinderColliderShape._btSize,s/2,n,n),t._btShape=a.btCylinderShapeX_create(CylinderColliderShape._btSize);break;case i.SHAPEORIENTATION_UPY:a.btVector3_setValue(CylinderColliderShape._btSize,n,s/2,n),t._btShape=a.btCylinderShape_create(CylinderColliderShape._btSize);break;case i.SHAPEORIENTATION_UPZ:a.btVector3_setValue(CylinderColliderShape._btSize,n,n,s/2),t._btShape=a.btCylinderShapeZ_create(CylinderColliderShape._btSize);break;default:throw"CapsuleColliderShape:unknown orientation."}return t}return _createClass(CylinderColliderShape,[{key:"clone",value:function(){var t=new CylinderColliderShape(this._radius,this._height,this._orientation);return this.cloneTo(t),t}},{key:"radius",get:function(){return this._radius}},{key:"height",get:function(){return this._height}},{key:"orientation",get:function(){return this._orientation}}],[{key:"__init__",value:function(){CylinderColliderShape._btSize=e.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),CylinderColliderShape}(),l=function(t){_inherits(MeshColliderShape,i);var o=_createSuper(MeshColliderShape);function MeshColliderShape(){var t;return _classCallCheck(this,MeshColliderShape),(t=o.call(this))._mesh=null,t._convex=!1,t}return _createClass(MeshColliderShape,[{key:"_setScale",value:function(t){if(this._compoundParent)this.updateLocalTransformations();else{var o=e.ILaya3D.Physics3D._bullet;o.btVector3_setValue(i._btScale,t.x,t.y,t.z),o.btCollisionShape_setLocalScaling(this._btShape,i._btScale),o.btGImpactShapeInterface_updateBound(this._btShape)}}},{key:"cloneTo",value:function(t){var e=t;e.convex=this._convex,e.mesh=this._mesh,_get(_getPrototypeOf(MeshColliderShape.prototype),"cloneTo",this).call(this,t)}},{key:"clone",value:function(){var t=new MeshColliderShape;return this.cloneTo(t),t}},{key:"destroy",value:function(){this._btShape&&(e.ILaya3D.Physics3D._bullet.btCollisionShape_destroy(this._btShape),this._btShape=null)}},{key:"mesh",get:function(){return this._mesh},set:function(t){if(this._mesh!==t){var i=e.ILaya3D.Physics3D._bullet;this._mesh&&i.btCollisionShape_destroy(this._btShape),t&&(this._btShape=i.btGImpactMeshShape_create(t._getPhysicMesh()),i.btGImpactShapeInterface_updateBound(this._btShape)),this._mesh=t}}},{key:"convex",get:function(){return this._convex},set:function(t){this._convex=t}}]),MeshColliderShape}(),_=function(t){_inherits(SphereColliderShape,i);var o=_createSuper(SphereColliderShape);function SphereColliderShape(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5;return _classCallCheck(this,SphereColliderShape),(t=o.call(this))._radius=n,t._type=i.SHAPETYPES_SPHERE,t._btShape=e.ILaya3D.Physics3D._bullet.btSphereShape_create(n),t}return _createClass(SphereColliderShape,[{key:"clone",value:function(){var t=new SphereColliderShape(this._radius);return this.cloneTo(t),t}},{key:"radius",get:function(){return this._radius}}]),SphereColliderShape}(),c=function(t){_inherits(PhysicsComponent,e.Component);var i=_createSuper(PhysicsComponent);function PhysicsComponent(t,o){var n;return _classCallCheck(this,PhysicsComponent),(n=i.call(this))._restitution=0,n._friction=.5,n._rollingFriction=0,n._ccdMotionThreshold=0,n._ccdSweptSphereRadius=0,n._collisionGroup=e.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,n._canCollideWith=e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,n._colliderShape=null,n._transformFlag=2147483647,n._controlBySimulation=!1,n._enableProcessCollisions=!0,n._inPhysicUpdateListIndex=-1,n.canScaleShape=!0,n._collisionGroup=t,n._canCollideWith=o,PhysicsComponent._physicObjectsMap[n.id]=_assertThisInitialized(n),n}return _createClass(PhysicsComponent,[{key:"_parseShape",value:function(t){var e=t.length;if(1===e){var i=PhysicsComponent._creatShape(t[0]);this.colliderShape=i}else{for(var o=new s,n=0;n<e;n++)i=PhysicsComponent._creatShape(t[n]),o.addChildShape(i);this.colliderShape=o}}},{key:"_onScaleChange",value:function(t){this._colliderShape._setScale(t)}},{key:"_onEnable",value:function(){this._simulation=this.owner._scene.physicsSimulation,e.ILaya3D.Physics3D._bullet.btCollisionObject_setContactProcessingThreshold(this._btColliderObject,0),this._colliderShape&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}},{key:"_onDisable",value:function(){this._colliderShape&&(this._removeFromSimulation(),-1!==this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.remove(this)),this._simulation=null}},{key:"_onDestroy",value:function(){delete PhysicsComponent._physicObjectsMap[this.id],e.ILaya3D.Physics3D._bullet.btCollisionObject_destroy(this._btColliderObject),this._colliderShape.destroy(),_get(_getPrototypeOf(PhysicsComponent.prototype),"_onDestroy",this).call(this),this._btColliderObject=null,this._colliderShape=null,this._simulation=null,this.owner.transform.off(e.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}},{key:"_isValid",value:function(){return this._simulation&&this._colliderShape&&this._enabled}},{key:"_parse",value:function(t){null!=t.collisionGroup&&(this.collisionGroup=t.collisionGroup),null!=t.canCollideWith&&(this.canCollideWith=t.canCollideWith),null!=t.ccdMotionThreshold&&(this.ccdMotionThreshold=t.ccdMotionThreshold),null!=t.ccdSweptSphereRadius&&(this.ccdSweptSphereRadius=t.ccdSweptSphereRadius)}},{key:"_setTransformFlag",value:function(t,e){e?this._transformFlag|=t:this._transformFlag&=~t}},{key:"_getTransformFlag",value:function(t){return 0!=(this._transformFlag&t)}},{key:"_addToSimulation",value:function(){}},{key:"_removeFromSimulation",value:function(){}},{key:"_derivePhysicsTransformation",value:function(t){var i=e.ILaya3D.Physics3D._bullet,o=this._btColliderObject,n=i.btCollisionObject_getWorldTransform(o);this._innerDerivePhysicsTransformation(n,t),i.btCollisionObject_setWorldTransform(o,n)}},{key:"_innerDerivePhysicsTransformation",value:function(t,i){var o=e.ILaya3D.Physics3D._bullet,n=this.owner._transform;if(i||this._getTransformFlag(e.Transform3D.TRANSFORM_WORLDPOSITION)){var s=this._colliderShape.localOffset,r=n.position,a=PhysicsComponent._btVector30;if(0!==s.x||0!==s.y||0!==s.z){var l=PhysicsComponent._tempVector30,_=n.worldMatrix;e.Vector3.transformCoordinate(s,_,l),o.btVector3_setValue(a,-l.x,l.y,l.z)}else o.btVector3_setValue(a,-r.x,r.y,r.z);o.btTransform_setOrigin(t,a),this._setTransformFlag(e.Transform3D.TRANSFORM_WORLDPOSITION,!1)}if(i||this._getTransformFlag(e.Transform3D.TRANSFORM_WORLDQUATERNION)){var c=this._colliderShape.localRotation,h=PhysicsComponent._btQuaternion0,u=n.rotation;if(0!==c.x||0!==c.y||0!==c.z||1!==c.w){var d=PhysicsComponent._tempQuaternion0;PhysicsComponent.physicQuaternionMultiply(u.x,u.y,u.z,u.w,c,d),o.btQuaternion_setValue(h,-d.x,d.y,d.z,-d.w)}else o.btQuaternion_setValue(h,-u.x,u.y,u.z,-u.w);o.btTransform_setRotation(t,h),this._setTransformFlag(e.Transform3D.TRANSFORM_WORLDQUATERNION,!1)}(i||this._getTransformFlag(e.Transform3D.TRANSFORM_WORLDSCALE))&&(this._onScaleChange(n.getWorldLossyScale()),this._setTransformFlag(e.Transform3D.TRANSFORM_WORLDSCALE,!1))}},{key:"_updateTransformComponent",value:function(t){var i=e.ILaya3D.Physics3D._bullet,o=this._colliderShape,n=o.localOffset,s=o.localRotation,r=this.owner._transform,a=r.position,l=r.rotation,_=i.btTransform_getOrigin(t),c=i.btTransform_getRotation(t),h=-i.btQuaternion_x(c),u=i.btQuaternion_y(c),d=i.btQuaternion_z(c),b=-i.btQuaternion_w(c);if(0!==s.x||0!==s.y||0!==s.z||1!==s.w){var y=PhysicsComponent._tempQuaternion0;s.invert(y),PhysicsComponent.physicQuaternionMultiply(h,u,d,b,y,l)}else l.x=h,l.y=u,l.z=d,l.w=b;if(r.rotation=l,0!==n.x||0!==n.y||0!==n.z){var C=i.btCollisionShape_getLocalScaling(o._btShape),p=PhysicsComponent._tempVector30;p.x=n.x*i.btVector3_x(C),p.y=n.y*i.btVector3_y(C),p.z=n.z*i.btVector3_z(C),e.Vector3.transformQuat(p,l,p),a.x=-i.btVector3_x(_)-p.x,a.y=i.btVector3_y(_)-p.y,a.z=i.btVector3_z(_)-p.z}else a.x=-i.btVector3_x(_),a.y=i.btVector3_y(_),a.z=i.btVector3_z(_);r.position=a}},{key:"_onShapeChange",value:function(t){var i=this._btColliderObject,o=e.ILaya3D.Physics3D._bullet,n=o.btCollisionObject_getCollisionFlags(i);t.needsCustomCollisionCallback?0==(n&PhysicsComponent.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)&&o.btCollisionObject_setCollisionFlags(i,n|PhysicsComponent.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK):(n&PhysicsComponent.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)>0&&o.btCollisionObject_setCollisionFlags(i,n^PhysicsComponent.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK)}},{key:"_onAdded",value:function(){this.enabled=this._enabled,this.restitution=this._restitution,this.friction=this._friction,this.rollingFriction=this._rollingFriction,this.ccdMotionThreshold=this._ccdMotionThreshold,this.ccdSweptSphereRadius=this._ccdSweptSphereRadius,this.owner.transform.on(e.Event.TRANSFORM_CHANGED,this,this._onTransformChanged)}},{key:"_onTransformChanged",value:function(t){!PhysicsComponent._addUpdateList&&this._controlBySimulation||(t&=e.Transform3D.TRANSFORM_WORLDPOSITION|e.Transform3D.TRANSFORM_WORLDQUATERNION|e.Transform3D.TRANSFORM_WORLDSCALE)&&(this._transformFlag|=t,this._isValid()&&-1===this._inPhysicUpdateListIndex&&this._simulation._physicsUpdateList.add(this))}},{key:"_cloneTo",value:function(t){var e=t;e.restitution=this._restitution,e.friction=this._friction,e.rollingFriction=this._rollingFriction,e.ccdMotionThreshold=this._ccdMotionThreshold,e.ccdSweptSphereRadius=this._ccdSweptSphereRadius,e.collisionGroup=this._collisionGroup,e.canCollideWith=this._canCollideWith,e.canScaleShape=this.canScaleShape,this._colliderShape&&(e.colliderShape=this._colliderShape.clone())}},{key:"restitution",get:function(){return this._restitution},set:function(t){this._restitution=t,this._btColliderObject&&e.ILaya3D.Physics3D._bullet.btCollisionObject_setRestitution(this._btColliderObject,t)}},{key:"friction",get:function(){return this._friction},set:function(t){this._friction=t,this._btColliderObject&&e.ILaya3D.Physics3D._bullet.btCollisionObject_setFriction(this._btColliderObject,t)}},{key:"rollingFriction",get:function(){return this._rollingFriction},set:function(t){this._rollingFriction=t,this._btColliderObject&&e.ILaya3D.Physics3D._bullet.btCollisionObject_setRollingFriction(this._btColliderObject,t)}},{key:"ccdMotionThreshold",get:function(){return this._ccdMotionThreshold},set:function(t){this._ccdMotionThreshold=t,this._btColliderObject&&e.ILaya3D.Physics3D._bullet.btCollisionObject_setCcdMotionThreshold(this._btColliderObject,t)}},{key:"ccdSweptSphereRadius",get:function(){return this._ccdSweptSphereRadius},set:function(t){this._ccdSweptSphereRadius=t,this._btColliderObject&&e.ILaya3D.Physics3D._bullet.btCollisionObject_setCcdSweptSphereRadius(this._btColliderObject,t)}},{key:"isActive",get:function(){return!!this._btColliderObject&&e.ILaya3D.Physics3D._bullet.btCollisionObject_isActive(this._btColliderObject)}},{key:"colliderShape",get:function(){return this._colliderShape},set:function(t){var i=this._colliderShape;if(i&&(i._attatched=!1,i._attatchedCollisionObject=null),this._colliderShape=t,t){if(t._attatched)throw"PhysicsComponent: this shape has attatched to other entity.";if(t._attatched=!0,t._attatchedCollisionObject=this,this._btColliderObject){e.ILaya3D.Physics3D._bullet.btCollisionObject_setCollisionShape(this._btColliderObject,t._btShape);var o=this._simulation&&this._enabled;o&&i&&this._removeFromSimulation(),this._onShapeChange(t),o&&(this._derivePhysicsTransformation(!0),this._addToSimulation())}}else this._simulation&&this._enabled&&i&&this._removeFromSimulation()}},{key:"simulation",get:function(){return this._simulation}},{key:"collisionGroup",get:function(){return this._collisionGroup},set:function(t){this._collisionGroup!==t&&(this._collisionGroup=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}},{key:"canCollideWith",get:function(){return this._canCollideWith},set:function(t){this._canCollideWith!==t&&(this._canCollideWith=t,this._simulation&&this._colliderShape&&this._enabled&&(this._removeFromSimulation(),this._addToSimulation()))}}],[{key:"__init__",value:function(){var t=e.ILaya3D.Physics3D._bullet;PhysicsComponent._btVector30=t.btVector3_create(0,0,0),PhysicsComponent._btQuaternion0=t.btQuaternion_create(0,0,0,1)}},{key:"_createAffineTransformationArray",value:function(t,e,i,o,n,s,r,a,l){var _=o+o,c=n+n,h=s+s,u=o*_,d=o*c,b=o*h,y=n*c,C=n*h,p=s*h,g=r*_,f=r*c,m=r*h,S=a[0],T=a[1],O=a[2];l[0]=(1-(y+p))*S,l[1]=(d+m)*S,l[2]=(b-f)*S,l[3]=0,l[4]=(d-m)*T,l[5]=(1-(u+p))*T,l[6]=(C+g)*T,l[7]=0,l[8]=(b+f)*O,l[9]=(C-g)*O,l[10]=(1-(u+y))*O,l[11]=0,l[12]=t,l[13]=e,l[14]=i,l[15]=1}},{key:"_creatShape",value:function(t){var i;switch(t.type){case"BoxColliderShape":var s=t.size;i=s?new o(s[0],s[1],s[2]):new o;break;case"SphereColliderShape":i=new _(t.radius);break;case"CapsuleColliderShape":i=new n(t.radius,t.height,t.orientation);break;case"MeshColliderShape":var c=new l;t.mesh&&(c.mesh=e.Loader.getRes(t.mesh)),i=c;break;case"ConeColliderShape":i=new r(t.radius,t.height,t.orientation);break;case"CylinderColliderShape":i=new a(t.radius,t.height,t.orientation);break;default:throw"unknown shape type."}if(t.center){var h=i.localOffset;h.fromArray(t.center),i.localOffset=h}return i}},{key:"physicVector3TransformQuat",value:function(t,e,i,o,n,s){var r=t.x,a=t.y,l=t.z,_=n*r+i*l-o*a,c=n*a+o*r-e*l,h=n*l+e*a-i*r,u=-e*r-i*a-o*l;s.x=_*n+u*-e+c*-o-h*-i,s.y=c*n+u*-i+h*-e-_*-o,s.z=h*n+u*-o+_*-i-c*-e}},{key:"physicQuaternionMultiply",value:function(t,e,i,o,n,s){var r=n.x,a=n.y,l=n.z,_=n.w,c=e*l-i*a,h=i*r-t*l,u=t*a-e*r,d=t*r+e*a+i*l;s.x=t*_+r*o+c,s.y=e*_+a*o+h,s.z=i*_+l*o+u,s.w=o*_-d}}]),PhysicsComponent}();c.ACTIVATIONSTATE_ACTIVE_TAG=1,c.ACTIVATIONSTATE_ISLAND_SLEEPING=2,c.ACTIVATIONSTATE_WANTS_DEACTIVATION=3,c.ACTIVATIONSTATE_DISABLE_DEACTIVATION=4,c.ACTIVATIONSTATE_DISABLE_SIMULATION=5,c.COLLISIONFLAGS_STATIC_OBJECT=1,c.COLLISIONFLAGS_KINEMATIC_OBJECT=2,c.COLLISIONFLAGS_NO_CONTACT_RESPONSE=4,c.COLLISIONFLAGS_CUSTOM_MATERIAL_CALLBACK=8,c.COLLISIONFLAGS_CHARACTER_OBJECT=16,c.COLLISIONFLAGS_DISABLE_VISUALIZE_OBJECT=32,c.COLLISIONFLAGS_DISABLE_SPU_COLLISION_PROCESSING=64,c._tempVector30=new e.Vector3,c._tempQuaternion0=new e.Quaternion,c._tempQuaternion1=new e.Quaternion,c._tempMatrix4x40=new e.Matrix4x4,c._physicObjectsMap={},c._addUpdateList=!0;var h=function BulletInteractive(){_classCallCheck(this,BulletInteractive)};h._interactive={getWorldTransform:function(t,e){},setWorldTransform:function(t,e){var i=c._physicObjectsMap[t];i._simulation._updatedRigidbodies++,i._updateTransformComponent(e)}};var u=function(t){_inherits(CharacterController,c);var i=_createSuper(CharacterController);function CharacterController(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER;return _classCallCheck(this,CharacterController),(t=i.call(this,s,r))._upAxis=new e.Vector3(0,1,0),t._maxSlope=45,t._jumpSpeed=10,t._fallSpeed=55,t._gravity=new e.Vector3(0,3*-9.8,0),t._btKinematicCharacter=null,t._stepHeight=o,n&&(t._upAxis=n),t._controlBySimulation=!0,t}return _createClass(CharacterController,[{key:"_constructCharacter",value:function(){var t=e.ILaya3D.Physics3D._bullet;this._btKinematicCharacter&&t.btKinematicCharacterController_destroy(this._btKinematicCharacter);var i=CharacterController._btTempVector30;t.btVector3_setValue(i,this._upAxis.x,this._upAxis.y,this._upAxis.z),this._btKinematicCharacter=t.btKinematicCharacterController_create(this._btColliderObject,this._colliderShape._btShape,this._stepHeight,i),this.fallSpeed=this._fallSpeed,this.maxSlope=this._maxSlope,this.jumpSpeed=this._jumpSpeed,this.gravity=this._gravity}},{key:"_onShapeChange",value:function(t){_get(_getPrototypeOf(CharacterController.prototype),"_onShapeChange",this).call(this,t),this._constructCharacter()}},{key:"_onAdded",value:function(){var t=e.ILaya3D.Physics3D._bullet,i=t.btPairCachingGhostObject_create();t.btCollisionObject_setUserIndex(i,this.id),t.btCollisionObject_setCollisionFlags(i,c.COLLISIONFLAGS_CHARACTER_OBJECT),this._btColliderObject=i,this._colliderShape&&this._constructCharacter(),_get(_getPrototypeOf(CharacterController.prototype),"_onAdded",this).call(this)}},{key:"_addToSimulation",value:function(){this._simulation._characters.push(this),this._simulation._addCharacter(this,this._collisionGroup,this._canCollideWith)}},{key:"_removeFromSimulation",value:function(){this._simulation._removeCharacter(this);var t=this._simulation._characters;t.splice(t.indexOf(this),1)}},{key:"_cloneTo",value:function(t){_get(_getPrototypeOf(CharacterController.prototype),"_cloneTo",this).call(this,t);var e=t;e.stepHeight=this._stepHeight,e.upAxis=this._upAxis,e.maxSlope=this._maxSlope,e.jumpSpeed=this._jumpSpeed,e.fallSpeed=this._fallSpeed,e.gravity=this._gravity}},{key:"_onDestroy",value:function(){e.ILaya3D.Physics3D._bullet.btKinematicCharacterController_destroy(this._btKinematicCharacter),_get(_getPrototypeOf(CharacterController.prototype),"_onDestroy",this).call(this),this._btKinematicCharacter=null}},{key:"move",value:function(t){var i=CharacterController._btVector30,o=e.ILaya3D.Physics3D._bullet;o.btVector3_setValue(i,-t.x,t.y,t.z),o.btKinematicCharacterController_setWalkDirection(this._btKinematicCharacter,i)}},{key:"jump",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,i=e.ILaya3D.Physics3D._bullet,o=CharacterController._btVector30;t?(e.Utils3D._convertToBulletVec3(t,o,!0),i.btKinematicCharacterController_jump(this._btKinematicCharacter,o)):(i.btVector3_setValue(o,0,0,0),i.btKinematicCharacterController_jump(this._btKinematicCharacter,o))}},{key:"fallSpeed",get:function(){return this._fallSpeed},set:function(t){this._fallSpeed=t,e.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setFallSpeed(this._btKinematicCharacter,t)}},{key:"jumpSpeed",get:function(){return this._jumpSpeed},set:function(t){this._jumpSpeed=t,e.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setJumpSpeed(this._btKinematicCharacter,t)}},{key:"gravity",get:function(){return this._gravity},set:function(t){this._gravity=t;var i=e.ILaya3D.Physics3D._bullet,o=CharacterController._btTempVector30;i.btVector3_setValue(o,-t.x,t.y,t.z),i.btKinematicCharacterController_setGravity(this._btKinematicCharacter,o)}},{key:"maxSlope",get:function(){return this._maxSlope},set:function(t){this._maxSlope=t,e.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setMaxSlope(this._btKinematicCharacter,t/180*Math.PI)}},{key:"isGrounded",get:function(){return e.ILaya3D.Physics3D._bullet.btKinematicCharacterController_onGround(this._btKinematicCharacter)}},{key:"stepHeight",get:function(){return this._stepHeight},set:function(t){this._stepHeight=t,e.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setStepHeight(this._btKinematicCharacter,t)}},{key:"upAxis",get:function(){return this._upAxis},set:function(t){this._upAxis=t;var i=CharacterController._btTempVector30;e.Utils3D._convertToBulletVec3(t,i,!1),e.ILaya3D.Physics3D._bullet.btKinematicCharacterController_setUp(this._btKinematicCharacter,i)}}],[{key:"__init__",value:function(){CharacterController._btTempVector30=e.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),CharacterController}();u.UPAXIS_X=0,u.UPAXIS_Y=1,u.UPAXIS_Z=2;var d=function(){function Collision(){_classCallCheck(this,Collision),this._lastUpdateFrame=-2147483648,this._updateFrame=-2147483648,this._isTrigger=!1,this.contacts=[]}return _createClass(Collision,[{key:"_setUpdateFrame",value:function(t){this._lastUpdateFrame=this._updateFrame,this._updateFrame=t}}]),Collision}(),b=function ContactPoint(){_classCallCheck(this,ContactPoint),this._idCounter=0,this.colliderA=null,this.colliderB=null,this.distance=0,this.normal=new e.Vector3,this.positionOnA=new e.Vector3,this.positionOnB=new e.Vector3,this._id=++this._idCounter},y=function HitResult(){_classCallCheck(this,HitResult),this.succeeded=!1,this.collider=null,this.point=new e.Vector3,this.normal=new e.Vector3,this.hitFraction=0},C=function(){function CollisionTool(){_classCallCheck(this,CollisionTool),this._hitResultsPoolIndex=0,this._hitResultsPool=[],this._contactPonintsPoolIndex=0,this._contactPointsPool=[],this._collisionsPool=[],this._collisions={}}return _createClass(CollisionTool,[{key:"getHitResult",value:function(){var t=this._hitResultsPool[this._hitResultsPoolIndex++];return t||(t=new y,this._hitResultsPool.push(t)),t}},{key:"recoverAllHitResultsPool",value:function(){this._hitResultsPoolIndex=0}},{key:"getContactPoints",value:function(){var t=this._contactPointsPool[this._contactPonintsPoolIndex++];return t||(t=new b,this._contactPointsPool.push(t)),t}},{key:"recoverAllContactPointsPool",value:function(){this._contactPonintsPoolIndex=0}},{key:"getCollision",value:function(t,e){var i,o=t.id,n=e.id,s=this._collisions[o];return s&&(i=s[n]),i||(s||(s={},this._collisions[o]=s),(i=0===this._collisionsPool.length?new d:this._collisionsPool.pop())._colliderA=t,i._colliderB=e,s[n]=i),i}},{key:"recoverCollision",value:function(t){var e=t._colliderA.id,i=t._colliderB.id;this._collisions[e][i]=null,this._collisionsPool.push(t)}},{key:"garbageCollection",value:function(){for(var t in this._hitResultsPoolIndex=0,this._hitResultsPool.length=0,this._contactPonintsPoolIndex=0,this._contactPointsPool.length=0,this._collisionsPool.length=0,this._collisionsPool){var e=this._collisionsPool[t],i=!0;for(var o in e)e[o]?i=!1:delete e[o];i&&delete this._collisionsPool[t]}}}]),CollisionTool}(),p=function(t){_inherits(PhysicsTriggerComponent,c);var i=_createSuper(PhysicsTriggerComponent);function PhysicsTriggerComponent(t,e){var o;return _classCallCheck(this,PhysicsTriggerComponent),(o=i.call(this,t,e))._isTrigger=!1,o}return _createClass(PhysicsTriggerComponent,[{key:"_onAdded",value:function(){_get(_getPrototypeOf(PhysicsTriggerComponent.prototype),"_onAdded",this).call(this),this.isTrigger=this._isTrigger}},{key:"_cloneTo",value:function(t){_get(_getPrototypeOf(PhysicsTriggerComponent.prototype),"_cloneTo",this).call(this,t),t.isTrigger=this._isTrigger}},{key:"isTrigger",get:function(){return this._isTrigger},set:function(t){this._isTrigger=t;var i=e.ILaya3D.Physics3D._bullet;if(this._btColliderObject){var o=i.btCollisionObject_getCollisionFlags(this._btColliderObject);t?0==(o&c.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&i.btCollisionObject_setCollisionFlags(this._btColliderObject,o|c.COLLISIONFLAGS_NO_CONTACT_RESPONSE):0!=(o&c.COLLISIONFLAGS_NO_CONTACT_RESPONSE)&&i.btCollisionObject_setCollisionFlags(this._btColliderObject,o^c.COLLISIONFLAGS_NO_CONTACT_RESPONSE)}}}]),PhysicsTriggerComponent}(),g=function(t){_inherits(PhysicsCollider,p);var i=_createSuper(PhysicsCollider);function PhysicsCollider(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER;return _classCallCheck(this,PhysicsCollider),(t=i.call(this,o,n))._enableProcessCollisions=!1,t}return _createClass(PhysicsCollider,[{key:"_addToSimulation",value:function(){this._simulation._addPhysicsCollider(this,this._collisionGroup,this._canCollideWith)}},{key:"_removeFromSimulation",value:function(){this._simulation._removePhysicsCollider(this)}},{key:"_parse",value:function(t){null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),_get(_getPrototypeOf(PhysicsCollider.prototype),"_parse",this).call(this,t),this._parseShape(t.shapes)}},{key:"_onAdded",value:function(){var t=e.Physics3D._bullet,i=t.btCollisionObject_create();t.btCollisionObject_setUserIndex(i,this.id),t.btCollisionObject_forceActivationState(i,c.ACTIVATIONSTATE_DISABLE_SIMULATION);var o=t.btCollisionObject_getCollisionFlags(i);this.owner.isStatic?((o&c.COLLISIONFLAGS_KINEMATIC_OBJECT)>0&&(o^=c.COLLISIONFLAGS_KINEMATIC_OBJECT),o|=c.COLLISIONFLAGS_STATIC_OBJECT):((o&c.COLLISIONFLAGS_STATIC_OBJECT)>0&&(o^=c.COLLISIONFLAGS_STATIC_OBJECT),o|=c.COLLISIONFLAGS_KINEMATIC_OBJECT),t.btCollisionObject_setCollisionFlags(i,o),this._btColliderObject=i,_get(_getPrototypeOf(PhysicsCollider.prototype),"_onAdded",this).call(this)}}]),PhysicsCollider}(),f=function(t){_inherits(PhysicsUpdateList,e.SingletonList);var i=_createSuper(PhysicsUpdateList);function PhysicsUpdateList(){return _classCallCheck(this,PhysicsUpdateList),i.call(this)}return _createClass(PhysicsUpdateList,[{key:"add",value:function(t){if(-1!==t._inPhysicUpdateListIndex)throw"PhysicsUpdateList:element has  in  PhysicsUpdateList.";this._add(t),t._inPhysicUpdateListIndex=this.length++}},{key:"remove",value:function(t){var e=t._inPhysicUpdateListIndex;if(this.length--,e!==this.length){var i=this.elements[this.length];this.elements[e]=i,i._inPhysicUpdateListIndex=e}t._inPhysicUpdateListIndex=-1}}]),PhysicsUpdateList}(),m=function(){function PhysicsSimulation(t){_classCallCheck(this,PhysicsSimulation),this._gravity=new e.Vector3(0,-10,0),this._btVector3Zero=e.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0),this._btDefaultQuaternion=e.ILaya3D.Physics3D._bullet.btQuaternion_create(0,0,0,-1),this._collisionsUtils=new C,this._previousFrameCollisions=[],this._currentFrameCollisions=[],this._currentConstraint={},this._physicsUpdateList=new f,this._characters=[],this._updatedRigidbodies=0,this.maxSubSteps=1,this.fixedTimeStep=1/60,this.maxSubSteps=t.maxSubSteps,this.fixedTimeStep=t.fixedTimeStep;var i=e.ILaya3D.Physics3D._bullet;this._btCollisionConfiguration=i.btDefaultCollisionConfiguration_create(),this._btDispatcher=i.btCollisionDispatcher_create(this._btCollisionConfiguration),this._btBroadphase=i.btDbvtBroadphase_create(),i.btOverlappingPairCache_setInternalGhostPairCallback(i.btDbvtBroadphase_getOverlappingPairCache(this._btBroadphase),i.btGhostPairCallback_create());var o=t.flags;if(o&PhysicsSimulation.PHYSICSENGINEFLAGS_COLLISIONSONLY)this._btCollisionWorld=new i.btCollisionWorld(this._btDispatcher,this._btBroadphase,this._btCollisionConfiguration);else{if(o&PhysicsSimulation.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT)throw"PhysicsSimulation:SoftBody processing is not yet available";var n=i.btSequentialImpulseConstraintSolver_create();this._btDiscreteDynamicsWorld=i.btDiscreteDynamicsWorld_create(this._btDispatcher,this._btBroadphase,n,this._btCollisionConfiguration),this._btCollisionWorld=this._btDiscreteDynamicsWorld}this._btDiscreteDynamicsWorld&&(this._btSolverInfo=i.btDynamicsWorld_getSolverInfo(this._btDiscreteDynamicsWorld),this._btDispatchInfo=i.btCollisionWorld_getDispatchInfo(this._btDiscreteDynamicsWorld)),this._btClosestRayResultCallback=i.ClosestRayResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btAllHitsRayResultCallback=i.AllHitsRayResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btClosestConvexResultCallback=i.ClosestConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero),this._btAllConvexResultCallback=i.AllConvexResultCallback_create(this._btVector3Zero,this._btVector3Zero),this.setHitsRayResultCallbackFlag(),i.btGImpactCollisionAlgorithm_RegisterAlgorithm(this._btDispatcher)}return _createClass(PhysicsSimulation,[{key:"_simulate",value:function(t){this._updatedRigidbodies=0;var i=e.ILaya3D.Physics3D._bullet;this._btDiscreteDynamicsWorld?i.btDiscreteDynamicsWorld_stepSimulation(this._btDiscreteDynamicsWorld,t,this.maxSubSteps,this.fixedTimeStep):i.PerformDiscreteCollisionDetection(this._btCollisionWorld)}},{key:"_destroy",value:function(){var t=e.ILaya3D.Physics3D._bullet;this._btDiscreteDynamicsWorld?(t.btCollisionWorld_destroy(this._btDiscreteDynamicsWorld),this._btDiscreteDynamicsWorld=null):(t.btCollisionWorld_destroy(this._btCollisionWorld),this._btCollisionWorld=null),t.btDbvtBroadphase_destroy(this._btBroadphase),this._btBroadphase=null,t.btCollisionDispatcher_destroy(this._btDispatcher),this._btDispatcher=null,t.btDefaultCollisionConfiguration_destroy(this._btCollisionConfiguration),this._btCollisionConfiguration=null}},{key:"_addPhysicsCollider",value:function(t,i,o){e.ILaya3D.Physics3D._bullet.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,i,o)}},{key:"_removePhysicsCollider",value:function(t){e.ILaya3D.Physics3D._bullet.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject)}},{key:"_addRigidBody",value:function(t,i,o){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";e.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_addRigidBody(this._btCollisionWorld,t._btColliderObject,i,o)}},{key:"_removeRigidBody",value:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";e.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_removeRigidBody(this._btCollisionWorld,t._btColliderObject)}},{key:"_addCharacter",value:function(t,i,o){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var n=e.ILaya3D.Physics3D._bullet;n.btCollisionWorld_addCollisionObject(this._btCollisionWorld,t._btColliderObject,i,o),n.btDynamicsWorld_addAction(this._btCollisionWorld,t._btKinematicCharacter)}},{key:"_removeCharacter",value:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";var i=e.ILaya3D.Physics3D._bullet;i.btCollisionWorld_removeCollisionObject(this._btCollisionWorld,t._btColliderObject),i.btDynamicsWorld_removeAction(this._btCollisionWorld,t._btKinematicCharacter)}},{key:"raycastFromTo",value:function(t,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=e.ILaya3D.Physics3D._bullet,a=this._btClosestRayResultCallback,l=PhysicsSimulation._btTempVector30,_=PhysicsSimulation._btTempVector31;if(r.btVector3_setValue(l,-t.x,t.y,t.z),r.btVector3_setValue(_,-i.x,i.y,i.z),r.ClosestRayResultCallback_set_m_rayFromWorld(a,l),r.ClosestRayResultCallback_set_m_rayToWorld(a,_),r.RayResultCallback_set_m_collisionFilterGroup(a,n),r.RayResultCallback_set_m_collisionFilterMask(a,s),r.RayResultCallback_set_m_collisionObject(a,null),r.RayResultCallback_set_m_closestHitFraction(a,1),r.btCollisionWorld_rayTest(this._btCollisionWorld,l,_,a),r.RayResultCallback_hasHit(a)){if(o){o.succeeded=!0,o.collider=c._physicObjectsMap[r.btCollisionObject_getUserIndex(r.RayResultCallback_get_m_collisionObject(a))],o.hitFraction=r.RayResultCallback_get_m_closestHitFraction(a);var h=r.ClosestRayResultCallback_get_m_hitPointWorld(a),u=o.point;u.x=-r.btVector3_x(h),u.y=r.btVector3_y(h),u.z=r.btVector3_z(h);var d=r.ClosestRayResultCallback_get_m_hitNormalWorld(a),b=o.normal;b.x=-r.btVector3_x(d),b.y=r.btVector3_y(d),b.z=r.btVector3_z(d)}return!0}return o&&(o.succeeded=!1),!1}},{key:"raycastAllFromTo",value:function(t,i,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=e.ILaya3D.Physics3D._bullet,a=this._btAllHitsRayResultCallback,l=PhysicsSimulation._btTempVector30,_=PhysicsSimulation._btTempVector31;o.length=0,r.btVector3_setValue(l,-t.x,t.y,t.z),r.btVector3_setValue(_,-i.x,i.y,i.z),r.AllHitsRayResultCallback_set_m_rayFromWorld(a,l),r.AllHitsRayResultCallback_set_m_rayToWorld(a,_),r.RayResultCallback_set_m_collisionFilterGroup(a,n),r.RayResultCallback_set_m_collisionFilterMask(a,s);var h=r.AllHitsRayResultCallback_get_m_collisionObjects(a),u=r.AllHitsRayResultCallback_get_m_hitPointWorld(a),d=r.AllHitsRayResultCallback_get_m_hitNormalWorld(a),b=r.AllHitsRayResultCallback_get_m_hitFractions(a);r.tBtCollisionObjectArray_clear(h),r.tVector3Array_clear(u),r.tVector3Array_clear(d),r.tScalarArray_clear(b),r.btCollisionWorld_rayTest(this._btCollisionWorld,l,_,a);var y=r.tBtCollisionObjectArray_size(h);if(y>0){this._collisionsUtils.recoverAllHitResultsPool();for(var C=0;C<y;C++){var p=this._collisionsUtils.getHitResult();o.push(p),p.succeeded=!0,p.collider=c._physicObjectsMap[r.btCollisionObject_getUserIndex(r.tBtCollisionObjectArray_at(h,C))],p.hitFraction=r.tScalarArray_at(b,C);var g=r.tVector3Array_at(u,C),f=p.point;f.x=-r.btVector3_x(g),f.y=r.btVector3_y(g),f.z=r.btVector3_z(g);var m=r.tVector3Array_at(d,C),S=p.normal;S.x=-r.btVector3_x(m),S.y=r.btVector3_y(m),S.z=r.btVector3_z(m)}return!0}return!1}},{key:"rayCast",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2147483647,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=t.origin,a=PhysicsSimulation._tempVector30;return e.Vector3.normalize(t.direction,a),e.Vector3.scale(a,o,a),e.Vector3.add(r,a,a),this.raycastFromTo(r,a,i,n,s)}},{key:"rayCastAll",value:function(t,i){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2147483647,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,r=t.origin,a=PhysicsSimulation._tempVector30;return e.Vector3.normalize(t.direction,a),e.Vector3.scale(a,o,a),e.Vector3.add(r,a,a),this.raycastAllFromTo(r,a,i,n,s)}},{key:"shapeCast",value:function(t,i,o){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,_=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=e.ILaya3D.Physics3D._bullet,u=this._btClosestConvexResultCallback,d=PhysicsSimulation._btTempVector30,b=PhysicsSimulation._btTempVector31,y=PhysicsSimulation._btTempQuaternion0,C=PhysicsSimulation._btTempQuaternion1,p=PhysicsSimulation._btTempTransform0,g=PhysicsSimulation._btTempTransform1,f=t._btShape;if(h.btVector3_setValue(d,-i.x,i.y,i.z),h.btVector3_setValue(b,-o.x,o.y,o.z),h.ConvexResultCallback_set_m_collisionFilterGroup(u,a),h.ConvexResultCallback_set_m_collisionFilterMask(u,l),h.btTransform_setOrigin(p,d),h.btTransform_setOrigin(g,b),s?(h.btQuaternion_setValue(y,-s.x,s.y,s.z,-s.w),h.btTransform_setRotation(p,y)):h.btTransform_setRotation(p,this._btDefaultQuaternion),r?(h.btQuaternion_setValue(C,-r.x,r.y,r.z,-r.w),h.btTransform_setRotation(g,C)):h.btTransform_setRotation(g,this._btDefaultQuaternion),h.ClosestConvexResultCallback_set_m_hitCollisionObject(u,null),h.ConvexResultCallback_set_m_closestHitFraction(u,1),h.btCollisionWorld_convexSweepTest(this._btCollisionWorld,f,p,g,u,_),h.ConvexResultCallback_hasHit(u)){if(n){n.succeeded=!0,n.collider=c._physicObjectsMap[h.btCollisionObject_getUserIndex(h.ClosestConvexResultCallback_get_m_hitCollisionObject(u))],n.hitFraction=h.ConvexResultCallback_get_m_closestHitFraction(u);var m=h.ClosestConvexResultCallback_get_m_hitPointWorld(u),S=h.ClosestConvexResultCallback_get_m_hitNormalWorld(u),T=n.point,O=n.normal;T.x=-h.btVector3_x(m),T.y=h.btVector3_y(m),T.z=h.btVector3_z(m),O.x=-h.btVector3_x(S),O.y=h.btVector3_y(S),O.z=h.btVector3_z(S)}return!0}return n&&(n.succeeded=!1),!1}},{key:"shapeCastAll",value:function(t,i,o,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,r=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER,_=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,h=e.ILaya3D.Physics3D._bullet,u=this._btAllConvexResultCallback,d=PhysicsSimulation._btTempVector30,b=PhysicsSimulation._btTempVector31,y=PhysicsSimulation._btTempQuaternion0,C=PhysicsSimulation._btTempQuaternion1,p=PhysicsSimulation._btTempTransform0,g=PhysicsSimulation._btTempTransform1,f=t._btShape;n.length=0,h.btVector3_setValue(d,-i.x,i.y,i.z),h.btVector3_setValue(b,-o.x,o.y,o.z),h.ConvexResultCallback_set_m_collisionFilterGroup(u,a),h.ConvexResultCallback_set_m_collisionFilterMask(u,l),h.btTransform_setOrigin(p,d),h.btTransform_setOrigin(g,b),s?(h.btQuaternion_setValue(y,-s.x,s.y,s.z,-s.w),h.btTransform_setRotation(p,y)):h.btTransform_setRotation(p,this._btDefaultQuaternion),r?(h.btQuaternion_setValue(C,-r.x,r.y,r.z,-r.w),h.btTransform_setRotation(g,C)):h.btTransform_setRotation(g,this._btDefaultQuaternion);var m=h.AllConvexResultCallback_get_m_collisionObjects(u),S=h.AllConvexResultCallback_get_m_hitPointWorld(u),T=h.AllConvexResultCallback_get_m_hitNormalWorld(u),O=h.AllConvexResultCallback_get_m_hitFractions(u);h.tVector3Array_clear(S),h.tVector3Array_clear(T),h.tScalarArray_clear(O),h.tBtCollisionObjectArray_clear(m),h.btCollisionWorld_convexSweepTest(this._btCollisionWorld,f,p,g,u,_);var I=h.tBtCollisionObjectArray_size(m);if(I>0){this._collisionsUtils.recoverAllHitResultsPool();for(var D=0;D<I;D++){var v=this._collisionsUtils.getHitResult();n.push(v),v.succeeded=!0,v.collider=c._physicObjectsMap[h.btCollisionObject_getUserIndex(h.tBtCollisionObjectArray_at(m,D))],v.hitFraction=h.tScalarArray_at(O,D);var L=h.tVector3Array_at(S,D),P=v.point;P.x=-h.btVector3_x(L),P.y=h.btVector3_y(L),P.z=h.btVector3_z(L);var A=h.tVector3Array_at(T,D),R=v.normal;R.x=-h.btVector3_x(A),R.y=h.btVector3_y(A),R.z=h.btVector3_z(A)}return!0}return!1}},{key:"addConstraint",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";e.ILaya3D.Physics3D._bullet.btCollisionWorld_addConstraint(this._btDiscreteDynamicsWorld,t._btConstraint,i),this._currentConstraint[t.id]=t}},{key:"removeConstraint",value:function(t){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";e.ILaya3D.Physics3D._bullet.btCollisionWorld_removeConstraint(this._btDiscreteDynamicsWorld,t._btConstraint),delete this._currentConstraint[t.id]}},{key:"setHitsRayResultCallbackFlag",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,i=e.ILaya3D.Physics3D._bullet;i.RayResultCallback_set_m_flags(this._btAllHitsRayResultCallback,t),i.RayResultCallback_set_m_flags(this._btClosestRayResultCallback,t)}},{key:"_updatePhysicsTransformFromRender",value:function(){for(var t=this._physicsUpdateList.elements,e=0,i=this._physicsUpdateList.length;e<i;e++){var o=t[e];o._derivePhysicsTransformation(!1),o._inPhysicUpdateListIndex=-1}this._physicsUpdateList.length=0}},{key:"_updateCharacters",value:function(){for(var t=0,i=this._characters.length;t<i;t++){var o=this._characters[t];o._updateTransformComponent(e.ILaya3D.Physics3D._bullet.btCollisionObject_getWorldTransform(o._btColliderObject))}}},{key:"_updateCollisions",value:function(){this._collisionsUtils.recoverAllContactPointsPool();var t=this._currentFrameCollisions;this._currentFrameCollisions=this._previousFrameCollisions,this._currentFrameCollisions.length=0,this._previousFrameCollisions=t;for(var i=e.Stat.loopCount,o=e.ILaya3D.Physics3D._bullet,n=o.btDispatcher_getNumManifolds(this._btDispatcher),s=0;s<n;s++){var r,a=o.btDispatcher_getManifoldByIndexInternal(this._btDispatcher,s),l=c._physicObjectsMap[o.btCollisionObject_getUserIndex(o.btPersistentManifold_getBody0(a))],_=c._physicObjectsMap[o.btCollisionObject_getUserIndex(o.btPersistentManifold_getBody1(a))],h=null,u=null;if((l.isTrigger||_.isTrigger)&&(l.owner._needProcessTriggers||_.owner._needProcessTriggers))for(var d=o.btPersistentManifold_getNumContacts(a),b=0;b<d;b++){var y=o.btPersistentManifold_getContactPoint(a,b),C=o.btManifoldPoint_getDistance(y);if(C<=0){u=(h=this._collisionsUtils.getCollision(l,_)).contacts,(r=h._updateFrame!==i)&&(h._isTrigger=!0,u.length=0);break}}else if((l.owner._needProcessCollisions||_.owner._needProcessCollisions)&&(l._enableProcessCollisions||_._enableProcessCollisions))for(d=o.btPersistentManifold_getNumContacts(a),b=0;b<d;b++)if(y=o.btPersistentManifold_getContactPoint(a,b),(C=o.btManifoldPoint_getDistance(y))<=0){var p=this._collisionsUtils.getContactPoints();p.colliderA=l,p.colliderB=_,p.distance=C;var g=o.btManifoldPoint_get_m_normalWorldOnB(y),f=p.normal;f.x=-o.btVector3_x(g),f.y=o.btVector3_y(g),f.z=o.btVector3_z(g);var m=o.btManifoldPoint_get_m_positionWorldOnA(y),S=p.positionOnA;S.x=-o.btVector3_x(m),S.y=o.btVector3_y(m),S.z=o.btVector3_z(m);var T=o.btManifoldPoint_get_m_positionWorldOnB(y),O=p.positionOnB;O.x=-o.btVector3_x(T),O.y=o.btVector3_y(T),O.z=o.btVector3_z(T),h||(u=(h=this._collisionsUtils.getCollision(l,_)).contacts,(r=h._updateFrame!==i)&&(h._isTrigger=!1,u.length=0)),u.push(p)}h&&r&&(this._currentFrameCollisions.push(h),h._setUpdateFrame(i))}}},{key:"_eventScripts",value:function(){for(var t=e.Stat.loopCount,i=0,o=this._currentFrameCollisions.length;i<o;i++){var n=this._currentFrameCollisions[i],s=n._colliderA,r=n._colliderB;if(!s.destroyed&&!r.destroyed)if(t-n._lastUpdateFrame==1){var a=s.owner,l=a._scripts;if(l)if(n._isTrigger){if(a._needProcessTriggers)for(var _=0,c=l.length;_<c;_++)l[_].onTriggerStay(r)}else if(a._needProcessCollisions)for(_=0,c=l.length;_<c;_++)n.other=r,l[_].onCollisionStay(n);var h=r.owner,u=h._scripts;if(u)if(n._isTrigger){if(h._needProcessTriggers)for(_=0,c=u.length;_<c;_++)u[_].onTriggerStay(s)}else if(h._needProcessCollisions)for(_=0,c=u.length;_<c;_++)n.other=s,u[_].onCollisionStay(n)}else{if(l=(a=s.owner)._scripts)if(n._isTrigger){if(a._needProcessTriggers)for(_=0,c=l.length;_<c;_++)l[_].onTriggerEnter(r)}else if(a._needProcessCollisions)for(_=0,c=l.length;_<c;_++)n.other=r,l[_].onCollisionEnter(n);if(u=(h=r.owner)._scripts)if(n._isTrigger){if(h._needProcessTriggers)for(_=0,c=u.length;_<c;_++)u[_].onTriggerEnter(s)}else if(h._needProcessCollisions)for(_=0,c=u.length;_<c;_++)n.other=s,u[_].onCollisionEnter(n)}}for(i=0,o=this._previousFrameCollisions.length;i<o;i++){var d=this._previousFrameCollisions[i],b=d._colliderA,y=d._colliderB;if(!b.destroyed&&!y.destroyed&&t-d._updateFrame==1){if(this._collisionsUtils.recoverCollision(d),l=(a=b.owner)._scripts)if(d._isTrigger){if(a._needProcessTriggers)for(_=0,c=l.length;_<c;_++)l[_].onTriggerExit(y)}else if(a._needProcessCollisions)for(_=0,c=l.length;_<c;_++)d.other=y,l[_].onCollisionExit(d);if(u=(h=y.owner)._scripts)if(d._isTrigger){if(h._needProcessTriggers)for(_=0,c=u.length;_<c;_++)u[_].onTriggerExit(b)}else if(h._needProcessCollisions)for(_=0,c=u.length;_<c;_++)d.other=b,u[_].onCollisionExit(d)}}for(var C in this._currentConstraint){var p=this._currentConstraint[C],g=p.owner._scripts;if(p.enabled&&p._isBreakConstrained()&&g&&0!=g.length)for(i=0,o=g.length;i<o;i++)g[i].onJointBreak()}}},{key:"clearForces",value:function(){if(!this._btDiscreteDynamicsWorld)throw"Cannot perform this action when the physics engine is set to CollisionsOnly";e.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_clearForces(this._btDiscreteDynamicsWorld)}},{key:"continuousCollisionDetection",get:function(){return e.ILaya3D.Physics3D._bullet.btCollisionWorld_get_m_useContinuous(this._btDispatchInfo)},set:function(t){e.ILaya3D.Physics3D._bullet.btCollisionWorld_set_m_useContinuous(this._btDispatchInfo,t)}},{key:"gravity",get:function(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";return this._gravity},set:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot perform this action when the physics engine is set to CollisionsOnly";this._gravity=t;var i=e.ILaya3D.Physics3D._bullet,o=PhysicsSimulation._btTempVector30;i.btVector3_setValue(o,-t.x,t.y,t.z),i.btDiscreteDynamicsWorld_setGravity(this._btDiscreteDynamicsWorld,o)}},{key:"speculativeContactRestitution",get:function(){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";return e.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_getApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld)},set:function(t){if(!this._btDiscreteDynamicsWorld)throw"Simulation:Cannot Cannot perform this action when the physics engine is set to CollisionsOnly";e.ILaya3D.Physics3D._bullet.btDiscreteDynamicsWorld_setApplySpeculativeContactRestitution(this._btDiscreteDynamicsWorld,t)}}],[{key:"__init__",value:function(){var t=e.ILaya3D.Physics3D._bullet;PhysicsSimulation._btTempVector30=t.btVector3_create(0,0,0),PhysicsSimulation._btTempVector31=t.btVector3_create(0,0,0),PhysicsSimulation._btTempQuaternion0=t.btQuaternion_create(0,0,0,1),PhysicsSimulation._btTempQuaternion1=t.btQuaternion_create(0,0,0,1),PhysicsSimulation._btTempTransform0=t.btTransform_create(),PhysicsSimulation._btTempTransform1=t.btTransform_create()}},{key:"createConstraint",value:function(){}}]),PhysicsSimulation}();m.PHYSICSENGINEFLAGS_NONE=0,m.PHYSICSENGINEFLAGS_COLLISIONSONLY=1,m.PHYSICSENGINEFLAGS_SOFTBODYSUPPORT=2,m.PHYSICSENGINEFLAGS_MULTITHREADED=4,m.PHYSICSENGINEFLAGS_USEHARDWAREWHENPOSSIBLE=8,m.SOLVERMODE_RANDMIZE_ORDER=1,m.SOLVERMODE_FRICTION_SEPARATE=2,m.SOLVERMODE_USE_WARMSTARTING=4,m.SOLVERMODE_USE_2_FRICTION_DIRECTIONS=16,m.SOLVERMODE_ENABLE_FRICTION_DIRECTION_CACHING=32,m.SOLVERMODE_DISABLE_VELOCITY_DEPENDENT_FRICTION_DIRECTION=64,m.SOLVERMODE_CACHE_FRIENDLY=128,m.SOLVERMODE_SIMD=256,m.SOLVERMODE_INTERLEAVE_CONTACT_AND_FRICTION_CONSTRAINTS=512,m.SOLVERMODE_ALLOW_ZERO_LENGTH_FRICTION_DIRECTIONS=1024,m.HITSRAYRESULTCALLBACK_FLAG_NONE=0,m.HITSRAYRESULTCALLBACK_FLAG_FILTERBACKFACESS=1,m.HITSRAYRESULTCALLBACK_FLAG_KEEPUNFILIPPEDNORMAL=2,m.HITSRAYRESULTCALLBACK_FLAG_USESUBSIMPLEXCONVEXCASTRAYTEST=4,m.HITSRAYRESULTCALLBACK_FLAG_USEGJKCONVEXCASTRAYTEST=8,m.HITSRAYRESULTCALLBACK_FLAG_TERMINATOR=4294967295,m._tempVector30=new e.Vector3,m.disableSimulation=!1;var S=function(t){_inherits(Rigidbody3D,p);var i=_createSuper(Rigidbody3D);function Rigidbody3D(){var t,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:e.Physics3DUtils.COLLISIONFILTERGROUP_DEFAULTFILTER,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.Physics3DUtils.COLLISIONFILTERGROUP_ALLFILTER;return _classCallCheck(this,Rigidbody3D),(t=i.call(this,o,n))._isKinematic=!1,t._mass=1,t._gravity=new e.Vector3(0,-10,0),t._angularDamping=0,t._linearDamping=0,t._overrideGravity=!1,t._totalTorque=new e.Vector3(0,0,0),t._totalForce=new e.Vector3(0,0,0),t._linearVelocity=new e.Vector3,t._angularVelocity=new e.Vector3,t._linearFactor=new e.Vector3(1,1,1),t._angularFactor=new e.Vector3(1,1,1),t._detectCollisions=!0,t._controlBySimulation=!0,t}return _createClass(Rigidbody3D,[{key:"_updateMass",value:function(t){if(this._btColliderObject&&this._colliderShape){var i=e.ILaya3D.Physics3D._bullet;i.btCollisionShape_calculateLocalInertia(this._colliderShape._btShape,t,Rigidbody3D._btInertia),i.btRigidBody_setMassProps(this._btColliderObject,t,Rigidbody3D._btInertia),i.btRigidBody_updateInertiaTensor(this._btColliderObject)}}},{key:"_onScaleChange",value:function(t){_get(_getPrototypeOf(Rigidbody3D.prototype),"_onScaleChange",this).call(this,t),this._updateMass(this._isKinematic?0:this._mass)}},{key:"_derivePhysicsTransformation",value:function(t){var i=e.ILaya3D.Physics3D._bullet,o=this._btColliderObject,n=i.btCollisionObject_getWorldTransform(o),s=Rigidbody3D._btTransform0;i.btTransform_equal(s,n),this._innerDerivePhysicsTransformation(s,t),i.btRigidBody_setCenterOfMassTransform(o,s)}},{key:"_onAdded",value:function(){var t=e.ILaya3D.Physics3D._bullet,i=t.layaMotionState_create();t.layaMotionState_set_rigidBodyID(i,this._id),this._btLayaMotionState=i;var o=t.btRigidBodyConstructionInfo_create(0,i,null,Rigidbody3D._btVector3Zero),n=t.btRigidBody_create(o);t.btCollisionObject_setUserIndex(n,this.id),this._btColliderObject=n,_get(_getPrototypeOf(Rigidbody3D.prototype),"_onAdded",this).call(this),this.mass=this._mass,this.linearFactor=this._linearFactor,this.angularFactor=this._angularFactor,this.linearDamping=this._linearDamping,this.angularDamping=this._angularDamping,this.overrideGravity=this._overrideGravity,this.gravity=this._gravity,this.isKinematic=this._isKinematic,t.btRigidBodyConstructionInfo_destroy(o)}},{key:"_onEnable",value:function(){_get(_getPrototypeOf(Rigidbody3D.prototype),"_onEnable",this).call(this),this._constaintRigidbodyA&&this._constaintRigidbodyA.connectedBody._simulation&&(this._constaintRigidbodyA._createConstraint(),this._constaintRigidbodyA._onEnable()),this._constaintRigidbodyB&&this._constaintRigidbodyB.ownBody._simulation&&(this._constaintRigidbodyB._createConstraint(),this._constaintRigidbodyB._onEnable())}},{key:"_onShapeChange",value:function(t){if(_get(_getPrototypeOf(Rigidbody3D.prototype),"_onShapeChange",this).call(this,t),this._isKinematic)this._updateMass(0);else{var i=e.ILaya3D.Physics3D._bullet;i.btRigidBody_setCenterOfMassTransform(this._btColliderObject,i.btCollisionObject_getWorldTransform(this._btColliderObject)),this._updateMass(this._mass)}}},{key:"_parse",value:function(t){if(null!=t.friction&&(this.friction=t.friction),null!=t.rollingFriction&&(this.rollingFriction=t.rollingFriction),null!=t.restitution&&(this.restitution=t.restitution),null!=t.isTrigger&&(this.isTrigger=t.isTrigger),null!=t.mass&&(this.mass=t.mass),null!=t.linearDamping&&(this.linearDamping=t.linearDamping),null!=t.angularDamping&&(this.angularDamping=t.angularDamping),null!=t.overrideGravity&&(this.overrideGravity=t.overrideGravity),null!=t.linearFactor){var e=this.linearFactor;e.fromArray(t.linearFactor),this.linearFactor=e}if(null!=t.angularFactor){var i=this.angularFactor;i.fromArray(t.angularFactor),this.angularFactor=i}t.gravity&&(this.gravity.fromArray(t.gravity),this.gravity=this.gravity),_get(_getPrototypeOf(Rigidbody3D.prototype),"_parse",this).call(this,t),this._parseShape(t.shapes),null!=t.isKinematic&&(this.isKinematic=t.isKinematic)}},{key:"_onDestroy",value:function(){e.ILaya3D.Physics3D._bullet.btMotionState_destroy(this._btLayaMotionState),_get(_getPrototypeOf(Rigidbody3D.prototype),"_onDestroy",this).call(this),this._btLayaMotionState=null,this._gravity=null,this._totalTorque=null,this._linearVelocity=null,this._angularVelocity=null,this._linearFactor=null,this._angularFactor=null,this.constaintRigidbodyA&&this.constaintRigidbodyA._breakConstrained(),this.constaintRigidbodyB&&(this.constaintRigidbodyB.connectedBody=null,this.constaintRigidbodyB._onDisable())}},{key:"_addToSimulation",value:function(){this._simulation._addRigidBody(this,this._collisionGroup,this._detectCollisions?this._canCollideWith:0)}},{key:"_removeFromSimulation",value:function(){this._simulation._removeRigidBody(this)}},{key:"_cloneTo",value:function(t){_get(_getPrototypeOf(Rigidbody3D.prototype),"_cloneTo",this).call(this,t);var e=t;e.isKinematic=this._isKinematic,e.mass=this._mass,e.gravity=this._gravity,e.angularDamping=this._angularDamping,e.linearDamping=this._linearDamping,e.overrideGravity=this._overrideGravity,e.linearVelocity=this._linearVelocity,e.angularVelocity=this._angularVelocity,e.linearFactor=this._linearFactor,e.angularFactor=this._angularFactor,e.detectCollisions=this._detectCollisions}},{key:"applyForce",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var o=e.ILaya3D.Physics3D._bullet,n=Rigidbody3D._btTempVector30;if(o.btVector3_setValue(n,-t.x,t.y,t.z),i){var s=Rigidbody3D._btTempVector31;o.btVector3_setValue(s,-i.x,i.y,i.z),o.btRigidBody_applyForce(this._btColliderObject,n,s)}else o.btRigidBody_applyCentralForce(this._btColliderObject,n)}},{key:"applyTorque",value:function(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=e.ILaya3D.Physics3D._bullet,o=Rigidbody3D._btTempVector30;i.btVector3_setValue(o,-t.x,t.y,t.z),i.btRigidBody_applyTorque(this._btColliderObject,o)}},{key:"applyImpulse",value:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var o=e.ILaya3D.Physics3D._bullet;o.btVector3_setValue(Rigidbody3D._btImpulse,-t.x,t.y,t.z),i?(o.btVector3_setValue(Rigidbody3D._btImpulseOffset,-i.x,i.y,i.z),o.btRigidBody_applyImpulse(this._btColliderObject,Rigidbody3D._btImpulse,Rigidbody3D._btImpulseOffset)):o.btRigidBody_applyCentralImpulse(this._btColliderObject,Rigidbody3D._btImpulse)}},{key:"applyTorqueImpulse",value:function(t){if(null==this._btColliderObject)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=e.ILaya3D.Physics3D._bullet,o=Rigidbody3D._btTempVector30;i.btVector3_setValue(o,-t.x,t.y,t.z),i.btRigidBody_applyTorqueImpulse(this._btColliderObject,o)}},{key:"wakeUp",value:function(){this._btColliderObject&&e.ILaya3D.Physics3D._bullet.btCollisionObject_activate(this._btColliderObject,!1)}},{key:"clearForces",value:function(){var t=this._btColliderObject;if(null==t)throw"Attempted to call a Physics function that is avaliable only when the Entity has been already added to the Scene.";var i=e.ILaya3D.Physics3D._bullet;i.btRigidBody_clearForces(t);var o=Rigidbody3D._btVector3Zero;i.btCollisionObject_setInterpolationLinearVelocity(t,o),i.btRigidBody_setLinearVelocity(t,o),i.btCollisionObject_setInterpolationAngularVelocity(t,o),i.btRigidBody_setAngularVelocity(t,o)}},{key:"mass",get:function(){return this._mass},set:function(t){t=Math.max(t,1e-7),this._mass=t,this._isKinematic||this._updateMass(t)}},{key:"isKinematic",get:function(){return this._isKinematic},set:function(t){this._isKinematic=t,this._controlBySimulation=!t;var i=e.ILaya3D.Physics3D._bullet,o=!!(this._simulation&&this._enabled&&this._colliderShape);o&&this._removeFromSimulation();var n=this._btColliderObject,s=i.btCollisionObject_getCollisionFlags(n);t?(s|=c.COLLISIONFLAGS_KINEMATIC_OBJECT,i.btCollisionObject_setCollisionFlags(n,s),i.btCollisionObject_forceActivationState(this._btColliderObject,c.ACTIVATIONSTATE_DISABLE_DEACTIVATION),this._enableProcessCollisions=!1,this._updateMass(0)):((s&c.COLLISIONFLAGS_KINEMATIC_OBJECT)>0&&(s^=c.COLLISIONFLAGS_KINEMATIC_OBJECT),i.btCollisionObject_setCollisionFlags(n,s),i.btCollisionObject_setActivationState(this._btColliderObject,c.ACTIVATIONSTATE_ACTIVE_TAG),this._enableProcessCollisions=!0,this._updateMass(this._mass));var r=Rigidbody3D._btVector3Zero;i.btCollisionObject_setInterpolationLinearVelocity(n,r),i.btRigidBody_setLinearVelocity(n,r),i.btCollisionObject_setInterpolationAngularVelocity(n,r),i.btRigidBody_setAngularVelocity(n,r),o&&this._addToSimulation()}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._btColliderObject&&e.ILaya3D.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,t,this._angularDamping)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._btColliderObject&&e.ILaya3D.Physics3D._bullet.btRigidBody_setDamping(this._btColliderObject,this._linearDamping,t)}},{key:"overrideGravity",get:function(){return this._overrideGravity},set:function(t){this._overrideGravity=t;var i=e.ILaya3D.Physics3D._bullet;if(this._btColliderObject){var o=i.btRigidBody_getFlags(this._btColliderObject);t?0==(o&Rigidbody3D._BT_DISABLE_WORLD_GRAVITY)&&i.btRigidBody_setFlags(this._btColliderObject,o|Rigidbody3D._BT_DISABLE_WORLD_GRAVITY):(o&Rigidbody3D._BT_DISABLE_WORLD_GRAVITY)>0&&i.btRigidBody_setFlags(this._btColliderObject,o^Rigidbody3D._BT_DISABLE_WORLD_GRAVITY)}}},{key:"gravity",get:function(){var t=e.ILaya3D.Physics3D._bullet;return Rigidbody3D._btGravity=t.btRigidBody_getGravity(this._btColliderObject),e.Utils3D._convertToLayaVec3(Rigidbody3D._btGravity,this._gravity,!0),this._gravity},set:function(t){this._gravity=t;var i=e.ILaya3D.Physics3D._bullet;i.btVector3_setValue(Rigidbody3D._btGravity,-t.x,t.y,t.z),i.btRigidBody_setGravity(this._btColliderObject,Rigidbody3D._btGravity)}},{key:"totalForce",get:function(){if(this._btColliderObject){var t=e.ILaya3D.Physics3D._bullet.btRigidBody_getTotalForce(this._btColliderObject);return e.Utils3D._convertToLayaVec3(t,this._totalForce,!0),this._totalForce}return null}},{key:"linearFactor",get:function(){return this._linearFactor},set:function(t){this._linearFactor=t;var i=Rigidbody3D._btTempVector30;e.Utils3D._convertToBulletVec3(t,i,!1),e.ILaya3D.Physics3D._bullet.btRigidBody_setLinearFactor(this._btColliderObject,i)}},{key:"linearVelocity",get:function(){return this._btColliderObject&&e.Utils3D._convertToLayaVec3(e.ILaya3D.Physics3D._bullet.btRigidBody_getLinearVelocity(this._btColliderObject),this._linearVelocity,!0),this._linearVelocity},set:function(t){if(this._linearVelocity=t,this._btColliderObject){var i=Rigidbody3D._btTempVector30;e.Utils3D._convertToBulletVec3(t,i,!0),this.isSleeping&&this.wakeUp(),e.ILaya3D.Physics3D._bullet.btRigidBody_setLinearVelocity(this._btColliderObject,i)}}},{key:"angularFactor",get:function(){return this._angularFactor},set:function(t){this._angularFactor=t;var i=Rigidbody3D._btTempVector30;e.Utils3D._convertToBulletVec3(t,i,!1),e.ILaya3D.Physics3D._bullet.btRigidBody_setAngularFactor(this._btColliderObject,i)}},{key:"angularVelocity",get:function(){return this._btColliderObject&&e.Utils3D._convertToLayaVec3(e.ILaya3D.Physics3D._bullet.btRigidBody_getAngularVelocity(this._btColliderObject),this._angularVelocity,!0),this._angularVelocity},set:function(t){if(this._angularVelocity=t,this._btColliderObject){var i=Rigidbody3D._btTempVector30;e.Utils3D._convertToBulletVec3(t,i,!0),this.isSleeping&&this.wakeUp(),e.ILaya3D.Physics3D._bullet.btRigidBody_setAngularVelocity(this._btColliderObject,i)}}},{key:"totalTorque",get:function(){if(this._btColliderObject){var t=e.ILaya3D.Physics3D._bullet.btRigidBody_getTotalTorque(this._btColliderObject);return e.Utils3D._convertToLayaVec3(t,this._totalTorque,!0),this._totalTorque}return null}},{key:"detectCollisions",get:function(){return this._detectCollisions},set:function(t){this._detectCollisions!==t&&(this._detectCollisions=t,this._colliderShape&&this._enabled&&this._simulation&&(this._simulation._removeRigidBody(this),this._simulation._addRigidBody(this,this._collisionGroup,t?this._canCollideWith:0)))}},{key:"isSleeping",get:function(){return!!this._btColliderObject&&e.ILaya3D.Physics3D._bullet.btCollisionObject_getActivationState(this._btColliderObject)===c.ACTIVATIONSTATE_ISLAND_SLEEPING}},{key:"sleepLinearVelocity",get:function(){return e.ILaya3D.Physics3D._bullet.btRigidBody_getLinearSleepingThreshold(this._btColliderObject)},set:function(t){var i=e.ILaya3D.Physics3D._bullet;i.btRigidBody_setSleepingThresholds(this._btColliderObject,t,i.btRigidBody_getAngularSleepingThreshold(this._btColliderObject))}},{key:"sleepAngularVelocity",get:function(){return e.ILaya3D.Physics3D._bullet.btRigidBody_getAngularSleepingThreshold(this._btColliderObject)},set:function(t){var i=e.ILaya3D.Physics3D._bullet;i.btRigidBody_setSleepingThresholds(this._btColliderObject,i.btRigidBody_getLinearSleepingThreshold(this._btColliderObject),t)}},{key:"btColliderObject",get:function(){return this._btColliderObject}},{key:"constaintRigidbodyA",set:function(t){this._constaintRigidbodyA=t},get:function(){return this._constaintRigidbodyA}},{key:"constaintRigidbodyB",set:function(t){this._constaintRigidbodyB=t},get:function(){return this._constaintRigidbodyB}}],[{key:"__init__",value:function(){var t=e.ILaya3D.Physics3D._bullet;Rigidbody3D._btTempVector30=t.btVector3_create(0,0,0),Rigidbody3D._btTempVector31=t.btVector3_create(0,0,0),Rigidbody3D._btVector3Zero=t.btVector3_create(0,0,0),Rigidbody3D._btInertia=t.btVector3_create(0,0,0),Rigidbody3D._btImpulse=t.btVector3_create(0,0,0),Rigidbody3D._btImpulseOffset=t.btVector3_create(0,0,0),Rigidbody3D._btGravity=t.btVector3_create(0,0,0),Rigidbody3D._btTransform0=t.btTransform_create()}}]),Rigidbody3D}();S.TYPE_STATIC=0,S.TYPE_DYNAMIC=1,S.TYPE_KINEMATIC=2,S._BT_DISABLE_WORLD_GRAVITY=1,S._BT_ENABLE_GYROPSCOPIC_FORCE=2;var T=function(t){_inherits(ConstraintComponent,e.Component);var i=_createSuper(ConstraintComponent);function ConstraintComponent(t){var o;_classCallCheck(this,ConstraintComponent),(o=i.call(this))._anchor=new e.Vector3,o._connectAnchor=new e.Vector3,o._feedbackEnabled=!1,o._getJointFeedBack=!1,o._currentForce=new e.Vector3,o._currentTorque=new e.Vector3,o._constraintType=t;var n=e.Physics3D._bullet;return o._btframATrans=n.btTransform_create(),o._btframBTrans=n.btTransform_create(),n.btTransform_setIdentity(o._btframATrans),n.btTransform_setIdentity(o._btframBTrans),o._btframAPos=n.btVector3_create(0,0,0),o._btframBPos=n.btVector3_create(0,0,0),n.btTransform_setOrigin(o._btframATrans,o._btframAPos),n.btTransform_setOrigin(o._btframBTrans,o._btframBPos),o._breakForce=-1,o._breakTorque=-1,o}return _createClass(ConstraintComponent,[{key:"setOverrideNumSolverIterations",value:function(t){e.Physics3D._bullet.btTypedConstraint_setOverrideNumSolverIterations(this._btConstraint,t)}},{key:"setConstraintEnabled",value:function(t){e.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,t)}},{key:"_onEnable",value:function(){_get(_getPrototypeOf(ConstraintComponent.prototype),"_onEnable",this).call(this),this.enabled=!0}},{key:"_onDisable",value:function(){_get(_getPrototypeOf(ConstraintComponent.prototype),"_onDisable",this).call(this),this.enabled=!1}},{key:"setFrames",value:function(){var t=e.Physics3D._bullet;t.btVector3_setValue(this._btframAPos,-this._anchor.x,this.anchor.y,this.anchor.z),t.btVector3_setValue(this._btframBPos,-this._connectAnchor.x,this._connectAnchor.y,this._connectAnchor.z),t.btTransform_setOrigin(this._btframATrans,this._btframAPos),t.btTransform_setOrigin(this._btframBTrans,this._btframBPos)}},{key:"_addToSimulation",value:function(){}},{key:"_removeFromSimulation",value:function(){}},{key:"_createConstraint",value:function(){}},{key:"setConnectRigidBody",value:function(t,e){var i=t&&!!(t._simulation&&t._enabled&&t.colliderShape),o=e&&!!(e._simulation&&e._enabled&&e.colliderShape);if(!i||!o)throw"ownerRigid or connectRigidBody is not in Simulation";t==this._ownBody&&e==this._connectedBody||(!(!this.enabled||!this._simulation)&&this._removeFromSimulation(),this._ownBody=t,this._connectedBody=e,this._ownBody.constaintRigidbodyA=this,this._connectedBody.constaintRigidbodyB=this,this._createConstraint())}},{key:"getcurrentForce",value:function(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var i=e.Physics3D._bullet,o=i.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj);t.setValue(i.btVector3_x(o),i.btVector3_y(o),i.btVector3_z(o))}},{key:"getcurrentTorque",value:function(t){if(!this._btJointFeedBackObj)throw"this Constraint is not simulation";var i=e.Physics3D._bullet,o=i.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);t.setValue(i.btVector3_x(o),i.btVector3_y(o),i.btVector3_z(o))}},{key:"_onDestroy",value:function(){var t=e.Physics3D._bullet;this._simulation&&this._removeFromSimulation(),this._btConstraint&&this._btJointFeedBackObj&&this._simulation&&(t.btTypedConstraint_destroy(this._btConstraint),t.btJointFeedback_destroy(this._btJointFeedBackObj),this._btJointFeedBackObj=null,this._btConstraint=null),_get(_getPrototypeOf(ConstraintComponent.prototype),"_onDisable",this).call(this)}},{key:"_isBreakConstrained",value:function(){if(this._getJointFeedBack=!1,-1==this.breakForce&&-1==this.breakTorque)return!1;this._getFeedBackInfo();var t=-1!=this._breakForce&&e.Vector3.scalarLength(this._currentForce)>this._breakForce,i=-1!=this._breakTorque&&e.Vector3.scalarLength(this._currentTorque)>this._breakTorque;return!(!t&&!i)&&(this._breakConstrained(),!0)}},{key:"_parse",value:function(t){this._anchor.fromArray(t.anchor),this._connectAnchor.fromArray(t.connectAnchor),this.setFrames()}},{key:"_getFeedBackInfo",value:function(){var t=e.Physics3D._bullet,i=t.btJointFeedback_getAppliedForceBodyA(this._btJointFeedBackObj),o=t.btJointFeedback_getAppliedTorqueBodyA(this._btJointFeedBackObj);this._currentTorque.setValue(t.btVector3_x(o),t.btVector3_y(o),t.btVector3_z(o)),this._currentForce.setValue(t.btVector3_x(i),t.btVector3_y(i),t.btVector3_z(i)),this._getJointFeedBack=!0}},{key:"_breakConstrained",value:function(){this.ownBody.constaintRigidbodyA=null,this.connectedBody&&(this.connectedBody.constaintRigidbodyB=null),this.destroy()}},{key:"enabled",get:function(){return _get(_getPrototypeOf(ConstraintComponent.prototype),"enabled",this)},set:function(t){_set(_getPrototypeOf(ConstraintComponent.prototype),"enabled",t,this,!0)}},{key:"appliedImpulse",get:function(){return this._feedbackEnabled||(this._btConstraint.EnableFeedback(!0),this._feedbackEnabled=!0),this._btConstraint.AppliedImpulse}},{key:"connectedBody",set:function(t){this._connectedBody=t,t&&(t.constaintRigidbodyB=this)},get:function(){return this._connectedBody}},{key:"ownBody",get:function(){return this._ownBody},set:function(t){this._ownBody=t,t.constaintRigidbodyA=this}},{key:"currentForce",get:function(){return this._getJointFeedBack||this._getFeedBackInfo(),this._currentForce}},{key:"currentTorque",get:function(){return this._getJointFeedBack||this._getFeedBackInfo(),this._currentTorque}},{key:"breakForce",get:function(){return this._breakForce},set:function(t){this._breakForce=t}},{key:"breakTorque",get:function(){return this._breakTorque},set:function(t){this._breakTorque=t}},{key:"anchor",set:function(t){t.cloneTo(this._anchor),this.setFrames()},get:function(){return this._anchor}},{key:"connectAnchor",set:function(t){t.cloneTo(this._connectAnchor),this.setFrames()},get:function(){return this._connectAnchor}}]),ConstraintComponent}();T.CONSTRAINT_POINT2POINT_CONSTRAINT_TYPE=3,T.CONSTRAINT_HINGE_CONSTRAINT_TYPE=4,T.CONSTRAINT_CONETWIST_CONSTRAINT_TYPE=5,T.CONSTRAINT_D6_CONSTRAINT_TYPE=6,T.CONSTRAINT_SLIDER_CONSTRAINT_TYPE=7,T.CONSTRAINT_CONTACT_CONSTRAINT_TYPE=8,T.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE=9,T.CONSTRAINT_GEAR_CONSTRAINT_TYPE=10,T.CONSTRAINT_FIXED_CONSTRAINT_TYPE=11,T.CONSTRAINT_MAX_CONSTRAINT_TYPE=12,T.CONSTRAINT_CONSTRAINT_ERP=1,T.CONSTRAINT_CONSTRAINT_STOP_ERP=2,T.CONSTRAINT_CONSTRAINT_CFM=3,T.CONSTRAINT_CONSTRAINT_STOP_CFM=4,T.tempForceV3=new e.Vector3;var O=function(t){_inherits(ConfigurableConstraint,T);var i=_createSuper(ConfigurableConstraint);function ConfigurableConstraint(){var t;_classCallCheck(this,ConfigurableConstraint),(t=i.call(this,T.CONSTRAINT_D6_SPRING_CONSTRAINT_TYPE))._axis=new e.Vector3,t._secondaryAxis=new e.Vector3,t._minLinearLimit=new e.Vector3,t._maxLinearLimit=new e.Vector3,t._minAngularLimit=new e.Vector3,t._maxAngularLimit=new e.Vector3,t._linearLimitSpring=new e.Vector3,t._angularLimitSpring=new e.Vector3,t._linearBounce=new e.Vector3,t._angularBounce=new e.Vector3,t._linearDamp=new e.Vector3,t._angularDamp=new e.Vector3,t._xMotion=0,t._yMotion=0,t._zMotion=0,t._angularXMotion=0,t._angularYMotion=0,t._angularZMotion=0;var o=e.Physics3D._bullet;return t._btAxis=o.btVector3_create(-1,0,0),t._btSecondaryAxis=o.btVector3_create(0,1,0),t}return _createClass(ConfigurableConstraint,[{key:"setAxis",value:function(t,i){if(this._btConstraint){var o=e.Physics3D._bullet;this._axis.setValue(t.x,t.y,t.y),this._secondaryAxis.setValue(i.x,i.y,i.z),this._btAxis=o.btVector3_setValue(-t.x,t.y,t.z),this._btSecondaryAxis=o.btVector3_setValue(-i.x,i.y,i.z),o.btGeneric6DofSpring2Constraint_setAxis(this._btConstraint,this._btAxis,this._btSecondaryAxis)}}},{key:"setLimit",value:function(t,i,o,n){if(this._btConstraint){var s=e.Physics3D._bullet;switch(i){case ConfigurableConstraint.CONFIG_MOTION_TYPE_LOCKED:s.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,0,0);break;case ConfigurableConstraint.CONFIG_MOTION_TYPE_LIMITED:o<n&&s.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,o,n);break;case ConfigurableConstraint.CONFIG_MOTION_TYPE_FREE:s.btGeneric6DofSpring2Constraint_setLimit(this._btConstraint,t,1,0);break;default:throw"No Type of Axis Motion"}}}},{key:"setSpring",value:function(t,i){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this._btConstraint){var n=e.Physics3D._bullet,s=i>0;n.btGeneric6DofSpring2Constraint_enableSpring(this._btConstraint,t,s),s&&n.btGeneric6DofSpring2Constraint_setStiffness(this._btConstraint,t,i,o)}}},{key:"setBounce",value:function(t,i){this._btConstraint&&(i=i<=0?0:i,e.Physics3D._bullet.btGeneric6DofSpring2Constraint_setBounce(this._btConstraint,t,i))}},{key:"setDamping",value:function(t,i){var o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];this._btConstraint&&(i=i<=0?0:i,e.Physics3D._bullet.btGeneric6DofSpring2Constraint_setDamping(this._btConstraint,t,i,o))}},{key:"setEquilibriumPoint",value:function(t,i){e.Physics3D._bullet.btGeneric6DofSpring2Constraint_setEquilibriumPoint(this._btConstraint,t,i)}},{key:"enableMotor",value:function(t,i){e.Physics3D._bullet.btGeneric6DofSpring2Constraint_enableMotor(this._btConstraint,t,i)}},{key:"setServo",value:function(t,i){e.Physics3D._bullet.btGeneric6DofSpring2Constraint_setServo(this._btConstraint,t,i)}},{key:"setTargetVelocity",value:function(t,i){e.Physics3D._bullet.btGeneric6DofSpring2Constraint_setTargetVelocity(this._btConstraint,t,i)}},{key:"setTargetPosition",value:function(t,i){e.Physics3D._bullet.btGeneric6DofSpring2Constraint_setServoTarget(this._btConstraint,t,i)}},{key:"setMaxMotorForce",value:function(t,i){e.Physics3D._bullet.btGeneric6DofSpring2Constraint_setMaxMotorForce(this._btConstraint,t,i)}},{key:"setParam",value:function(t,i,o){e.Physics3D._bullet.btTypedConstraint_setParam(this._btConstraint,t,i,o)}},{key:"setFrames",value:function(){_get(_getPrototypeOf(ConfigurableConstraint.prototype),"setFrames",this).call(this);var t=e.Physics3D._bullet;this._btConstraint&&t.btGeneric6DofSpring2Constraint_setFrames(this._btConstraint,this._btframATrans,this._btframBTrans)}},{key:"_addToSimulation",value:function(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}},{key:"_removeFromSimulation",value:function(){this._simulation.removeConstraint(this),this._simulation=null}},{key:"_createConstraint",value:function(){var t=e.Physics3D._bullet;this._btConstraint=t.btGeneric6DofSpring2Constraint_create(this.ownBody.btColliderObject,this._btframAPos,this.connectedBody.btColliderObject,this._btframBPos,ConfigurableConstraint.RO_XYZ),this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint),t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj),this._simulation=this.owner._scene.physicsSimulation,this._initAllConstraintInfo(),this._addToSimulation(),e.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0)}},{key:"_initAllConstraintInfo",value:function(){this.setLimit(ConfigurableConstraint.MOTION_LINEAR_INDEX_X,this._xMotion,-this._maxLinearLimit.x,-this._minLinearLimit.x),this.setLimit(ConfigurableConstraint.MOTION_LINEAR_INDEX_Y,this._yMotion,this._minLinearLimit.y,this._maxLinearLimit.y),this.setLimit(ConfigurableConstraint.MOTION_LINEAR_INDEX_Z,this._zMotion,this._minLinearLimit.z,this._maxLinearLimit.z),this.setLimit(ConfigurableConstraint.MOTION_ANGULAR_INDEX_X,this._angularXMotion,-this._maxAngularLimit.x,-this._minAngularLimit.x),this.setLimit(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Y,this._angularYMotion,this._minAngularLimit.y,this._maxAngularLimit.y),this.setLimit(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Z,this._angularZMotion,this._minAngularLimit.z,this._maxAngularLimit.z),this.setSpring(ConfigurableConstraint.MOTION_LINEAR_INDEX_X,this._linearLimitSpring.x),this.setSpring(ConfigurableConstraint.MOTION_LINEAR_INDEX_Y,this._linearLimitSpring.y),this.setSpring(ConfigurableConstraint.MOTION_LINEAR_INDEX_Z,this._linearLimitSpring.z),this.setSpring(ConfigurableConstraint.MOTION_ANGULAR_INDEX_X,this._angularLimitSpring.x),this.setSpring(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Y,this._angularLimitSpring.y),this.setSpring(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Z,this._angularLimitSpring.z),this.setBounce(ConfigurableConstraint.MOTION_LINEAR_INDEX_X,this._linearBounce.x),this.setBounce(ConfigurableConstraint.MOTION_LINEAR_INDEX_Y,this._linearBounce.y),this.setBounce(ConfigurableConstraint.MOTION_LINEAR_INDEX_Z,this._linearBounce.z),this.setBounce(ConfigurableConstraint.MOTION_ANGULAR_INDEX_X,this._angularBounce.x),this.setBounce(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Y,this._angularBounce.y),this.setBounce(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Z,this._angularBounce.z),this.setDamping(ConfigurableConstraint.MOTION_LINEAR_INDEX_X,this._linearDamp.x),this.setDamping(ConfigurableConstraint.MOTION_LINEAR_INDEX_Y,this._linearDamp.y),this.setDamping(ConfigurableConstraint.MOTION_LINEAR_INDEX_Z,this._linearDamp.z),this.setDamping(ConfigurableConstraint.MOTION_ANGULAR_INDEX_X,this._angularDamp.x),this.setDamping(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Y,this._angularDamp.y),this.setDamping(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Z,this._angularDamp.z),this.setFrames(),this.setEquilibriumPoint(0,0)}},{key:"_onAdded",value:function(){_get(_getPrototypeOf(ConfigurableConstraint.prototype),"_onAdded",this).call(this)}},{key:"_onEnable",value:function(){this._btConstraint&&(_get(_getPrototypeOf(ConfigurableConstraint.prototype),"_onEnable",this).call(this),this._btConstraint&&e.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0))}},{key:"_onDisable",value:function(){_get(_getPrototypeOf(ConfigurableConstraint.prototype),"_onDisable",this).call(this),!this.connectedBody&&this._simulation&&this._removeFromSimulation(),this._btConstraint&&e.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!1)}},{key:"_parse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(ConfigurableConstraint.prototype),"_parse",this).call(this,t),this._axis.fromArray(t.axis),this._secondaryAxis.fromArray(t.secondaryAxis);var i=t.linearLimit;this._minLinearLimit.setValue(-i,-i,-i),this._maxLinearLimit.setValue(i,i,i);var o=t.linearLimitSpring;this._linearLimitSpring.setValue(o,o,o);var n=t.linearLimitDamper;this._linearDamp.setValue(n,n,n);var s=t.linearLimitBounciness;this._linearBounce.setValue(s,s,s);var r=t.lowAngularXLimit,a=t.highAngularXLimit,l=t.angularYLimit,_=t.angularZLimit;this._minAngularLimit.setValue(r,-l,-_),this._maxAngularLimit.setValue(a,l,_);var c=t.highAngularXLimitBounciness,h=t.angularYLimitBounciness,u=t.angularZLimitBounciness;this._angularBounce.setValue(c,h,u);var d=t.angularXLimitSpring,b=t.angularYZLimitSpring;this._angularLimitSpring.setValue(d,b,b);var y=t.angularXLimitDamper,C=t.angularYZLimitDamper;this._angularDamp.setValue(y,C,C),this.XMotion=t.xMotion,this.YMotion=t.yMotion,this.ZMotion=t.zMotion,this.angularXMotion=t.angularXMotion,this.angularYMotion=t.angularYMotion,this.angularZMotion=t.angularZMotion,-1!=t.rigidbodyID&&-1!=t.connectRigidbodyID&&(e.component.push(this),e.data.push(t)),null!=t.breakForce&&(this.breakForce=t.breakForce),null!=t.breakTorque&&(this.breakTorque=t.breakTorque)}},{key:"_parseInteractive",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=e[t.rigidbodyID].getComponent(S),o=e[t.connectRigidbodyID].getComponent(S);this.ownBody=i,this.connectedBody=o}},{key:"_onDestroy",value:function(){_get(_getPrototypeOf(ConfigurableConstraint.prototype),"_onDestroy",this).call(this)}},{key:"axis",get:function(){return this._axis}},{key:"secondaryAxis",get:function(){return this._secondaryAxis}},{key:"maxAngularLimit",set:function(t){t.cloneTo(this._maxAngularLimit)},get:function(){return this._maxAngularLimit}},{key:"minAngularLimit",set:function(t){t.cloneTo(this._minAngularLimit)},get:function(){return this._minAngularLimit}},{key:"maxLinearLimit",set:function(t){t.cloneTo(this._maxLinearLimit)},get:function(){return this._maxLinearLimit}},{key:"minLinearLimit",set:function(t){t.cloneTo(this._minLinearLimit)},get:function(){return this._minLinearLimit}},{key:"XMotion",set:function(t){this._xMotion!=t&&(this._xMotion=t,this.setLimit(ConfigurableConstraint.MOTION_LINEAR_INDEX_X,t,-this._maxLinearLimit.x,-this._minLinearLimit.x))},get:function(){return this._xMotion}},{key:"YMotion",set:function(t){this._yMotion!=t&&(this._yMotion=t,this.setLimit(ConfigurableConstraint.MOTION_LINEAR_INDEX_Y,t,this._minLinearLimit.y,this._maxLinearLimit.y))},get:function(){return this._yMotion}},{key:"ZMotion",set:function(t){this._zMotion!=t&&(this._zMotion=t,this.setLimit(ConfigurableConstraint.MOTION_LINEAR_INDEX_Z,t,this._minLinearLimit.z,this._maxLinearLimit.z))},get:function(){return this._zMotion}},{key:"angularXMotion",set:function(t){this._angularXMotion!=t&&(this._angularXMotion=t,this.setLimit(ConfigurableConstraint.MOTION_ANGULAR_INDEX_X,t,-this._maxAngularLimit.x,-this._minAngularLimit.x))},get:function(){return this._angularXMotion}},{key:"angularYMotion",set:function(t){this._angularYMotion!=t&&(this._angularYMotion=t,this.setLimit(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Y,t,this._minAngularLimit.y,this._maxAngularLimit.y))},get:function(){return this._angularYMotion}},{key:"angularZMotion",set:function(t){this._angularZMotion!=t&&(this._angularZMotion=t,this.setLimit(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Z,t,this._minAngularLimit.z,this._maxAngularLimit.z))},get:function(){return this._angularZMotion}},{key:"linearLimitSpring",set:function(t){e.Vector3.equals(this._linearLimitSpring,t)||(t.cloneTo(this._linearLimitSpring),this.setSpring(ConfigurableConstraint.MOTION_LINEAR_INDEX_X,t.x),this.setSpring(ConfigurableConstraint.MOTION_LINEAR_INDEX_Y,t.y),this.setSpring(ConfigurableConstraint.MOTION_LINEAR_INDEX_Z,t.z))},get:function(){return this._linearLimitSpring}},{key:"angularLimitSpring",set:function(t){e.Vector3.equals(this._angularLimitSpring,t)||(t.cloneTo(this._angularLimitSpring),this.setSpring(ConfigurableConstraint.MOTION_ANGULAR_INDEX_X,t.x),this.setSpring(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Y,t.y),this.setSpring(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Z,t.z))},get:function(){return this._angularLimitSpring}},{key:"linearBounce",set:function(t){e.Vector3.equals(this._linearBounce,t)||(t.cloneTo(this._linearBounce),this.setBounce(ConfigurableConstraint.MOTION_LINEAR_INDEX_X,t.x),this.setBounce(ConfigurableConstraint.MOTION_LINEAR_INDEX_Y,t.y),this.setBounce(ConfigurableConstraint.MOTION_LINEAR_INDEX_Z,t.z))},get:function(){return this._linearBounce}},{key:"angularBounce",set:function(t){e.Vector3.equals(this._angularBounce,t)||(t.cloneTo(this._angularBounce),this.setBounce(ConfigurableConstraint.MOTION_ANGULAR_INDEX_X,t.x),this.setBounce(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Y,t.y),this.setBounce(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Z,t.z))},get:function(){return this._angularBounce}},{key:"linearDamp",set:function(t){e.Vector3.equals(this._linearDamp,t)||(t.cloneTo(this._linearDamp),this.setDamping(ConfigurableConstraint.MOTION_LINEAR_INDEX_X,t.x),this.setDamping(ConfigurableConstraint.MOTION_LINEAR_INDEX_Y,t.y),this.setDamping(ConfigurableConstraint.MOTION_LINEAR_INDEX_Z,t.z))},get:function(){return this._linearDamp}},{key:"angularDamp",set:function(t){e.Vector3.equals(this._angularDamp,t)||(t.cloneTo(this._angularDamp),this.setDamping(ConfigurableConstraint.MOTION_ANGULAR_INDEX_X,t.x),this.setDamping(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Y,t.y),this.setDamping(ConfigurableConstraint.MOTION_ANGULAR_INDEX_Z,t.z))},get:function(){return this._angularDamp}},{key:"anchor",set:function(t){t.cloneTo(this._anchor),this.setFrames()},get:function(){return this._anchor}},{key:"connectAnchor",set:function(t){t.cloneTo(this._connectAnchor),this.setFrames()},get:function(){return this._connectAnchor}}]),ConfigurableConstraint}();O.CONFIG_MOTION_TYPE_LOCKED=0,O.CONFIG_MOTION_TYPE_LIMITED=1,O.CONFIG_MOTION_TYPE_FREE=2,O.MOTION_LINEAR_INDEX_X=0,O.MOTION_LINEAR_INDEX_Y=1,O.MOTION_LINEAR_INDEX_Z=2,O.MOTION_ANGULAR_INDEX_X=3,O.MOTION_ANGULAR_INDEX_Y=4,O.MOTION_ANGULAR_INDEX_Z=5,O.RO_XYZ=0,O.RO_XZY=1,O.RO_YXZ=2,O.RO_YZX=3,O.RO_ZXY=4,O.RO_ZYX=5;var I=function(t){_inherits(FixedConstraint,T);var i=_createSuper(FixedConstraint);function FixedConstraint(){var t;return _classCallCheck(this,FixedConstraint),(t=i.call(this,T.CONSTRAINT_FIXED_CONSTRAINT_TYPE)).breakForce=-1,t.breakTorque=-1,t}return _createClass(FixedConstraint,[{key:"_addToSimulation",value:function(){this._simulation&&this._simulation.addConstraint(this,this.enabled)}},{key:"_removeFromSimulation",value:function(){this._simulation.removeConstraint(this),this._simulation=null}},{key:"_createConstraint",value:function(){if(this.ownBody&&this.ownBody._simulation&&this.connectedBody&&this.connectedBody._simulation){var t=e.Physics3D._bullet;this._btConstraint=t.btFixedConstraint_create(this.ownBody.btColliderObject,this._btframATrans,this.connectedBody.btColliderObject,this._btframBTrans),this._btJointFeedBackObj=t.btJointFeedback_create(this._btConstraint),t.btTypedConstraint_setJointFeedback(this._btConstraint,this._btJointFeedBackObj),this._simulation=this.owner._scene.physicsSimulation,this._addToSimulation(),e.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0)}}},{key:"_onAdded",value:function(){_get(_getPrototypeOf(FixedConstraint.prototype),"_onAdded",this).call(this)}},{key:"_onEnable",value:function(){this._btConstraint&&(_get(_getPrototypeOf(FixedConstraint.prototype),"_onEnable",this).call(this),this._btConstraint&&e.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!0))}},{key:"_onDisable",value:function(){_get(_getPrototypeOf(FixedConstraint.prototype),"_onDisable",this).call(this),this.connectedBody||this._removeFromSimulation(),this._btConstraint&&e.Physics3D._bullet.btTypedConstraint_setEnabled(this._btConstraint,!1)}},{key:"_onDestroy",value:function(){_get(_getPrototypeOf(FixedConstraint.prototype),"_onDestroy",this).call(this)}},{key:"_parse",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;_get(_getPrototypeOf(FixedConstraint.prototype),"_parse",this).call(this,t),-1!=t.rigidbodyID&&-1!=t.connectRigidbodyID&&(e.component.push(this),e.data.push(t)),null!=t.breakForce&&(this.breakForce=t.breakForce),null!=t.breakTorque&&(this.breakTorque=t.breakTorque)}},{key:"_parseInteractive",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=e[t.rigidbodyID].getComponent(S),o=e[t.connectRigidbodyID].getComponent(S);this.ownBody=i,this.connectedBody=o}}]),FixedConstraint}(),D=function(t){_inherits(StaticPlaneColliderShape,i);var o=_createSuper(StaticPlaneColliderShape);function StaticPlaneColliderShape(t,n){var s;_classCallCheck(this,StaticPlaneColliderShape),(s=o.call(this))._normal=t,s._offset=n,s._type=i.SHAPETYPES_STATICPLANE;var r=e.ILaya3D.Physics3D._bullet;return r.btVector3_setValue(StaticPlaneColliderShape._btNormal,-t.x,t.y,t.z),s._btShape=r.btStaticPlaneShape_create(StaticPlaneColliderShape._btNormal,n),s}return _createClass(StaticPlaneColliderShape,[{key:"clone",value:function(){var t=new StaticPlaneColliderShape(this._normal,this._offset);return this.cloneTo(t),t}}],[{key:"__init__",value:function(){StaticPlaneColliderShape._btNormal=e.ILaya3D.Physics3D._bullet.btVector3_create(0,0,0)}}]),StaticPlaneColliderShape}();t.BoxColliderShape=o,t.BulletInteractive=h,t.CapsuleColliderShape=n,t.CharacterController=u,t.ColliderShape=i,t.Collision=d,t.CollisionTool=C,t.CompoundColliderShape=s,t.ConeColliderShape=r,t.ConfigurableConstraint=O,t.Constraint3D=function Constraint3D(){_classCallCheck(this,Constraint3D)},t.ConstraintComponent=T,t.ContactPoint=b,t.CylinderColliderShape=a,t.FixedConstraint=I,t.HitResult=y,t.MeshColliderShape=l,t.PhysicsCollider=g,t.PhysicsComponent=c,t.PhysicsSettings=function PhysicsSettings(){_classCallCheck(this,PhysicsSettings),this.flags=0,this.maxSubSteps=1,this.fixedTimeStep=1/60},t.PhysicsSimulation=m,t.PhysicsTriggerComponent=p,t.PhysicsUpdateList=f,t.Rigidbody3D=S,t.SphereColliderShape=_,t.StaticPlaneColliderShape=D}(window.Laya=window.Laya||{},Laya);
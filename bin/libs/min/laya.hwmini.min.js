"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _get(e,i,n){return(_get="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,i,n){var t=_superPropBase(e,i);if(t){var o=Object.getOwnPropertyDescriptor(t,i);return o.get?o.get.call(n):o.value}})(e,i,n||e)}function _superPropBase(e,i){for(;!Object.prototype.hasOwnProperty.call(e,i)&&null!==(e=_getPrototypeOf(e)););return e}function _inherits(e,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(i&&i.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),i&&_setPrototypeOf(e,i)}function _setPrototypeOf(e,i){return(_setPrototypeOf=Object.setPrototypeOf||function(e,i){return e.__proto__=i,e})(e,i)}function _createSuper(e){var i=_isNativeReflectConstruct();return function(){var n,t=_getPrototypeOf(e);if(i){var o=_getPrototypeOf(this).constructor;n=Reflect.construct(t,arguments,o)}else n=t.apply(this,arguments);return _possibleConstructorReturn(this,n)}}function _possibleConstructorReturn(e,i){return!i||"object"!==_typeof(i)&&"function"!=typeof i?_assertThisInitialized(e):i}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _classCallCheck(e,i){if(!(e instanceof i))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,i){for(var n=0;n<i.length;n++){var t=i[n];t.enumerable=t.enumerable||!1,t.configurable=!0,"value"in t&&(t.writable=!0),Object.defineProperty(e,t.key,t)}}function _createClass(e,i,n){return i&&_defineProperties(e.prototype,i),n&&_defineProperties(e,n),e}window.hwMiniGame=function(e,i){var n=function(){function MiniFileMgr(){_classCallCheck(this,MiniFileMgr)}return _createClass(MiniFileMgr,null,[{key:"isLocalNativeFile",value:function(e){for(var i=0,n=r.nativefiles.length;i<n;i++)if(-1!=e.indexOf(r.nativefiles[i]))return!0;return!1}},{key:"isNetFile",value:function(e){return(-1!=e.indexOf("http://")||-1!=e.indexOf("https://"))&&-1==e.indexOf(r.window.hbs.env.USER_DATA_PATH)}},{key:"getFileInfo",value:function(e){var i=e,n=MiniFileMgr.fakeObj[i];return null==n?null:n}},{key:"read",value:function(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"";n=""==a||-1==a.indexOf("http://")&&-1==a.indexOf("https://")?e:MiniFileMgr.getFileNativePath(e),n=i.URL.getAdptedFilePath(n),MiniFileMgr.fs.readFile({filePath:n,encoding:t,success:function(e){null!=o&&o.runWith([0,e])},fail:function(e){e&&""!=a?MiniFileMgr.downFiles(r.safeEncodeURI(a),t,o,a,l,s):null!=o&&o.runWith([1])}})}},{key:"isFile",value:function(e){var i;try{i=MiniFileMgr.fs.statSync(e)}catch(e){return!1}return i.isFile()}},{key:"downFiles",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"",l=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];MiniFileMgr.hbsdown({url:e,success:function(r){200===r.statusCode?MiniFileMgr.readFile(r.tempFilePath,i,n,t,o,a,l):403===r.statusCode?null!=n&&n.runWith([0,e]):null!=n&&n.runWith([1,r])},fail:function(e){null!=n&&n.runWith([1,e])}}).onProgressUpdate(function(e){null!=n&&n.runWith([2,e.progress])})}},{key:"readFile",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],l=(arguments.length>5&&void 0!==arguments[5]&&arguments[5],!(arguments.length>6&&void 0!==arguments[6])||arguments[6]);e=i.URL.getAdptedFilePath(e),MiniFileMgr.fs.readFile({filePath:e,encoding:n,success:function(i){-1==e.indexOf("http://")&&-1==e.indexOf("https://")||-1!=e.indexOf(r.window.hbs.env.USER_DATA_PATH)?null!=t&&t.runWith([0,i]):r.AutoCacheDownFile||a?(null!=t&&t.runWith([0,i]),MiniFileMgr.copyTOCache(e,o,null,n,l)):null!=t&&t.runWith([0,i])},fail:function(e){e&&null!=t&&t.runWith([1,e])}})}},{key:"downOtherFiles",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",t=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];MiniFileMgr.hbsdown({url:e,success:function(e){200===e.statusCode?(r.autoCacheFile||t)&&-1==n.indexOf(".php")?(null!=i&&i.runWith([0,e.tempFilePath]),MiniFileMgr.copyTOCache(e.tempFilePath,n,null,"",o)):null!=i&&i.runWith([0,e.tempFilePath]):null!=i&&i.runWith([1,e])},fail:function(e){null!=i&&i.runWith([1,e])}})}},{key:"copyFile",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;MiniFileMgr.fs.copyFile({srcPath:e,destPath:i,success:function(){n&&n.runWith(0)},fail:function(e){n&&n.runWith([1,e])}})}},{key:"downLoadFile",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"utf8";"hbs"in window?n==i.Loader.IMAGE||n==i.Loader.SOUND?MiniFileMgr.downOtherFiles(r.safeEncodeURI(e),t,e,!0,!1):MiniFileMgr.downFiles(r.safeEncodeURI(e),o,t,e,!0,n,!1):i.Laya.loader.load(e,t)}},{key:"copyTOCache",value:function(e,n,t){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],l=e.split("/"),s=l[l.length-1],u=n,d=MiniFileMgr.getFileInfo(n),c=MiniFileMgr.getFileNativePath(s);MiniFileMgr.fakeObj[u]={md5:s,readyUrl:n,size:0,times:i.Browser.now(),encoding:o,tempFilePath:e};var h=r.sizeLimit,f=MiniFileMgr.getCacheUseSize();d?d.readyUrl!=n?MiniFileMgr.fs.getFileInfo({filePath:e,success:function(i){a&&f+4194304+i.size>=h&&(i.size>r.minClearSize&&(r.minClearSize=i.size),MiniFileMgr.onClearCacheRes()),MiniFileMgr.deleteFile(e,n,t,o,i.size)},fail:function(e){null!=t&&t.runWith([1,e])}}):null!=t&&t.runWith([0]):MiniFileMgr.fs.getFileInfo({filePath:e,success:function(i){a&&f+4194304+i.size>=h&&(i.size>r.minClearSize&&(r.minClearSize=i.size),MiniFileMgr.onClearCacheRes()),MiniFileMgr.fs.copyFile({srcPath:e,destPath:c,success:function(e){MiniFileMgr.onSaveFile(n,s,!0,o,t,i.size)},fail:function(e){null!=t&&t.runWith([1,e])}})},fail:function(e){null!=t&&t.runWith([1,e])}})}},{key:"onClearCacheRes",value:function(){var e=r.minClearSize,i=[];for(var n in MiniFileMgr.filesListObj)"fileUsedSize"!=n&&i.push(MiniFileMgr.filesListObj[n]);MiniFileMgr.sortOn(i,"times",MiniFileMgr.NUMERIC);for(var t=0,o=1,a=i.length;o<a;o++){var l=i[o];if(t>=e)break;t+=l.size,MiniFileMgr.deleteFile("",l.readyUrl)}}},{key:"sortOn",value:function(e,i){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n==MiniFileMgr.NUMERIC?e.sort(function(e,n){return e[i]-n[i]}):n==(MiniFileMgr.NUMERIC|MiniFileMgr.DESCENDING)?e.sort(function(e,n){return n[i]-e[i]}):e.sort(function(e,n){return e[i]-n[i]})}},{key:"getFileNativePath",value:function(e){return MiniFileMgr.fileNativeDir+"/"+e}},{key:"deleteFile",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,a=MiniFileMgr.getFileInfo(i),l=MiniFileMgr.getFileNativePath(a.md5);MiniFileMgr.fs.unlink({filePath:l,success:function(a){if(""!=e){var l=MiniFileMgr.getFileNativePath(e);MiniFileMgr.fs.copyFile({srcPath:e,destPath:l,success:function(a){MiniFileMgr.onSaveFile(i,e,!0,t,n,o)},fail:function(e){null!=n&&n.runWith([1,e])}})}else MiniFileMgr.onSaveFile(i,e,!1,t,n,o)},fail:function(e){null!=n&&n.runWith([1,e])}})}},{key:"deleteAll",value:function(){var e=[];for(var i in MiniFileMgr.filesListObj)"fileUsedSize"!=i&&e.push(MiniFileMgr.filesListObj[i]);for(var n=1,t=e.length;n<t;n++){var o=e[n];MiniFileMgr.deleteFile("",o.readyUrl)}MiniFileMgr.filesListObj&&MiniFileMgr.filesListObj.fileUsedSize&&(MiniFileMgr.filesListObj.fileUsedSize=0),MiniFileMgr.writeFilesList("",JSON.stringify({}),!1)}},{key:"onSaveFile",value:function(e,n){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,r=e;if(null==MiniFileMgr.filesListObj.fileUsedSize&&(MiniFileMgr.filesListObj.fileUsedSize=0),t){var s=MiniFileMgr.getFileNativePath(n);MiniFileMgr.filesListObj[r]={md5:n,readyUrl:e,size:l,times:i.Browser.now(),encoding:o,tempFilePath:s},MiniFileMgr.filesListObj.fileUsedSize=parseInt(MiniFileMgr.filesListObj.fileUsedSize)+l,MiniFileMgr.writeFilesList(r,JSON.stringify(MiniFileMgr.filesListObj),!0),null!=a&&a.runWith([0])}else if(MiniFileMgr.filesListObj[r]){var u=parseInt(MiniFileMgr.filesListObj[r].size);MiniFileMgr.filesListObj.fileUsedSize=parseInt(MiniFileMgr.filesListObj.fileUsedSize)-u,MiniFileMgr.fakeObj[r].md5==MiniFileMgr.filesListObj[r].md5&&delete MiniFileMgr.fakeObj[r],delete MiniFileMgr.filesListObj[r],MiniFileMgr.writeFilesList(r,JSON.stringify(MiniFileMgr.filesListObj),!1),null!=a&&a.runWith([0])}}},{key:"writeFilesList",value:function(e,i,n){var t=MiniFileMgr.fileNativeDir+"/"+MiniFileMgr.fileListName;MiniFileMgr.fs.writeFile({filePath:t,encoding:"utf8",data:i,success:function(e){},fail:function(e){}})}},{key:"getCacheUseSize",value:function(){return MiniFileMgr.filesListObj&&MiniFileMgr.filesListObj.fileUsedSize?MiniFileMgr.filesListObj.fileUsedSize:0}},{key:"getCacheList",value:function(e,i){var n;try{n=MiniFileMgr.fs.statSync(e)}catch(e){n=null}n?MiniFileMgr.readSync(MiniFileMgr.fileListName,"utf8",i):(MiniFileMgr.fs.mkdirSync(e,!0),i&&i.runWith([1]))}},{key:"existDir",value:function(e,i){MiniFileMgr.fs.mkdir({dirPath:e,success:function(e){null!=i&&i.runWith([0,{data:JSON.stringify({})}])},fail:function(e){-1!=e.errMsg.indexOf("file already exists")?MiniFileMgr.readSync(MiniFileMgr.fileListName,"utf8",i):null!=i&&i.runWith([1,e])}})}},{key:"readSync",value:function(e){var i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf8",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],MiniFileMgr.getFileNativePath(e));try{i=MiniFileMgr.fs.readFileSync(o,n),null!=t&&t.runWith([0,{data:i}])}catch(e){null!=t&&t.runWith([1])}}},{key:"setNativeFileDir",value:function(e){MiniFileMgr.fileNativeDir=r.window.hbs.env.USER_DATA_PATH+e}}]),MiniFileMgr}();n.fs=window.hbs.getFileSystemManager(),n.hbsdown=window.hbs.downloadFile,n.filesListObj={},n.fakeObj={},n.fileListName="layaairfiles.txt",n.loadPath="",n.DESCENDING=2,n.NUMERIC=16;var t=function(e){_inherits(MiniSoundChannel,i.SoundChannel);var n=_createSuper(MiniSoundChannel);function MiniSoundChannel(e,i){var t;return _classCallCheck(this,MiniSoundChannel),(t=n.call(this))._audio=e,t._miniSound=i,t._onEnd=MiniSoundChannel.bindToThis(t.__onEnd,_assertThisInitialized(t)),e.onEnded(t._onEnd),t}return _createClass(MiniSoundChannel,[{key:"__onEnd",value:function(){if(1==this.loops)return this.completeHandler&&(i.Laya.systemTimer.once(10,this,this.__runComplete,[this.completeHandler],!1),this.completeHandler=null),this.stop(),void this.event(i.Event.COMPLETE);this.loops>0&&this.loops--,this.startTime=0,this.play()}},{key:"play",value:function(){this.isStopped=!1,i.SoundManager.addChannel(this),this._audio.play()}},{key:"stop",value:function(){this.isStopped=!0,i.SoundManager.removeChannel(this),this.completeHandler=null,this._audio&&(this._audio.stop(),this.loop||(this._audio.offEnded(null),this._miniSound.dispose(),this._audio=null,this._miniSound=null,this._onEnd=null))}},{key:"pause",value:function(){this.isStopped=!0,this._audio.pause()}},{key:"resume",value:function(){this._audio&&(this.isStopped=!1,i.SoundManager.addChannel(this),this._audio.play())}},{key:"startTime",set:function(e){this._audio&&(this._audio.startTime=e)}},{key:"autoplay",set:function(e){this._audio.autoplay=e},get:function(){return this._audio.autoplay}},{key:"position",get:function(){return this._audio?this._audio.currentTime:0}},{key:"duration",get:function(){return this._audio?this._audio.duration:0}},{key:"loop",get:function(){return this._audio.loop},set:function(e){this._audio.loop=e}},{key:"volume",set:function(e){this._audio&&(this._audio.volume=e)},get:function(){return this._audio?this._audio.volume:1}}],[{key:"bindToThis",value:function(e,i){return e.bind(i)}}]),MiniSoundChannel}(),o=function(e){_inherits(MiniSound,i.EventDispatcher);var o=_createSuper(MiniSound);function MiniSound(){var e;return _classCallCheck(this,MiniSound),(e=o.call(this)).loaded=!1,e}return _createClass(MiniSound,[{key:"load",value:function(e){if(MiniSound._musicAudio||(MiniSound._musicAudio=MiniSound._createSound()),n.isLocalNativeFile(e)){if(-1!=e.indexOf("http://")||-1!=e.indexOf("https://"))if(""!=n.loadPath)e=e.split(n.loadPath)[1];else{var t=""!=i.URL.rootPath?i.URL.rootPath:i.URL._basePath;""!=t&&(e=e.split(t)[1])}}else e=i.URL.formatURL(e);if(this.url=e,this.readyUrl=e,MiniSound._audioCache[this.readyUrl])this.event(i.Event.COMPLETE);else if(r.autoCacheFile&&n.getFileInfo(e))this.onDownLoadCallBack(e,0);else if(r.autoCacheFile)if(n.isLocalNativeFile(e)){var o=e;if(""!=(t=""!=i.URL.rootPath?i.URL.rootPath:i.URL._basePath)&&(e=e.split(t)[1]),e||(e=o),r.subNativeFiles&&0==r.subNativeheads.length)for(var a in r.subNativeFiles){var l=r.subNativeFiles[a];r.subNativeheads=r.subNativeheads.concat(l);for(var s=0;s<l.length;s++)r.subMaps[l[s]]=a+"/"+l[s]}if(r.subNativeFiles&&-1!=e.indexOf("/")){var u=e.split("/")[0]+"/";if(u&&-1!=r.subNativeheads.indexOf(u)){var d=r.subMaps[u];e=e.replace(u,d)}}this.onDownLoadCallBack(e,0)}else!n.isLocalNativeFile(e)&&-1==e.indexOf("http://")&&-1==e.indexOf("https://")||-1!=e.indexOf("http://usr/")?this.onDownLoadCallBack(e,0):n.downOtherFiles(encodeURI(e),i.Handler.create(this,this.onDownLoadCallBack,[e]),e);else this.onDownLoadCallBack(e,0)}},{key:"onDownLoadCallBack",value:function(e,t){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(t)this.event(i.Event.ERROR);else{var a;if(r.autoCacheFile){if(o)a=o;else if(n.isLocalNativeFile(e)){var l=""!=i.URL.rootPath?i.URL.rootPath:i.URL._basePath,s=e;""==l||-1==e.indexOf("http://")&&-1==e.indexOf("https://")||(a=e.split(l)[1]),a||(a=s)}else{var u=n.getFileInfo(e);if(u&&u.md5){var d=u.md5;a=n.getFileNativePath(d)}else a=e}this.url!=i.SoundManager._bgMusic?(this._sound=MiniSound._createSound(),this._sound.src=this.url=a):(this._sound=MiniSound._musicAudio,this._sound.src=this.url=a)}else this.url!=i.SoundManager._bgMusic?(this._sound=MiniSound._createSound(),this._sound.src=e):(this._sound=MiniSound._musicAudio,this._sound.src=e);this._sound.onCanplay(MiniSound.bindToThis(this.onCanPlay,this)),this._sound.onError(MiniSound.bindToThis(this.onError,this))}}},{key:"onError",value:function(e){try{console.log("-----1---------------minisound-----id:"+MiniSound._id),console.log(e)}catch(e){console.log("-----2---------------minisound-----id:"+MiniSound._id),console.log(e)}this.event(i.Event.ERROR),this._sound.offError(null)}},{key:"onCanPlay",value:function(){this.loaded=!0,this.event(i.Event.COMPLETE),this._sound.offCanplay(null)}},{key:"play",value:function(){var e,o=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(this.url==i.SoundManager._bgMusic?(MiniSound._musicAudio||(MiniSound._musicAudio=MiniSound._createSound()),e=MiniSound._musicAudio):e=MiniSound._audioCache[this.readyUrl]?MiniSound._audioCache[this.readyUrl]._sound:MiniSound._createSound(),!e)return null;if(r.autoCacheFile&&n.getFileInfo(this.url)){var l=n.getFileInfo(this.url).md5;e.src=this.url=n.getFileNativePath(l)}else e.src=this.url;var s=new t(e,this);return s.url=this.url,s.loops=a,s.loop=0===a,s.startTime=o,s.play(),i.SoundManager.addChannel(s),s}},{key:"dispose",value:function(){var e=MiniSound._audioCache[this.readyUrl];e&&(e.src="",e._sound&&(e._sound.destroy(),e._sound=null,e=null),delete MiniSound._audioCache[this.readyUrl]),this._sound&&(this._sound.destroy(),this._sound=null,this.readyUrl=this.url=null)}},{key:"duration",get:function(){return this._sound.duration}}],[{key:"_createSound",value:function(){return MiniSound._id++,r.window.hbs.createInnerAudioContext()}},{key:"bindToThis",value:function(e,i){return e.bind(i)}}]),MiniSound}();o._id=0,o._audioCache={};var a=function(){function MiniInput(){_classCallCheck(this,MiniInput)}return _createClass(MiniInput,null,[{key:"_createInputElement",value:function(){i.Input._initInput(i.Input.area=i.Browser.createElement("textarea")),i.Input._initInput(i.Input.input=i.Browser.createElement("input")),i.Input.inputContainer=i.Browser.createElement("div"),i.Input.inputContainer.style.position="absolute",i.Input.inputContainer.style.zIndex=1e5,i.Browser.container.appendChild(i.Input.inputContainer),i.Laya.stage.on("resize",null,MiniInput._onStageResize),r.window.hbs.onWindowResize&&r.window.hbs.onWindowResize(function(e){}),i.SoundManager._soundClass=o,i.SoundManager._musicClass=o;var e=r.systemInfo.model,n=r.systemInfo.system;-1!=e.indexOf("iPhone")&&(i.Browser.onIPhone=!0,i.Browser.onIOS=!0,i.Browser.onIPad=!0,i.Browser.onAndroid=!1),-1==n.indexOf("Android")&&-1==n.indexOf("Adr")||(i.Browser.onAndroid=!0,i.Browser.onIPhone=!1,i.Browser.onIOS=!1,i.Browser.onIPad=!1)}},{key:"_onStageResize",value:function(){i.Laya.stage._canvasTransform.identity().scale(i.Browser.width/i.Render.canvas.width/i.Browser.pixelRatio,i.Browser.height/i.Render.canvas.height/i.Browser.pixelRatio)}},{key:"inputFocus",value:function(e){var n=i.Input.inputElement.target;n&&!n.editable||(r.window.hbs.offKeyboardConfirm(),r.window.hbs.offKeyboardInput(),r.window.hbs.showKeyboard({defaultValue:n.text,maxLength:n.maxChars,multiple:n.multiline,confirmHold:!0,confirmType:n.confirmType||"done",success:function(e){},fail:function(e){}}),r.window.hbs.onKeyboardConfirm(function(e){var t=e?e.value:"";n._restrictPattern&&(t=t.replace(/\u2006|\x27/g,""),n._restrictPattern.test(t)&&(t=t.replace(n._restrictPattern,""))),n.text=t,n.event(i.Event.INPUT),MiniInput.inputEnter(),n.event("confirm")}),r.window.hbs.onKeyboardInput(function(e){var t=e?e.value:"";n.multiline||-1==t.indexOf("\n")?(n._restrictPattern&&(t=t.replace(/\u2006|\x27/g,""),n._restrictPattern.test(t)&&(t=t.replace(n._restrictPattern,""))),n.text=t,n.event(i.Event.INPUT)):MiniInput.inputEnter()}))}},{key:"inputEnter",value:function(){i.Input.inputElement.target.focus=!1}},{key:"inputblur",value:function(){MiniInput.hideKeyboard()}},{key:"hideKeyboard",value:function(){r.window.hbs.offKeyboardConfirm(),r.window.hbs.offKeyboardInput(),r.window.hbs.hideKeyboard({success:function(e){console.log("隐藏键盘")},fail:function(e){console.log("隐藏键盘出错:"+(e?e.errMsg:""))}})}}]),MiniInput}(),l=function(e){_inherits(MiniLoader,i.EventDispatcher);var t=_createSuper(MiniLoader);function MiniLoader(){return _classCallCheck(this,MiniLoader),t.call(this)}return _createClass(MiniLoader,[{key:"_loadResourceFilter",value:function(e,t){if(this.sourceUrl=i.URL.formatURL(t),n.isNetFile(t))if(""!=n.loadPath)t=t.split(n.loadPath)[1];else{var o=""!=i.URL.rootPath?i.URL.rootPath:i.URL._basePath,a=t;""!=o&&(t=t.split(o)[1]),t||(t=a)}if(r.subNativeFiles&&0==r.subNativeheads.length)for(var l in r.subNativeFiles){var s=r.subNativeFiles[l];r.subNativeheads=r.subNativeheads.concat(s);for(var u=0;u<s.length;u++)r.subMaps[s[u]]=l+"/"+s[u]}if(r.subNativeFiles&&-1!=t.indexOf("/")){var d=t.split("/")[0]+"/";if(d&&-1!=r.subNativeheads.indexOf(d)){var c=r.subMaps[d];t=t.replace(d,c)}}switch(e){case i.Loader.IMAGE:case"htmlimage":case"nativeimage":MiniLoader._transformImgUrl(t,e,this);break;case i.Loader.SOUND:this._loadSound(t);break;default:this._loadResource(e,t)}}},{key:"_loadSound",value:function(e){if(r.autoCacheFile){var t=i.URL.formatURL(e);n.isLocalNativeFile(e)||n.getFileInfo(t)?MiniLoader.onDownLoadCallBack(e,this,0):n.isNetFile(t)?n.downOtherFiles(r.safeEncodeURI(t),i.Handler.create(MiniLoader,MiniLoader.onDownLoadCallBack,[t,this]),t):MiniLoader.onDownLoadCallBack(e,this,0)}else MiniLoader.onDownLoadCallBack(e,this,0)}},{key:"complete",value:function(e){e instanceof i.Resource?e._setCreateURL(this.sourceUrl):e instanceof i.Texture&&e.bitmap instanceof i.Resource&&e.bitmap._setCreateURL(this.sourceUrl),this.originComplete(e)}},{key:"_loadHttpRequestWhat",value:function(e,t){var o=r.getUrlEncode(e,t);if(i.Loader.preLoadedMap[e])this.onLoaded(i.Loader.preLoadedMap[e]);else{var a=i.URL.formatURL(e);if(r.AutoCacheDownFile)if(n.isLocalNativeFile(e)||n.getFileInfo(a)){var l=e,s=n.getFileInfo(a);s&&s.md5&&(l=s.tempFilePath||n.getFileNativePath(s.md5)),n.readFile(l,o,new i.Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[e,t,this]),e)}else n.isNetFile(a)?n.downFiles(r.safeEncodeURI(a),o,new i.Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[e,t,this]),a,!0):n.readFile(e,o,new i.Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[e,t,this]),e);else n.isNetFile(a)?n.downFiles(r.safeEncodeURI(a),o,new i.Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[e,t,this]),a,!0):n.readFile(e,o,new i.Handler(MiniLoader,MiniLoader.onReadNativeCallBack,[e,t,this]),e)}}}],[{key:"onDownLoadCallBack",value:function(e,t,o){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(o)t.event(i.Event.ERROR,"Load sound failed");else{var l;if(r.autoCacheFile)if(a)l=a;else if(n.isLocalNativeFile(e))l=e;else{var s=n.getFileInfo(e);l=s&&s.md5?s.tempFilePath||n.getFileNativePath(s.md5):e}e=l;var u=new i.SoundManager._soundClass;u.load(r.safeEncodeURI(e)),t.onLoaded(u)}}},{key:"bindToThis",value:function(e,i){return e.bind(i)}},{key:"onReadNativeCallBack",value:function(e){var n,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;a?1==a&&o._loadHttpRequest(e,t,o,o.onLoaded,o,o.onProgress,o,o.onError):(n=t==i.Loader.JSON||t==i.Loader.ATLAS||t==i.Loader.PREFAB||t==i.Loader.PLF?r.getJson(l.data):t==i.Loader.XML?i.Utils.parseXMLFromString(l.data):l.data,o.onLoaded(n))}},{key:"_transformImgUrl",value:function(e,t,o){if(n.isLocalNativeFile(e))o._loadImage(e,!1);else if(r.autoCacheFile)if(r.autoCacheFile){var a=i.URL.formatURL(e);n.isLocalNativeFile(e)||n.getFileInfo(a)?MiniLoader.onCreateImage(e,o):n.isNetFile(a)?n.downOtherFiles(r.safeEncodeURI(a),new i.Handler(MiniLoader,MiniLoader.onDownImgCallBack,[e,o]),a):MiniLoader.onCreateImage(e,o,!0)}else o._loadImage(r.safeEncodeURI(e));else o._loadImage(r.safeEncodeURI(e))}},{key:"onDownImgCallBack",value:function(e,i,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";n?i.onError(null):MiniLoader.onCreateImage(e,i,!1,t)}},{key:"onCreateImage",value:function(e,t){var o,a=arguments.length>2&&void 0!==arguments[2]&&arguments[2],l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(r.autoCacheFile)if(a)o=e;else if(""!=l)o=l;else{var s=n.getFileInfo(i.URL.formatURL(e));o=s.tempFilePath||n.getFileNativePath(s.md5)}else o=a?e:l;t._loadImage(o,!1)}}]),MiniLoader}();function ImageDataPolyfill(){var e,n,t;if(3==arguments.length){if(!(arguments[0]instanceof Uint8ClampedArray))throw new Error("Failed to construct 'ImageData': parameter 1 is not of type 'Uint8ClampedArray'.");if(arguments[0].length%4!=0)throw new Error("Failed to construct 'ImageData': The input data length is not a multiple of 4.");if(arguments[0].length!==arguments[1]*arguments[2]*4)throw new Error("Failed to construct 'ImageData': The input data length is not equal to (4 * width * height).");t=arguments[0],e=arguments[1],n=arguments[2]}else if(2==arguments.length)e=arguments[0],n=arguments[1],t=new Uint8ClampedArray(arguments[0]*arguments[1]*4);else if(arguments.length<2)throw new Error("Failed to construct 'ImageData': 2 arguments required, but only "+arguments.length+" present.");for(var o=i.Browser.canvas.getContext("2d").getImageData(0,0,e,n),a=0;a<t.length;a+=4)o.data[a]=t[a],o.data[a+1]=t[a+1],o.data[a+2]=t[a+2],o.data[a+3]=t[a+3];return o}var r=function(){function HWMiniAdapter(){_classCallCheck(this,HWMiniAdapter)}return _createClass(HWMiniAdapter,null,[{key:"getJson",value:function(e){return JSON.parse(e)}},{key:"enable",value:function(){HWMiniAdapter.init()}},{key:"init",value:function(){HWMiniAdapter._inited||(HWMiniAdapter._inited=!0,HWMiniAdapter.window=window,HWMiniAdapter.window.hasOwnProperty("hbs")&&(HWMiniAdapter.EnvConfig={},n.setNativeFileDir("/layaairGame"),n.getCacheList(n.fileNativeDir,i.Handler.create(HWMiniAdapter,HWMiniAdapter.onMkdirCallBack)),HWMiniAdapter.systemInfo=HWMiniAdapter.window.hbs.getSystemInfoSync(),HWMiniAdapter.window.focus=function(){},i.Laya._getUrlPath=function(){return""},HWMiniAdapter.window.logtime=function(e){},HWMiniAdapter.window.alertTimeLog=function(e){},HWMiniAdapter.window.resetShareInfo=function(){},i.HttpRequest._urlEncode=HWMiniAdapter.safeEncodeURI,HWMiniAdapter._preCreateElement=i.Browser.createElement,i.Browser.createElement=HWMiniAdapter.createElement,i.RunDriver.createShaderCondition=HWMiniAdapter.createShaderCondition,i.Input._createInputElement=a._createInputElement,window.ImageData||(window.ImageData=ImageDataPolyfill),i.Loader.prototype._loadResourceFilter=l.prototype._loadResourceFilter,i.Loader.prototype._loadSound=l.prototype._loadSound,i.Loader.prototype.originComplete=i.Loader.prototype.complete,i.Loader.prototype.complete=l.prototype.complete,i.Loader.prototype._loadHttpRequestWhat=l.prototype._loadHttpRequestWhat,i.Config.useRetinalCanvas=!0))}},{key:"getUrlEncode",value:function(e,i){return"arraybuffer"==i?"binary":"utf8"}},{key:"downLoadFile",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"utf8";n.getFileInfo(e)?null!=t&&t.runWith([0]):n.downLoadFile(HWMiniAdapter.safeEncodeURI(e),i,t,o)}},{key:"remove",value:function(e){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;n.deleteFile("",e,i,"",0)}},{key:"removeAll",value:function(){n.deleteAll()}},{key:"hasNativeFile",value:function(e){return n.isLocalNativeFile(e)}},{key:"getFileInfo",value:function(e){return n.getFileInfo(e)}},{key:"getFileList",value:function(){return n.filesListObj}},{key:"exitMiniProgram",value:function(){HWMiniAdapter.window.hbs.exitMiniProgram()}},{key:"onMkdirCallBack",value:function(e,i){e?(n.fakeObj={},n.filesListObj={}):(n.filesListObj=JSON.parse(i.data)||{},n.fakeObj=JSON.parse(i.data)||{});var t=n.fs.readdirSync(n.fileNativeDir);if(t&&t.length){var o,a,l={};for(var r in n.filesListObj)"fileUsedSize"!=r&&(l[(o=n.filesListObj[r]).md5]=o.readyUrl);for(var s=0,u=t.length;s<u;s++)if((a=t[s])!=n.fileListName){if(!l[a]){var d=n.getFileNativePath(a);n.fs.unlink({filePath:d,success:function(e){console.log("删除无引用的磁盘文件:"+a)}})}delete l[a]}for(var c in l)delete n.filesListObj[l[c]],delete n.fakeObj[l[c]],console.log("删除错误记录：",l[c])}}},{key:"pixelRatio",value:function(){if(!HWMiniAdapter.EnvConfig.pixelRatioInt)try{return HWMiniAdapter.EnvConfig.pixelRatioInt=HWMiniAdapter.systemInfo.pixelRatio,HWMiniAdapter.systemInfo.pixelRatio}catch(e){}return HWMiniAdapter.EnvConfig.pixelRatioInt}},{key:"createElement",value:function(e){if("textarea"==e||"input"==e)return HWMiniAdapter.onCreateInput(e);if("div"==e){var i=HWMiniAdapter._preCreateElement(e);return i.contains=function(e){return null},i.removeChild=function(e){},i}return HWMiniAdapter._preCreateElement(e)}},{key:"onCreateInput",value:function(e){var i=HWMiniAdapter._preCreateElement(e);return i.focus=a.inputFocus,i.blur=a.inputblur,i.style={},i.value=0,i.parentElement={},i.placeholder={},i.type={},i.setColor=function(e){},i.setType=function(e){},i.setFontFace=function(e){},i.addEventListener=function(e){},i.contains=function(e){return null},i.removeChild=function(e){},i}},{key:"createShaderCondition",value:function(e){return function(){return this[e.replace("this.","")]}}}]),HWMiniAdapter}();r.IGNORE=new RegExp("[-_.!~*'();/?:@&=+$,#%]|[0-9|A-Z|a-z]"),r.safeEncodeURI=function(e){for(var i="",n=e.length,t=0;t<n;t++){var o=e[t];if(r.IGNORE.test(o))i+=o;else try{i+=encodeURI(o)}catch(e){console.log("errorInfo",">>>"+o)}}return i},r._inited=!1,r.autoCacheFile=!0,r.minClearSize=5242880,r.sizeLimit=52428800,r.nativefiles=["layaNativeDir","wxlocal"],r.subNativeFiles=[],r.subNativeheads=[],r.subMaps=[],r.AutoCacheDownFile=!1;var s=function(e){_inherits(MiniAccelerator,i.EventDispatcher);var n=_createSuper(MiniAccelerator);function MiniAccelerator(){return _classCallCheck(this,MiniAccelerator),n.call(this)}return _createClass(MiniAccelerator,[{key:"on",value:function(e,i,n){var t=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return _get(_getPrototypeOf(MiniAccelerator.prototype),"on",this).call(this,e,i,n,t),MiniAccelerator.startListen(this.onDeviceOrientationChange),this}},{key:"off",value:function(e,i,n){var t=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return this.hasListener(e)||MiniAccelerator.stopListen(),_get(_getPrototypeOf(MiniAccelerator.prototype),"off",this).call(this,e,i,n,t)}}],[{key:"__init__",value:function(){try{var e;if(!(e=i.Accelerator))return;e.prototype.on=MiniAccelerator.prototype.on,e.prototype.off=MiniAccelerator.prototype.off}catch(e){}}},{key:"startListen",value:function(e){if(MiniAccelerator._callBack=e,!MiniAccelerator._isListening){MiniAccelerator._isListening=!0;try{r.window.hbs.onAccelerometerChange(MiniAccelerator.onAccelerometerChange)}catch(e){}}}},{key:"stopListen",value:function(){MiniAccelerator._isListening=!1;try{r.window.hbs.stopAccelerometer({})}catch(e){}}},{key:"onAccelerometerChange",value:function(e){var i;(i={}).acceleration=e,i.accelerationIncludingGravity=e,i.rotationRate={},null!=MiniAccelerator._callBack&&MiniAccelerator._callBack(i)}}]),MiniAccelerator}();s._isListening=!1;var u=function(){function MiniLocation(){_classCallCheck(this,MiniLocation)}return _createClass(MiniLocation,null,[{key:"__init__",value:function(){r.window.navigator.geolocation.getCurrentPosition=MiniLocation.getCurrentPosition,r.window.navigator.geolocation.watchPosition=MiniLocation.watchPosition,r.window.navigator.geolocation.clearWatch=MiniLocation.clearWatch}},{key:"getCurrentPosition",value:function(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;arguments.length>2&&void 0!==arguments[2]&&arguments[2];(e={}).success=function(e){null!=i&&i(e)},e.fail=n,r.window.hbs.getLocation(e)}},{key:"watchPosition",value:function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;arguments.length>2&&void 0!==arguments[2]&&arguments[2];return MiniLocation._curID++,(e={}).success=n,e.error=t,MiniLocation._watchDic[MiniLocation._curID]=e,i.Laya.systemTimer.loop(1e3,null,MiniLocation._myLoop),MiniLocation._curID}},{key:"clearWatch",value:function(e){delete MiniLocation._watchDic[e],MiniLocation._hasWatch()||i.Laya.systemTimer.clear(null,MiniLocation._myLoop)}},{key:"_hasWatch",value:function(){var e;for(e in MiniLocation._watchDic)if(MiniLocation._watchDic[e])return!0;return!1}},{key:"_myLoop",value:function(){MiniLocation.getCurrentPosition(MiniLocation._mySuccess,MiniLocation._myError)}},{key:"_mySuccess",value:function(e){var n,t={};for(n in t.coords=e,t.timestamp=i.Browser.now(),MiniLocation._watchDic)MiniLocation._watchDic[n].success&&MiniLocation._watchDic[n].success(t)}},{key:"_myError",value:function(e){var i;for(i in MiniLocation._watchDic)MiniLocation._watchDic[i].error&&MiniLocation._watchDic[i].error(e)}}]),MiniLocation}();u._watchDic={},u._curID=0;var d=function(){function MiniVideo(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:320,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:240;_classCallCheck(this,MiniVideo),this.videoend=!1,this.videourl="",this.videoElement=r.window.hbs.createVideo({width:e,height:i,autoplay:!0})}return _createClass(MiniVideo,[{key:"on",value:function(e,i,n){"loadedmetadata"==e?(this.onPlayFunc=n.bind(i),this.videoElement.onPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=n.bind(i),this.videoElement.onEnded=this.onEndedFunction.bind(this)),this.videoElement.onTimeUpdate=this.onTimeUpdateFunc.bind(this)}},{key:"onTimeUpdateFunc",value:function(e){this.position=e.position,this._duration=e.duration}},{key:"onPlayFunction",value:function(){this.videoElement&&(this.videoElement.readyState=200),console.log("=====视频加载完成========"),null!=this.onPlayFunc&&this.onPlayFunc()}},{key:"onEndedFunction",value:function(){this.videoElement&&(this.videoend=!0,console.log("=====视频播放完毕========"),null!=this.onEndedFunC&&this.onEndedFunC())}},{key:"off",value:function(e,i,n){"loadedmetadata"==e?(this.onPlayFunc=n.bind(i),this.videoElement.offPlay=this.onPlayFunction.bind(this)):"ended"==e&&(this.onEndedFunC=n.bind(i),this.videoElement.offEnded=this.onEndedFunction.bind(this))}},{key:"load",value:function(e){this.videoElement&&(this.videoElement.src=e)}},{key:"play",value:function(){this.videoElement&&(this.videoend=!1,this.videoElement.play())}},{key:"pause",value:function(){this.videoElement&&(this.videoend=!0,this.videoElement.pause())}},{key:"size",value:function(e,i){this.videoElement&&(this.videoElement.width=e,this.videoElement.height=i)}},{key:"destroy",value:function(){this.videoElement&&this.videoElement.destroy(),this.videoElement=null,this.onEndedFunC=null,this.onPlayFunc=null,this.videoend=!1,this.videourl=null}},{key:"reload",value:function(){this.videoElement&&(this.videoElement.src=this.videourl)}},{key:"duration",get:function(){return this._duration}},{key:"currentTime",get:function(){return this.videoElement?this.videoElement.initialTime:0},set:function(e){this.videoElement&&(this.videoElement.initialTime=e)}},{key:"videoWidth",get:function(){return this.videoElement?this.videoElement.width:0}},{key:"videoHeight",get:function(){return this.videoElement?this.videoElement.height:0}},{key:"ended",get:function(){return this.videoend}},{key:"loop",get:function(){return!!this.videoElement&&this.videoElement.loop},set:function(e){this.videoElement&&(this.videoElement.loop=e)}},{key:"playbackRate",get:function(){return this.videoElement?this.videoElement.playbackRate:0},set:function(e){this.videoElement&&(this.videoElement.playbackRate=e)}},{key:"muted",get:function(){return!!this.videoElement&&this.videoElement.muted},set:function(e){this.videoElement&&(this.videoElement.muted=e)}},{key:"paused",get:function(){return!!this.videoElement&&this.videoElement.paused}},{key:"x",get:function(){return this.videoElement?this.videoElement.x:0},set:function(e){this.videoElement&&(this.videoElement.x=e)}},{key:"y",get:function(){return this.videoElement?this.videoElement.y:0},set:function(e){this.videoElement&&(this.videoElement.y=e)}},{key:"currentSrc",get:function(){return this.videoElement.src}}],[{key:"__init__",value:function(){}}]),MiniVideo}();e.HWMiniAdapter=r,e.ImageDataPolyfill=ImageDataPolyfill,e.MiniAccelerator=s,e.MiniFileMgr=n,e.MiniInput=a,e.MiniLoader=l,e.MiniLocation=u,e.MiniSound=o,e.MiniSoundChannel=t,e.MiniVideo=d};